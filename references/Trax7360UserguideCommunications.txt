Trax | Administrator (Communications)

Trax | Administrator (Communications)
Trax 7.36.0

Trax | Administrator (Communications)

Copyright Notice
© FIS. This document and the software described within are copyrighted with all rights reserved.
No part of this document may be reproduced, transcribed, transmitted, stored in an electronic retrieval system, or
translated into any language in any form by any means without prior written permission of FIS. FIS makes no warranties,
express or implied, in this document. In no event shall FIS be liable for damages of any kind arising out of the use of this
document or the information contained within.

Confidentiality Statement
This document contains information that is confidential or proprietary to FIS (or its direct or indirect subsidiaries). By
accepting this document, you agree that: (1) if there is any pre- existing contract containing disclosure and use
restrictions between your company and FIS, you and your company will use this information in reliance on and submit to the
terms of any such pre-existing context; or (2) if there is no contractual relationship between you or your company and
FIS, you and your Company agree to protect this information and not reproduce, disclose or use the information in any
way, except as may be required by law.

Disclaimer
The screens and illustrations in this document are representative of those created by the soft- ware and are not always
exact copies of what appears on the computer monitor. Companies, names and data used in examples herein are
fictitious unless otherwise noted. The material in this document is for information only and is subject to change without
notice. FIS reserves the right to make changes in the product design and installation software without reservation and
without notice to users.

Registered Trademarks and Proprietary names
FIS, the FIS logo, FIS, and Trax are trademarks or registered trademarks of FIS Data Systems, Inc., or its subsidiaries in
the U.S. and other countries. All other trade names are trademarks or registered trademarks of their respective holders.

Applicability
This guide applies to Trax 7.36.0
Written and designed by:
FIS
De Kleetlaan 6A
1831 Diegem
Belgium

Trax 7.36.0

2

Trax | Administrator (Communications)

Document Conventions and Notes
Note: Note that when modifying or entering data, it must be saved before closing the window. If this is not done, the
changes will be discarded upon exiting.

Note: NA stands for Not Applicable

Note: Some screens contain three buttons with OK - No data - Cancel. “OK” will confirm the choice or entry which has
been made. The "No data" button will erase the entered information. The "Cancel" button will cancel the current menu but
will not erase the previously entered information.

Note: Audit History may be applicable to some entities. If this feature is enabled, changes to the data belonging to that
entity will be recorded and visible for Audit purposes. These will be displayed under the audit tab of the changed record
and depending on the configuration on a separate Audit entity. For more information on the consequences and changes
to the workflow, refer to the Audit History documentation.

Note: Change Approval may be applicable to some entities. If this feature is enabled, changes to the data belonging to
that entity will be recorded and have to be approved in order for the actual changes or creation to take place. This feature
requires Audit History. For more information on the consequences and changes to the workflow, refer to the Change
Approval documentation.

Trax 7.36.0

3

Trax | Administrator (Communications)

Table of Contents
1

2

3

4

5

6

Introduction _________________________________________________ 7
1.1

Message Processing _________________________________________ 7

1.2

Transmission workflow _______________________________________ 9

1.3

Communication workflow ____________________________________ 11

1.4

Transmission Object ________________________________________ 13

1.5

Communication Object ______________________________________ 17

1.6

Drill-down to Transmission ___________________________________ 26

1.7

Communication Channel _____________________________________ 26

1.8

Workflow Inventories ________________________________________ 27

1.9

Communication Information on Business Objects _________________ 28

Incoming Routing ___________________________________________ 30
2.1

Introduction _______________________________________________ 30

2.2

Configuration of Incoming Routing Tables _______________________ 30

Outgoing Routing ___________________________________________ 37
3.1

Introduction _______________________________________________ 37

3.2

Configuration of Outgoing Routing Tables _______________________ 37

Workflow Notification ________________________________________ 46
4.1

Introduction _______________________________________________ 46

4.2

Configuration of Workflow Notification Tables ____________________ 46

4.3

Workflow notification exceptions _______________________________ 49

Pre/Post Processing Script ___________________________________ 51
5.1

Introduction _______________________________________________ 51

5.2

Configuration ______________________________________________ 51

5.3

Groovy Scripts_____________________________________________ 55

5.4

XSLT Scripts ______________________________________________ 56

5.5

Scripts included in Trax ______________________________________ 57

5.6

Logging __________________________________________________ 61

Cryptography ______________________________________________ 62
6.1

Configuration ______________________________________________ 62

Trax 7.36.0

4

Trax | Administrator (Communications)

7

8

9

10

11

12

6.2

Incoming communications____________________________________ 74

6.3

Outgoing communications____________________________________ 75

Channel: File-system ________________________________________ 80
7.1

Incoming Configuration ______________________________________ 80

7.2

File System Outgoing Profile _________________________________ 82

Channel: File- or Web Service-based SWIFT _____________________ 86
8.1

FileAct ___________________________________________________ 86

8.2

FIN (RJE format) ___________________________________________ 98

8.3

Local Authentication (LAU) __________________________________ 103

8.4

FTP remoting ____________________________________________ 104

8.5

Directory poll jobs _________________________________________ 104

8.6

Application logging ________________________________________ 104

Channel: EBICS ___________________________________________ 106
9.1

EBICS Introduction ________________________________________ 106

9.2

Configuration _____________________________________________ 106

9.3

Using EBICS _____________________________________________ 119

9.4

Notes ___________________________________________________ 123

9.5

Configure Incoming Routing (EBICS) __________________________ 125

Channel: Web Services ____________________________________ 126
10.1

Trax Import Web Service v1.0 _______________________________ 126

10.2

Web Service Tooling _______________________________________ 133

10.3

Configure Incoming Routing (Web Service) _____________________ 136

Channel: JMS ____________________________________________ 138
11.1

IBM WebSphere MQ _______________________________________ 138

11.2

WebLogic JMS remote JNDI (legacy) __________________________ 142

11.3

JMS service______________________________________________ 148

11.4

Outgoing routing __________________________________________ 149

11.5

Incoming routing __________________________________________ 149

Channel: MAIL ___________________________________________ 150
12.1

Configuration _____________________________________________ 150

Trax 7.36.0

5

Trax | Administrator (Communications)

13

Channel: No Output_______________________________________ 156
13.1

14

15

Usage __________________________________________________ 156

Channel: Workflow _______________________________________ 157
14.1

Usage __________________________________________________ 157

14.2

Configuration _____________________________________________ 157

Channel: Integration Channel ______________________________ 159
15.1

Introduction ______________________________________________ 159

15.2

Integration Channel Service _________________________________ 159

15.3

Automatically reload Integration Channel Service configuration _____ 159

15.4

Integration Channel Profile configuration _______________________ 160

15.5

Bank Connector and Trax Swift Gateway _______________________ 170

15.6

Apache Kafka ____________________________________________ 177

16

Channel Reference and E2E reference _______________________ 178

17

Trax Disaster Recovery attempt towards Bank Connector (BC) ___ 179

18

Trax run modes __________________________________________ 180
18.1

Configuration _____________________________________________ 180

18.2

Usage __________________________________________________ 182

Trax 7.36.0

6

Trax | Administrator (Communications)

1 Introduction
All data communications with the Trax application run over a common message processing layer using MQ (Message
Queue). Each Trax server comes with its own embedded Artemis ActiveMQ server. This message processing layer is
protocol- and workflow-independent and offers several generic message conversion services. All these generic services
can be configured through the “Incoming routing”, “Outgoing routing” and “Workflow notification” GUI screens, which are
covered in detail later.
By default, a number of queues are installed which can be displayed on the Wildfly console which can be accessed by
pointing your favorite web browser at the following URL https://localhost:9993/console/.
This console is only available locally on the Trax server and default login/password is system/system.
Navigate to the Runtime → Messaging subsystem to view the queues.
•

smallWorkQueue: worker queue that handles smaller work.

•

largeWorkQueue: worker queue that handles larger work.

•

errorQueue: if something goes wrong during execution the work is moved to this queue which will try to put the
Trax object to the technically failed inventory.

•

errorDLQ: if the above should go wrong the work is moved to this errorDLQ where it will stay. Using the MAX
monitoring tool this work can then be retried.

Figure 1-1 Deployed queues in the Wildfly Web Console

1.1 Message Processing
All message communications with Trax are automatically recorded as “Transmission” and “Communication” objects,
providing Trax administrators with an easy way of viewing the status of every message processed by the application. This
consolidation of connectivity has been realized by decoupling the technical transmission layer from the communication

Trax 7.36.0

7

Trax | Administrator (Communications)

layer (transmission object) and the communication layer from the business layer (communication object) and bringing the
configuration to the GUI.
As such, all functional communications are separated from technical transmissions. In this way, a communication entry is
always linked to the logical file and can be used for functional monitoring and duplicate checking, while technical
troubleshooting is provided by underlying transmission entries. This split helps to separate the business workflows from
low-level wire transmissions, offering a unified approach to all incoming and outgoing communications and centralized
monitoring of all inbound and outbound traffic, which is important for error-solving. For example, when account
statements are expected and can’t be found in the business workflow, chances are that something went wrong during the
incoming communication. The list of transmission and/or communication objects should then be opened and checked for
a transmission or communication at the expected time. The transmission history or communication history tab of that
transmission object or communication object respectively, will show what happened during the import. These details
might help in trying to resolve the problem.
The transmission and communication information is generated by Trax and should be seen as a report on the ongoing
message communications and flows. These are not configuration entities.

Figure 1-2: High-level overview of incoming and outgoing object chains.
Communication object, P = Payment (value object)

T = Transmission object, C =

A normal message processing action will generally follow the below process steps (see Figure 1-2):
-

Incoming flow:
1.

-

When Trax receives an incoming message, the relevant channel implementation stores its bytes into a
transmission object.
2. The next process step (controlled by the Incoming routing table) is to decrypt/decompress the bytes stored
on the transmission object. The result is stored in a new communication object (as plain text).
3. The final process step (controlled by the Incoming routing table) is to read, pre-process & parse the
message representation stored on the communication object, which ultimately results in a new workflow
object (value object) in the relevant Trax workflow.
4. Generic services (decryption, decompression, encoding, script pre-processing, etc.) on the incoming objects
are governed by the “Incoming Routing” configuration as set up in Trax.
Outgoing flow:
1.

The first process step (controlled by the Outgoing routing table) is to serialize, post-process & write the
information contained within the workflow object. The result is stored in a workflow object representation.
Next, the representation is stored into a new communication object (in unchanged, readable plain text).
2. The following process step (controlled by the Outgoing routing table) is to CMS, compress & encrypt the
message representation. The result is stored in a new transmission object.
3. Finally, the channel implementation in Trax will use the bytes stored in the transmission object to send out
the physical message.
4. Generic services (script post-processing, encoding, compression, encryption, etc.) on the outgoing objects
are governed by the “Outgoing Routing” configuration as set up in Trax.

Trax 7.36.0

8

Trax | Administrator (Communications)

Note that there is a possibility to change content between communication and transmission (used for example to add a
PDE flag to Fin header/trailer for FIN-like channels) by means of post-processing.

1.2

Transmission workflow

1.2.1

Introduction

Trax provides a reference workflow for transmissions. This reference workflow is illustrated in the diagram below. Once
the file enters the system, a transmission is created. It will be processed before creating a communication and entering
the workflow.

1.2.2

Workflow Diagram

The following conventions are used for diagrams:
-

black for actions performed by the system

-

red for actions which require intervention by the user

-

grey boxes for intermediate states

- green boxes for final states
The complete workflow begins with either importing the communications or by manually entering them.
Each state in the flowchart represents an inventory in the Trax application.

Figure 1-5 Incoming Transmission Workflow

Trax 7.36.0

9

Trax | Administrator (Communications)

1.2.3

Step-by-Step Description

1.2.3.1 Incoming
All incoming transmissions will be found in this inventory. When the transmissions have the status processed, it means
that a communication could be created. In this inventory, the view action allows to see the transmission, with channel,
profile and status information.

1.2.3.2 Failed
When a transmission is coming in, it can fail for different reason. A transmission can fail due to failed decompression or
failed decryption. More information can be found in the error message why the transmission ended up in the failed
inventory. From the failed inventory the transmission can be reprocessed or cancelled. While cancelling the transmission
notes with the reason for cancellation can be added.

1.2.3.3 Cancelled
Whenever a transmission is cancelled, it will end in this inventory. Currently it can only be cancelled from the failed
inventory. The view notes action allows to see the reason for cancellation.

Trax 7.36.0

10

Trax | Administrator (Communications)

1.3 Communication workflow
1.3.1

Introduction

Trax provides a reference workflow for communications. This reference workflow is illustrated in the diagram below. Once
a file is entering the communication, it will be processed before entering the payment workflow.

1.3.2

Workflow Diagram

The following conventions are used for diagrams:
-

black for actions performed by the system

-

red for actions which require intervention by the user

-

grey boxes for intermediate states

- green boxes for final states
The complete workflow begins with either importing the communications or by manually entering them.
Each state in the flowchart represents an inventory in the Trax application.

Figure 1-6 Incoming Communication Workflow

1.3.3

Step-by-Step Description

1.3.3.1 Incoming
All incoming communications will be found in this inventory. When the communications have the status processed, it
means they entered their respective workflow and are being processed under that workflow. In this inventory, the preview
communication action allows to see the original raw message. While the view action allows to see the workflow object,
with channel, profile and status information.

1.3.3.2 Failed
When a communication is coming in, it can fail for different reason. A file duplicate check based on the hash of the file is
performed. When a communication is flagged as a duplicate, the communication is stopped in the failed inventory. Then it
can either be accepted and enters the workflow through which it was supposed to go, or it can be cancelled and go to the

Trax 7.36.0

11

Trax | Administrator (Communications)

cancelled inventory. While cancelling the communication notes with the reason for cancellation can be added. An
incoming communication can also fail to load, fail due to a format error, fail due to a preprocessing issue or fail due to
technical reason. More information can be found in in the error message why the communication ended in the failed
inventory. There is also a preview communication action to see the raw message. And it can be reprocessed from this
inventory.

1.3.3.3 Cancelled
Whenever a communication is cancelled, it will end in this inventory. Currently it can only be cancelled form the failed
inventory. The view notes action allows to see the reason for cancellation.

1.3.4

Workflow Diagram

The following conventions are used for diagrams:
-

black for actions performed by the system

-

red for actions which require intervention by the user

-

grey boxes for intermediate states

- green boxes for final states
The complete workflow begins with either importing the communications or by manually entering them.
Each state in the flowchart represents an inventory in the Trax application.

Figure 1-7 Outgoing Communication Workflow

1.3.5

Step-by-Step Description

1.3.5.1 Outgoing
All outgoing communications will be found in this inventory. When the communications have the status processed, it
means they were sent out from their respective workflow. In this inventory, the preview communication action allows to

Trax 7.36.0

12

Trax | Administrator (Communications)

see the raw message. While the view action allows to see the workflow object, with channel, profile and status
information.

1.3.5.2 Failed
When a communication is going out, it can fail for different reason. A file duplicate check based on the hash of the file is
performed. When a communication is flagged as a duplicate, the communication is stopped in the failed inventory. Then it
can either be rescheduled and be sent out of Trax, it can be cancelled, while cancelling the communication notes with the
reason for cancellation can be added and go to the cancelled inventory, and then the transmission will also go to the
cancelled inventory and the same notes will be added to the transmission. Or it can be “Flag as sent” but no transmission
will be created. An outgoing communication can also fail to encrypt, fail due to a channel issue or due to a technical
reason. For these issues, the same actions are also present, and the behavior is the same except that for these issues a
transmission was already created. So, when rescheduling a failed communication due to these issues, the failed
transmission will be cancelled and a new one will be created. More information can be found in the error message why
the communication ended in the failed inventory. There is also a preview communication action to see the raw message.
And it can be reprocessed from this inventory.

1.3.5.3 Cancelled
Whenever a communication is cancelled, it will end in this inventory. Currently it can only be cancelled form the failed
inventory. The view notes action allows to see the reason for cancellation.

1.4 Transmission Object
A “Transmission” object is available for monitoring and storing the physical message (bytes) and forms the boundary
between the low-level transmission layer and the communication layer. The transmission layer contains the channels over
which the message travels, while the communication layer offers encryption and compression capabilities on the
message. The Monitoring and Audit security profile offers a view on both incoming and outgoing transmission inventories,
alongside the incoming and outgoing communication inventories.

Figure 1-8: Monitoring and audit - Transmissions
A transmission object has a number of key characteristics. These are:
1. Creation date
2. Direction (incoming or outgoing)
3. An internal reference
4. A channel
5. A channel reference

Trax 7.36.0

13

Trax | Administrator (Communications)

6. Information about the current status and a history
7. Digest information (automatically generated for duplicate detection)
8. Related communication entities (for troubleshooting)
9. Related transmission entities (for troubleshooting)
10. Transmission parameters containing channel specific information
Note: The maximum length of a transmission parameter is 512 characters.

1.4.1

General

The information displayed on a transmission object is read-only data. It forms an overview of what is known about the
transmission object for information purposes. It is not a configuration screen.

Figure 1-9: Transmission General
Field

Content

Communication

Reference to the linked communication object.

Creation date

This is the date and time when the transmission was started. This
moment defines the first action for that transmission object. For
example, the workflow can be: -received at 14:44:19 and changing
status from received to processed at 14:44:30. In this case, the
creation date will be 14:44:19 as that is the first time an action was
performed for that transmission object. The other actions will be
displayed in the transmission history (see further on)

Direction

Is the message incoming (to Trax) or outgoing (from Avant- Gard Trax)

Channel

Which channel type was used for this message. (See channel
reference further on for the possible options)

Trax 7.36.0

14

Trax | Administrator (Communications)

Field

Content

Profile

The message format/workflow profile according to which the message
is processed.

Status

The current status for the transmission object. (See workflow later on)

Status Date

The status date is the last time when a modification to the current
transmission object status was made. In this case, the status was
changed from received to processed at 14:44:30

E2E Reference

An internal reference to the transmission object

Channel
Reference

A reference to the channel itself. This is automatically generated by
Trax.

Confidential

When this field is set to true, the message content is marked as
confidential. This means that access to it is limited to those users who
have confidential access (this is configured in their user profile).

Workflow

The workflow the transmission belongs to (business integration). See
Workflow Inventories for more information.

Transmission

Reference to the linked transmission object (in case of
bulking/debulking)

Table 1-1: Transmission Genera

1.4.2

Payload

Figure 1-10: Transmission Payload

Trax 7.36.0

15

Trax | Administrator (Communications)

Field

Content

Size

The message size in bytes.

Digest

The message digest is used to give the message a unique
identification.
The chosen digest algorithm. Possible options are None, SHA1 of
MD5. If no algorithm has been used, duplicate checking will not be
possible because there is no digest to compare to.

Digest Algorithm

Table 1-2: Transmission Payload

1.4.3

Transmission Parameters

Additional Transmission parameters are shown in the Transmission parameters tab. For example, the following message
shows the original filename and user that uploaded the message.

Figure 1-11: Transmission parameters tab

1.4.4

Transmission History

The Transmission history tab provides an overview of what happened to the Transmission object at what time.

Trax 7.36.0

16

Trax | Administrator (Communications)

Figure 1-12: Transmission history tab

1.4.5

Saving the Transmission

Figure 1-13: Saving a transmission
The Monitoring and Audit security profile has access to a Save as function on the inventory right-click menu, that allows to
save the transmission data. (i.e. the (encrypted) content). Note that there is an application property called
blob.download.limit which sets a system-wide limit on the maximum size of downloadable items. If you are unable to
download your message contents or representation, it may be too large.

1.5 Communication Object
A “Communication” object is available for monitoring and storing the logical message representation and forms the
boundary between the communication layer and the business layer. The communication layer offers encryption and
compression, while the business layer offers encoding and script processing capabilities on the message. The Monitoring
and Audit security profile offers a view on both incoming and outgoing transmission inventories, alongside the incoming
and outgoing communication inventories.

Trax 7.36.0

17

Trax | Administrator (Communications)

Figure 1-14: Monitoring and audit - Communications
A communication object has a number of key characteristics. These are:
1. Creation date
2. Direction (incoming or outgoing)
3. An internal reference
4. Information about the current status and a history
5. The workflow it belongs to (business integration)
6. Contents of the transmission (stored in the database)
7. Digest information (automatically generated for duplicate detection)
8. Related business entities (for business integration)
9. Related transmission entities (for technical troubleshooting)
10. Communication parameters containing communication specific information
Note: The maximum length of a communication parameter is 512 characters.

1.5.1

General

The information displayed on a communication object is read-only data. It forms an overview of what is known about the
communication object for information purposes. It is not a configuration screen.

Trax 7.36.0

18

Trax | Administrator (Communications)

Figure 1-15 Communication General
Field

Content

Creation date

This is the date and time when the communication was registered by
Trax. This moment defines the first action for that communication
object. For example, the workflow can be: -receiving at 14:44:30, processing at 14:44:36 and changing status from received to
processed at 14:44:47. In this case, the creation date will be 14:44:30
as that is the first time an action was performed for that communication
object. The other actions will be displayed in the communication history
(see further on).

Direction

Is the message incoming (to Trax) or outgoing (from Avant- Gard
Trax).

Channel

Which channel type was used for this message. (See the channels
section further on for the possible options).

Profile

The message format/workflow profile according to which the message
is processed.

Trax 7.36.0

19

Trax | Administrator (Communications)

Field

Content

Status

The current status for the communication object. (See workflow later
on).

Status Date

The status date is the last time when a modification to the current
communication object status was made. In this case, the status was
changed from received to processed at 14:44:47.

E2E Reference

An internal reference to the communication object. This is
automatically generated by Trax.

Content Type

The content type is an optional field allowing for implementation-specific
classification of communication objects.

Duplicate

Set to true when the communication has been classified as a duplicate.
The Payload digest will then match the digest of another message.

Allow duplicate

Set to true when the communication object can have duplicates (i.e. if
the duplicates do not have to be removed from the message flow).

Confidential

When this field is set to true, the message content is marked as
confidential. This means that access to it is limited to those users who
have confidential access (this is configured in their user profile).

Workflow

The workflow the communication belongs to (business integration).
See Workflow Inventories for more information.

Auto Retry Count

The amount of retries which have been executed.

Max retries

The maximum allowed number of retries before failure.

Table 1-3 Communication General
The content type displays the different kinds of content which can be distinguished. This depends on implementation and
is set on a code-level. This list shows the type, subtype and character set of a specific content type as information. It does
not have any impact on the workflow. The different content types are determined by Trax during transmission of the
communication. If the content type is not set or determined, it will remain blank.

Figure 1-16 Content Type

Trax 7.36.0

20

Trax | Administrator (Communications)

1.5.2

Payload

Figure 1-17: Communication Payload
Field

Content

Size

The message size in bytes.

Digest

The message digest is used to give the message a unique
identification.

Digest Algorithm

The chosen digest algorithm. Possible options are None, SHA1 of
MD5. If no algorithm has been used, duplicate checking will not be
possible because there is no digest to compare to.

Table 1-4: Communication Payload

1.5.3

Communication Parameters

Additional communication parameters are shown in the communication parameters tab. For example, the following
message shows the filename and user that uploaded the message.

Trax 7.36.0

21

Trax | Administrator (Communications)

Figure 1-18 Communication Parameters

1.5.4

Business Entity

The Business entity tab links the communication object to the corresponding business entity. It shows both the type of
business entity and the identifier.

Trax 7.36.0

22

Trax | Administrator (Communications)

Figure 1-19 Business Entity tab

1.5.5

Transmission

The Transmission tab links the communication object to the corresponding transmissions. It shows information on all the
transmissions that were linked to the communication.

Trax 7.36.0

23

Trax | Administrator (Communications)

Figure 1-20: Transmission tab

1.5.6

Communication History

The communication history provides an overview of what happened to the communication object at what time.

Trax 7.36.0

24

Trax | Administrator (Communications)

Figure 1-21 Communication History tab

1.5.7

Saving the Communication

Figure 1-22: Saving a communication

Trax 7.36.0

25

Trax | Administrator (Communications)

The Monitoring and Audit security profile has access to a Save as function on the inventory right-click menu, that allows to
save the formatted communication data. (i.e. the message content).
This same Save as function is also available through the Communications tab for the different workflow objects
(Payments, statements, messages, cash flows, …) through the corresponding workflow security profiles.
Note that there is an application property called blob.download.limit which sets a system-wide limit on the maximum size
of downloadable items. If you are unable to download your message contents or representation, it may be too large.
Next to the Save as function, there is also a Preview communication function, allowing an administrator to see a limited
preview of the message content. XML messages will be pretty printed by default, eventhough the communication was
sent out as a single line. To disable this behavior, set the “gui.prettyPrintPreview” client property to “false”.

Figure 1-23: Limited preview on a communication

1.6 Drill-down to Transmission
The administrator profile can also drill down from communication to transmission and from transmission to transmission
(in the context of debulking during FIN or AFT incoming routing), so that incoming or outgoing transmissions can be
monitored more closely in case of exceptions. Drilling down from communication to transmission allows administrators to
find out what exactly (bytes) was received or sent. The communication screen shows a grid to view all transmissions that
created the current communication. In case of debulking, it is also possible to drill down from transmission to
transmission. However, only a link to the creator of the communication is displayed in this case.

1.7 Communication Channel
The communication channel represents a specific communication protocol implementation. By entering the channel under
routing criteria on the incoming routing object, the preferred transport mechanism is chosen.
For every channel there is a code and description. There are two types of behavior which can be distinguished for the
channel as requestor or receiver.
-

Active: The channel has to be started before it can be used. SWIFTNet connections fall into this category as they
must be up and running before transmissions over them are possible.

-

Passive: The channel does not have to be started before usage. For example File System transmissions can perform
operations without prior activation.

Trax 7.36.0

26

Trax | Administrator (Communications)

Figure 1-24 communication Channel

1.8 Workflow Inventories
The workflow contains incoming and outgoing inventory codes which link the different communication state transitions to
a specific inventory. Every communication state transition then triggers a move for the business entity to the defined
inventory. Depending on the communication direction, incoming or outgoing inventories are used.
In the example below, if the communication gets to status failed, the business object will move to the failed unitary
payments inventory.

Figure 1-25 Workflow inventory codes
The following diagram shows the different state transitions which are possible for sending and receiving communications.

Trax 7.36.0

27

Trax | Administrator (Communications)

Sending

Receiving

Figure 1-26 Communication State Diagram

1.9 Communication Information on Business Objects

Figure 1-27 Enabling Communication
When activating the communication enabled option, a link is laid between the communication information and the
business object (payment, envelope, message, etc. A Communication History tab will appear in the details screen of
the business object, containing communication information (Incoming and Outgoing) of that particular business object. A
(pre)view button is provided to show more details of this communication. The link between the communication
information and the business object is also available on the communication object itself where the corresponding business
object is shown in the Business Entity tab showing the business entity and its unique identifier.

Trax 7.36.0

28

Trax | Administrator (Communications)

Figure 1-28 Example view with communication enabled.

Trax 7.36.0

29

Trax | Administrator (Communications)

2 Incoming Routing
2.1 Introduction
Incoming routing offers a GUI-based routing configuration for incoming messages. The Incoming routing feature allows
the functional administrator to define incoming routing configurations more conveniently and in one place, making the
implementation more efficient. This single configuration place also allows the configuration and activation of additional
features, such as PGP cryptography, compression, encoding management, files script-based pre-processing, etc. The
‘System Administrator’ security profile can configure which incoming files (picked up by a poll job) must be loaded into
which Trax workflow (and how), so the file can be processed accordingly (Configuration > Connectivity > Incoming
routing). Additional payload transformations that can be done, include:
-

Encryption (PGP, CMS, RSA, etc.)

-

Compression (Gzip, ZIP, etc.)

-

Custom pre-processing

Note that, duplicate detection on outgoing files should be done on clean payload ignoring character encoding, zipping,
encryption, cms, etc. (on the communication object).

Figure 2-1: Incoming routing

2.2 Configuration of Incoming Routing Tables
In order to create an incoming routing entry, first, determine which channel and profile will be used. The following actions
are available for incoming routing entries:
1.
2.
3.
4.
5.

View: shows the details of the currently selected incoming routing entry
New: creates a new incoming routing entry
Edit: opens the currently selected incoming routing entry and allows to edit the contents
Delete: deletes the currently selected incoming routing entry
Select All: selects all incoming routing entries

Trax 7.36.0

30

Trax | Administrator (Communications)

Different incoming routing entries can be set up, each for a separate channel and profile. When data is filled out in the
routing criteria, the message/payment must match what is filled out.

Figure 2-2 Incoming routing table
Field

Content

Description

The description is a free-text field which you can use to give a description of the filter. This description
should enable you to identify the filter.

Routing criteria
Channel

The outgoing channel for the payments/messages which match with this filter. This can be EBICS,
file-system, AFT, FTA, etc.. When ‘Manual-Entry’ is selected as channel, it is only possible to set
the priority and ICT.

Profile

The profile is used to set channel-specific properties.

Communication Security
Decryption
method

The encryption method specifies certain properties that are needed to decrypt PGP or CMS packets

Trax 7.36.0

31

Trax | Administrator (Communications)

Field

Content

Sender key

Trax can optionally verify the authenticity of a PGP/CMS signature if the corresponding public key is
available in the system when the signature is verified.
On the incoming routing configuration, only the name of the public key is stored. At runtime, the
system will first attempt to find the active key (based upon name) then the other non-active, valid and
non-revoked in reverse order of date (i.e. newest first)

Allow duplicate

Set to true when the incoming routing can have duplicates

Priority

The priority of an incoming routing channel can be set between 0 and 8, where 8 is the most urgent.
This allows for smarter queuing when necessary. Each created communication object will get a
priority. Values ranging 0-4 are considered normal, 5-8 are high. If no value is configured, 4 is used
by default. The configure script (see below) can be used to make the priority dynamic based on data.

Override

An override script can be selected which allows the user to edit certain parameters of the channel
based on data in the message
(properties of the transmission object).

Routing
Action

Select ‘Workflow’ to load a message that has to be processed by a workflow, or select ‘Data’ to
upload a message that doesn’t need to be processed (e.g.: conversion rates).

Data

This determines which data object will be used to upload the message. The data object contains a
load rule sequence which parses and load the message.

Workflow

This determines to which workflow the message will be routed. The workflow contains the initializer
rule sequence which initializes the business entity and can have an error handler that is called if
there are format errors.

Data owner

The Data owner that needs to be set on the message.

Internal
classification
type

This tags the message with an internal classification type, in order to do some custom classifying
further in the workflow.

Source System

If ‘Workflow’ is selected and ‘BP’, ‘UP’ or ‘ME’ is the workflow of choice the source system can set.

Confidential

When this field is set to true, the message content is marked as confidential. This means that access
to it is limited to those users who have confidential access (this is configured in their user profile).

Trax 7.36.0

32

Trax | Administrator (Communications)

Field

Content

Locked

If ‘Workflow’ is selected and ‘BP’ is the workflow of choice the Locked flag can set. When a BP
envelope is locked, it cannot be modified by end users from the GUI. Manual actions that modify the
BP envelope will be prevented and an error message is shown.
(See 01B.EN.Trax.570.UserGuide.Workflow.Payments.docx for more information about Locked BP
payments)

Auto cancel

Auto cancel is available only for PAY workflow, possible values are:
•

None: invalid payments will not automatically be cancelled

•

Payment: payments going to Invalid due to any debtor or creditor related missing or invalid
data will automatically be cancelled both in PAY-REC and PAY-TRA phase

•

File: all payments belonging to the same input file will automatically be cancelled when one
of them goes to Invalid due to any debtor or creditor related missing or invalid data in PAYREC or PAY-TRA phase. This ‘File’ auto-cancel will only be applied for payments matching
with an outgoing routing in which the ‘Wait for all payment’ option is used as only in that case
we can guarantee that no payment from the input file already has been released or send out

Issues with type "Basic", "Internal", "SwiftRef", "StaticData" or "ISO" are identified as issues caused
by any debtor or creditor related missing or invalid data and as a result will trigger the auto cancel
feature.
Processing history is added to those payments which are auto cancelled.
Manually
accept

Manually accept is available for UP, PAY and AS workflows. Possible values are:
•

No: the payment/statement will not be stopped for manual approval and starts its normal flow
through the workflow.

•

Yes: the payment/statement will be stopped for manual approval into the workflow. Any user
can then accept the incoming payment or cancel it.

•

4 eyes: the payment/statement will be stopped for manual approval in the workflow. Only
another user than the creating user (‘Creator’ involved user) can accept the incoming
payment.

Format
Decompression
method

The decompression method specifies certain properties that are needed decompress messages.

Encoding

Used to decode the incoming flow, using any standard encoding (ISO-Latin, UTF-8, etc.).

Pre-processing

Points to the pre-processing script, used to
1. manipulate the incoming message before it enters the workflows.
2. setting additional characteristics and custom text fields.

Format

The format in which the message will be loaded into Trax. This usually has an underlying iopack
mapper.

Trax 7.36.0

33

Trax | Administrator (Communications)

Field

Content

Format Variant

Some formats can have more than 1 flavor in a single format definition. For example,
pain.001.001.09 can be a CGI variant, a SCORE+ variant or a SEPA variant. Older formats don’t
have the variant property, so the variant is a read-only field on the routings.
If a variant is configured, it influences which XSD will be used during validation, which business
validators are executed, and which mapper will be executed.

Character Map

If specified it will scrub the incoming file based on the char map specified during upload. This
scrubbing will work on the (whole) payload object. This means that you will have to take into account
the format specific markup or tag characters when applying a character map to an incoming file.
Some examples:

Fail on warning

-

If you are scrubbing an input file in XML format you need to specify “<”, “>”,”/” as allowed
characters in character map

-

If you are scrubbing an input file in SWIFT format you need to specify “:”, “/” as allowed
characters in character map

Controls whether the incoming communication fails if there are format warnings.

Table 2-1 Incoming Routing

2.2.1

Overriding

When an override script is selected for an incoming routing channel, various routing parameters can be overruled by this
script. When a file is then loaded through the channel, Trax will first look at the overridden routing parameters to
determine how to handle the file and use the original routing parameters as a fall-back mechanism.
Routing parameter hierarchy used by Trax:
1.
2.
3.
4.

Routing parameters set by override script
Routing parameters set in incoming routing
Routing parameters defined as routing information parameters of incoming routing
Routing parameters from channel (file-system poll job, GUI action, …)

Routing parameters that can be overruled by the script:
•

Priority

•

DecryptionMethod

•

SenderKey

•

DecompressionMethod

•

Encoding

•

DataOwner

•

Confidential

•

PreProcessing

•

ICT

Trax 7.36.0

34

Trax | Administrator (Communications)

•

SourceSystem

•

RuleSequence

•

Format

•

Workflow

The standard product release contains a file system and a TSG example script for overriding the routing parameters set
in the GUI.

2.2.2

(De)compression

Trax can unzip the received payloads, so that the application can accept encrypted files that were sent by the bank. The
sequencing order is the one defined in reference. This is an optional step, defined in the incoming routing table. The
incoming file is unzipped according to the method configured in incoming routing table. Note that in the standard product
release, 3 decompression methods are supported: Gzip, Zip and Autodetect (with which both Zip and GZip compressed
and uncompressed files can be received)..
Conversely, Trax can also zip the payload that is about to be sent out, so that the payload takes up less network bandwith
and can unzipped by the counterparty. The sequencing order is the one defined in reference. This is an optional step,
defined in the Outgoing Routing table. The payload is compressed according to method configured in outgoing routing
table. Note that in the standard product release, only GZip and Zip is supported for this feature.

2.2.3

Encoding

The ‘System Administrator’ security profile can configure the encoding used for reading files and for writing out
representations, so that the encoding is consistent with how the backoffice system gives it to Trax and how the receiver
wants to receive it.
1. The encoding used for reading in files is mandatory and must be configured in incoming routing. The default
value is set to UTF-8. The encoding is stored on the communication object.
2. The encoding used for writing out representations is mandatory and must be configured in outgoing routing.
The default value is set to UTF-8. The encoding is stored on the communication and also stored along with
the representation.
3. The encoding stored with the representation is used to preview and save that representation to disk (‘save
as’ action).

Trax 7.36.0

35

Trax | Administrator (Communications)

Figure 2-3: Encoding

2.2.4

Format errors

In case of format errors, the error handler rule sequence of the workflow is called and the format errors are copied to

Trax 7.36.0

36

Trax | Administrator (Communications)

3 Outgoing Routing
3.1 Introduction
At the end of a workflow, payments, statements or messages are sent using the matching outgoing routing configuration.
Outgoing routing tables determine how messages, payments, statements and workflows are approved and how and
where they are sent.
Such a table consists first of all of a filter and a set of attributes that are applied if a match is found. Outgoing routing
tables only apply to the following outgoing workflows: Payments, Account Statements and the Message workflow. The
outgoing routing feature allows the functional administrator to define outgoing routing configurations more conveniently
and in one place, making the implementation more efficient.
Setting up an outgoing routing entry minimally requires that a workflow is selected to filter the value objects. The workflow
value is set on each value object when being loaded into the system. Depending on the workflow, additional filtering can
be done like specifying the format and/or bank or account group. Any other attribute of the value object can be selected
via the filter tree in the Advanced criteria tab.
It is possible to setup multiple outgoing routing entries. All of them are evaluated when looking for possible matches. If
none or multiple matches are found, the payment, envelope or message moves to the invalid repository. Account
statements move to Failed publication if no match is found. In case of multiple routing matches, account statements will
be published multiple times to these according routings.
Note: outgoing routings for statements (AS, ID and DC) don’t fail if there is more than one matching routing. They will
publish statements to ALL matching routing entries as these workflows are able to do ‘multi-publish’

3.2 Configuration of Outgoing Routing Tables
In order to create an outgoing routing entry, first, determine for which workflow the routing entry is.
The following actions are available for routing table entries
1. View: shows the details of the currently selected routing entry
2. New: creates a new routing entry and places it last in the list of routing entries
3. Edit: opens the currently selected routing entry and allows to edit the contents
4. Delete: deletes the currently selected routing entry
5. Select All: selects all entries
Different outgoing routing tables can be set up, each for a separate rule in the workflow. When data is filled out in the
routing criteria, the message/payment/statement must match what is filled out. Fields which are empty will always match.

Trax 7.36.0

37

Trax | Administrator (Communications)

Trax 7.36.0

38

Trax | Administrator (Communications)

Trax 7.36.0

39

Trax | Administrator (Communications)

Figure 3-1 Outgoing routing table
Field

Content

Code

Unique code for the outgoing routing

Description

The description is a free-text field which you can use to give a
description of the filter. This description should enable you to identify
the filter.

Routing criteria
Account Group
(only for statement
workflow types)

The matching account group to which the account of the account
statement belongs.

Trax 7.36.0

40

Trax | Administrator (Communications)

Field

Content

Active account

Can be used to filter on active/inactive static data accounts.

(only for statement
workflow types)
Account type

Can be used to filter on the static data account type.

(only for statement
workflow types)
Account sub type

Can be used to filter on the static data account sub type.

(only for statement
workflow types)
Currency

Can be used to filter on the static data account currency.

(only for statement
workflow types)
Ordering bank

The ordering customer account static data bank must match the bank
selected here.
For ME-OUT/ME-IN, the bank could also match with the destination
in case no static data link is available.

Ordering bank
group

Matches if the ordering customer account static data bank of the
workflow object exists in the group.

Ordering holder

The ordering customer account static data holder must match the
holder selected here.

(only for statement
workflow types)
Ordering holder
group

Matches if the ordering customer account static data holder of the
workflow object exists in the group.

(only for statement
workflow types)
Duplicate

Can be used to filter on duplicate statements.

(only for statement
workflow types)
ICT

Matches the internal classification type of the workflow object.

ICT group

Matches if the internal classification type of the workflow object exists
in the group.

CEV classification

Matches the CEV classification of the workflow object.

Source system

Matches the source system of the workflow object.

Data owner

Matches the data owner of the workflow object.

Advanced criteria

Trax 7.36.0

41

Trax | Administrator (Communications)

Field

Content

Filter

The filter can be used to create custom filtering criteria in case the
above does not suffice as criteria.

Routing
Routing Information
Channel

The outgoing channel for the payments/messages which match with
this filter. This can be EBICS, FTP, file-system, no output, etc.

Profile

The profile is used to set channel-specific properties.

Data owner

This data owner will be set on all outgoing envelopes routed via this
outgoing routing.
NOTE: only available in the “Payments” workflow. It will be disabled
when the grouping criteria “Data owner payment” or “Data owner
static data” is selected

ICT

This ICT will be set on all outgoing envelopes routed via this
outgoing routing.
NOTE: only available in the “Payments” workflow. It will be disabled
when the grouping criteria “ICT” is selected.

Format
Target format

The format how the workflow object is sent out can be set here. The
format specified here will be set in case the target format was not yet
filled up.
In case no target format is setup the source format will be used as
the target format.

Format variant

Some formats can have more than 1 flavor in a single format
definition. For example, pain.001.001.09 can be a CGI variant, a
SCORE+ variant or a SEPA variant. Older formats don’t have the
variant property, so the variant is a read-only field on the routings.
If a variant is configured, it influences which XSD will be used during
validation, which business validators are executed, and which
mapper will be executed.

Contract

Depending on the target format, information (e.g. ordering customer
account) can be present on the payment or batch level. Trax has a
default configuration for each format. If a certain bank deviates from
it, a contract can be used. That contract can then overwrite the
default Trax configuration.
NOTE: only available in the “Payments” workflow.

Post processing

Points to the post-processing script, used to manipulate the outgoing
message representation before it is sent out.

Encoding

Used to encode the outgoing flow, using any standard encoding
(ISO-Latin, UTF-8, etc.).

Trax 7.36.0

42

Trax | Administrator (Communications)

Field

Content

Grouping (only available for Payment Factory workflow and statement workflow types)
Grouping type
(Payment Factory)

Single Payment
the workflow object will be sent out ungrouped
Single Batch
the workflow object will be sent to the ‘waiting grouping’ repository
from where the PAY-group-payments job will send them all out
grouped with one batch envelope.
Single Payment per Batch
the workflow object will be sent to the ‘waiting grouping’ repository
from where the PAY-group-payments job will send them all out
grouped with one payment per batch envelope
Multi Batch
the workflow object will be sent to the ‘waiting grouping’ repository
from where the PAY-group-payments job will send them all out
grouped with multiple batch envelopes.

Grouping type
(statement
workflow types)

Statement
each publication will only contain one statement. In other words, no
grouping is done. This results in a separate outgoing file for each
statement.
Account
statements from the same static data account are grouped into one
publication. This results in a separate outgoing file for each static
data account.
Incoming file
statements from the same incoming file are grouped into one
publication. This results in a separate outgoing file for each incoming
file
All
all statements are grouped into one publication. This results in a
single outgoing file.

Schedule

The schedule field specifies at what time and what day the payments
must be grouped together. When clicking on this field a screen pops
up where you can enter the CRON expression. The field is read-only
when Single payment is selected as grouping type and thus can only
be used with Single batch and Multi batch. After setting this, make
sure that the Scheduler service, in internal services, is started or
restarted.

Trax 7.36.0

43

Trax | Administrator (Communications)

Field

Content

Max. payments
(Payment Factory)

If grouping type Single Batch, Multi Batch or Single Payment per
Batch is selected this limit can specify the maximal number of
payments within a file. In the case of Single Payment per Batch the
maximum is hard coded to prevent performance issues.

Grouping criteria
(Payment factory)

When enabling a grouping criterion, file level outgoing envelopes will
be grouped using this criterion and this criterion will be set on all
outgoing envelopes. Currently the following criteria are available:
•

Currency

•

Data owner payment

•

Data owner static data

•

ICT

•

CEV classification

•

Source system

•

Incoming file

•

Wait for all payments until they are in:
State: To be released
To be released or cancelled
To be released, cancelled or exception handling

•

Intercompany

•

Confidential

Data security
Communication properties
Encryption method

The encryption method specifies certain properties that are needed
to encrypt, and optionally compress and sign the PGP or CMS
packets. Only active encryption methods with direction ‘Out’ can be
chosen.

Receiver key

The counterparty’s public key must be specified via the “Receiver
Key” field. This key will be used to encrypt the data.
On the configuration, only the name of the public key will be stored.
At runtime, the system will attempt to find the active public key based
upon the name.

Compression
method

The compression method specifies certain properties that are
needed to compress the outgoing messages.

Allow duplicate

Allowing duplicate outgoing messages

Signature (only for payment or message workflow types)

Trax 7.36.0

44

Trax | Administrator (Communications)

Field

Content

Signing method

The signing method is determined here (for more information, please
refer to the chapter on signing). Possible options are no authentication,
password or one of the supported hardware tokens.

External signature

If enabled, an external signature will be created that is sent to the
bank. Options are “SWIFT 3SKey”, “XML signature” or none.
For any signing method, XML signature can be chosen to add an
enveloping XML digital signature to the outgoing message. It will
use XML-DSIG secret key(s) to sign. This XML-DSIG secret key
needs to be assigned to the signing user. If the user that signed
does not have an XML-DSIG key assigned to it, no XML signature
will be made for that user. If multiple users have signed, the
enveloping XML digital signatures will be made in the same order
as the approvals. It is not allowed to assign an XML-DSIG key to
more than one user. In contrast to other secret keys, there is no
“system default” key, so XML-DSIG keys do not need to be marked
as “active” in Trax.
The “SWIFT 3SKey” option can only be used in combination with
the “SWIFT 3SKey” signing method. If enabled, the signatures
made by the SWIFT token will be sent to the bank together with the
payload in a CMS message.

Table 3-1 Outgoing Routing

Tab Routing parameters: here, special key-value pairs can be set, these values depend on the chosen channel
For account statements following codes can be used to filter on CEV Classification or ICT
Code

Description

Example

mappingParam.filte
rOnCEVClassificati
on

Filter on CEV classification
at account statement level.
Can only be used for
CSV_BSE output.

Can be used to filter on the CEV
classification “backoffice_1” to only
publish account statement details
who’s above lying account statement
is tagged with this value

mappingParam.filte
rOnICT

Filter on ICT at account
statement detail level. Can
only be used for CSV_BSE
output.

Can be used to filter on the internal
classification type “backoffice_2” to
only publish account statement
details tagged with this value

Alternatively, these two codes can also be saved as Format definition parameters under Format definition

Trax 7.36.0

45

Trax | Administrator (Communications)

4 Workflow Notification
4.1 Introduction
Workflow transitions can initiate one or multiple notifications. These are configured in ‘Workflow Notification’.
Workflow notification tables determine how and where notifications are sent to.
Such a table consists first of all of a filter and a set of attributes that are applied if a match is found. Workflow notification
tables only apply to the following workflows: Payments (Unitary Payments, Bulk Payments and Payment Factory) and
Deal Confirmations. The workflow notification feature allows the functional administrator to define notification
configurations more conveniently and in one place, making the implementation more efficient.
Setting up a workflow notification entry minimally requires that a workflow is selected to filter the value objects. The
workflow value is set on each value object when being loaded into the system. Additional filtering must be done by
specifying the notification state (repository) and additionally, for Unitary and Bulk Payments, a transformer is selected.
Any other filtering attribute of the value object can be selected via the filter tree in the Advanced criteria tab.
It is possible to setup multiple matching entries.

4.2 Configuration of Workflow Notification Tables

Trax 7.36.0

46

Trax | Administrator (Communications)

Figure 4-1 Workflow notification table
Field

Content

Code

Unique code for the workflow notification

Description

The description is a free-text field which you can use to give a
description of the filter. This description should enable you to identify
the filter.

Routing criteria
Workflow

This is the main criteria and determines to which workflow this
notification entry applies. The selected workflow determines the
subject of the filter tree in the Advanced tab.

Notification

The matching notification/state (repository) for which a notification
should be sent.

Transformer (not
available for
workflow PAY and
DLC)

The optional transformer which will transform the workflow object into
another form which will be sent out. The selected transformer will
change the subject of the filter tree if applicable. The filter tree will
work on the transformed objects.

Trax 7.36.0

47

Trax | Administrator (Communications)

Field

Content

Advanced criteria

Filter

The filter can be used to create custom filtering criteria in case the
above does not suffice as criteria.

Routing
Routing Information
Channel

The notification channel for the payments/messages which match
with this filter. This can be EBICS, FTP, file-system, no output, etc.

Profile

The profile is used to set channel-specific properties.

Format
Target format

The format how the workflow object is sent out can be set here. The
format specified here will be set in case the target format was not yet
filled up.
In case no target format is setup the source format will be used as
the target format.

Post processing

Points to the post-processing script, used to manipulate the outgoing
message representation before it is sent out.

Encoding

Used to encode the outgoing flow, using any standard encoding
(ISO-Latin, UTF-8, etc.).

Data security
Communication properties
Encryption method

The encryption method specifies certain properties that are needed
to encrypt, and optionally compress and sign the PGP or CMS
packets

Receiver key

The counterparty’s public key must be specified via the “Receiver
Key” field. This key will be used to encrypt the data.
On the configuration, only the name of the public key will be stored.
At runtime, the system will attempt to find the active public key based
upon the name.

Compression
method

The compression method specifies certain properties that are
needed to compress the outgoing messages.

Table 4-1 Workflow Notification

Tab Notification parameters: here, special key-value pairs can be set and passed to a post processing script.

Trax 7.36.0

48

Trax | Administrator (Communications)

4.3 Workflow notification exceptions
Not every payment state/repository is supported to trigger a Workflow Notification. Below is a table with
states/repositories explicitly omitted from the configuration screen.

Figure 4-3 Workflow notification exceptions table
Workflow

State/Repository

UP

UP_PMT_SF_ACCEPTED
UP_PMT_SF_CANCELLED
UP_PMT_SF_CHANGED
UP_PMT_SF_PENDING
UP_PMT_SF_RECEIVED
UP_PMT_SF_REJECTED
UP_PMT_EXTERNAL_SUSPECT

BP

BP_PMT_SF_ACCEPTED
BP_PMT_SF_CANCELLED
BP_PMT_SF_CHANGED
BP_PMT_SF_PENDING
BP_PMT_SF_RECEIVED
BP_PMT_SF_REJECTED
BP_PMT_EXTERNAL_ACCEPTED
BP_PMT_EXTERNAL_REJECTED
BP_PMT_EXTERNAL_SUSPECT
BP_PMT_REJECTED_MAN

PAY

PAY_PMT_REC_IMPORTED
PAY_PMT_REC_ACCEPTED
PAY_PMT_REC_VALIDATED
PAY_PMT_SF_ACCEPTED_ACCP
PAY_PMT_SF_ACCEPTED_ACSP
PAY_PMT_SF_ACCEPTED_ACSC
PAY_PMT_SF_ACCEPTED_ACTC
PAY_PMT_SF_CANCELLED

Trax 7.36.0

49

Trax | Administrator (Communications)

Workflow

State/Repository
PAY_PMT_SF_CHANGED
PAY_PMT_SF_PENDING
PAY_PMT_SF_RECEIVED
PAY_PMT_SF_REJECTED
PAY_PMT_REL_EXTERNAL_ACCEPTED
PAY_PMT_REL_EXTERNAL_REJECTED
PAY_PMT_REL_EXTERNAL_SUSPECT
PAY_PMT_REL_REJECTED_MAN

Trax 7.36.0

50

Trax | Administrator (Communications)

5 Pre/Post Processing Script
5.1 Introduction
Groovy pre and post-processing was present for “classic” formats in Trax for years. It was however not usable for the
“XML” formats, or in the message workflow. This is now made available for all formats, in order to support format changes
without having to redeploy Trax. While not suitable for all kinds of transformations, Groovy scripts are extremely handy to
do some basic search&replace, or to handle bank format flavors that do not comply with the official format specifications.
XSLT scripts on the other hand are handy to manipulate XML formats before intake in a workflow or routing out of Trax.

5.2 Configuration
Make sure the Security profile with code ‘AC’ and Name ‘Advanced Configuration’ has been added to the User profile of
the Groovy rules editor.

Figure 5-1 Add the AC Security Profile to the User Profile of choice
Via the configuration of the entity ‘Message Script’, Audit can be enabled and e.g. Four eyes Change approval can be
added.

Trax 7.36.0

51

Trax | Administrator (Communications)

Figure 5-2 Activate Change Approval on the Message Script entity
For the user that has the Security Profile AC, a new folder is available in the navigation pane with the name Advanced
configuration. Within this folder the inventory items “Workflow scripts” are present.
Under System settings, Workflow scripts a list of sample scripts is available. For each script the menu items View, New,
Edit, Delete, and Copy are available. More information about the meaning and use of the sample scripts and how to adapt
to a specific case can be found under the corresponding section of the documentation.
A script can be used in 3 locations:
-

Incoming/Outgoing routing/Workflow notification format: adapting a Communication before intake into a workflow or
writing out. Script Usage is ‘Format’. You can choose between an XSLT script or a Groovy script as Script Type.

-

Incoming routing priority override: assign a custom priority based on a Groovy script. Script Usage is ‘Communication’
and Script Type is ‘Groovy’.

-

GroovyRule: Script Usage is ‘Rule’ and Script Type is ‘Groovy’.

Trax 7.36.0

52

Trax | Administrator (Communications)

Figure 5-3 Sample scripts
In case of 4 eyes approval a new, edited or deleted script should be approved by another user. The pending scripts can
be found under Advanced configuration > Audit > Pre-/post-processing scripts.
Once the script has been saved and approved it needs to be assigned, in case of a pre-processing script to an Incoming
routing entity, for post-processing to an Outgoing routing and/or Workflow notification entity.
Open the Incoming routing entity, select edit, in the input field Pre-processing select the script by clicking the magnifier
icon. After saving the Incoming routing item (by clicking OK or Apply) the pre-processing script becomes active and will
be used for all the files that pass through this Incoming routing.

Figure 5-4 Activating pre-processing in Incoming Routing

Trax 7.36.0

53

Trax | Administrator (Communications)

For the Post-processing open the concerned Outgoing routing or Workflow notification item, edit the Post processing by
selecting the post-processing script.

Figure 5-5 Activating post-processing in outgoing routing
After the successful or unsuccessful execution of the groovy script the execution result is shown in the communication
history for pre-processing scripts and in the processing history for post-processing.
The communication and processing history can be opened via the Workflow of the concerned processed item.
Timestamp, name of the script, execution result and runtime are shown.

Figure 5-8 Communication History on script execution

Trax 7.36.0

54

Trax | Administrator (Communications)

Figure 5-9 Processing History on script execution

5.3 Groovy Scripts
5.3.1

General

Trax supports Groovy scripts for pre-processing received files or post-processing on files to send out.

5.3.2

Guidelines

The following bind variables are accessible in the Groovy script:
Name

Groovy Type

Description

context

Reader

The input data, presented as a (character)
reader

params

Map

Input parameters (optional)

log

org.apache.log4j.Logger

Can be used to write log lines to the
script.log file

runScript

Closure

Execute another Script instance, either
Groovy or XSLT and returns the output of
the executed script. Arguments: script name
and input. Execution can be chained (see
samples).

See 03A.EN.Trax.xxx.UserGuide.Admin1.Generic.pdf, Chapter 18. Groovy for details on Groovy scripting.
The Groovy script is expected to return a Reader (not returning anything or returning null will result in an exception). For
example, to return the input without changes, simply return context.
The params map will also contain the original textHandle. When the input reader has been consumed one can always
call params.textHandle.reader to get the original reader.
The Groovy script can set:

Trax 7.36.0

55

Trax | Administrator (Communications)

•

additional characteristics

•

custom text fields

•

attributes

using the following notation:
Additional
Characteristics

params.additionalCharacteristic.type=value
where type is the additional characteristics type.

Custom text fields

params.customField.textX=value
where X is a number from 1 to 30.

Attributes

params.root.JXPathExpression=value
where JXPathExpression is a valid JXPath expression
that points to the attribute. If your expression contains a
‘/’ character you will need to use the params put()
method to add the expression.
params.root.ownReference=”reference”
params.root.put(”amount/currencyCode”, ”USD”)

5.4 XSLT Scripts
5.4.1

General

Trax supports XSLT 1.0 scripts for pre-processing received files or post-processing on files to send out. Processed files
should be in XML format. For security reasons XSLT 2.0 is not supported.

5.4.2

Guidelines

In order to speed up XML file processing using XSLT, set up your stylesheets to function efficiently (avoid the complete
XML to be put into memory):
•

Don't use "//" (descendant axes) patterns near the root of a large document.

•

Use xsl:key elements and the key() function as an efficient way to retrieve node sets.

•

Where possible, use pattern matching rather than xsl:if or xsl:when statements.

•

xsl:for-each is fast because it does not require pattern matching.

•

Keep in mind that xsl:sort prevents incremental processing.

•

When you create variables,
<xsl:variable name="fooElem" select="foo"/>
is usually faster than
<xsl:variable name="fooElem"><xsl:value-of-select="foo"/></xsl:variable>

•

Be careful using the last() function.

•

The use of index predicates within match patterns can be expensive.

•

Decoding and encoding is expensive.

Trax 7.36.0

56

Trax | Administrator (Communications)

5.5 Scripts included in Trax
5.5.1

Product scripts

5.5.1.1 FINTextBlockExtractor
Most Trax SWIFT FIN formats expect the SWIFT FIN message without headers and trailers (i.e. only the text block or
block 4). This pre-processing script extracts the text block (block 4) from a SWIFT FIN message. It can also handle
multiple SWIFT FIN message within a single file.

5.5.1.2 pain.001.001.03_SCT_Extraction
This script extracts global information from the pain.001.001.03_SCT format in the Message mini model. It helps to better
visualize what is being sent to the bank.
This script will extract information only from the first batch, so ideally it should be used with files containing only one
batch.

5.5.1.3 pain.008.001.02_SDD_Extraction
This script extracts global information from the pain.008.001.02_SDD format in the Message mini model. It helps to better
visualize what is being sent to the bank.
This script will extract information only from the first batch, so ideally it should be used with files containing only one
batch.
Note: All the product scripts excluding the ones used in rule sequences are non-editable (Locked). No modification can be
made on those scripts. If any changes are required, then that specific script can be cloned using ‘clone’ action and can be
modified and saved with a meaningful name

Trax 7.36.0

57

Trax | Administrator (Communications)

5.5.1.4 CashFlowToQID
Converts a Trax cash flow publication to Quantum QID format.
Sample output:
EXENAME=CFLOPROJ
$DoMenu=actual
deal_dt=20220509 09:58:35
settle_dt=09-05-2022
cparty=BNPA Fortis
instrument=
face_value=1.00
ccy=EUR
face_value_2=1.00
ccy_2=EUR
debit_credit_mark=debit
entity=ACME-Shipping-Europe
accountnumber=BE48001123456727
ticket_no=
comment=
$DoMenu=mfinsert

Trax 7.36.0

58

Trax | Administrator (Communications)

5.5.1.5 CashFlowToJSON
Converts a Trax cash flow publication to JSON format.
Sample output:
{
"ticketNumber": "",
"instrument": "",
"dealDate": "20220509 10:16:06",
"valueDate": "09-05-2022",
"currency": "EUR",
"amount": "1.00",
"paymentReceive": "Payment",
"cashFlowMode": "actual",
"otherCurrency": "EUR",
"bank": "BNPA BE",
"counterpartyReference": "test",
"entity": "ACME-Shipping-Europe",
"accountNumber": "BE48001123456727",
"paymentMethod": ""
}

5.5.2

Sample scripts

These sample scripts can be used as a starting point for your own pre-/post-processing scripts or split scripts, which are
used for integration channel.

5.5.2.1 FindAndReplace
This sample script uses a regular expression to replace UNIX line endings (LF) with Windows line endings (CRLF). This
script is not suitable for large files (input is taken entirely into memory).
// Read input (type Reader) into a String
def input = context.text
// Pattern to find: ~/regex/
def pattern = ~/\n/
// Replacement text : 'text'
def replacement = '\r\n'
// Return new reader with the replaced text
new StringReader(input.replaceAll(pattern, replacement))

5.5.2.2 FindAndReplaceLargeFiles
This sample script performs character scrubbing (1:1 character replacement). This script is suitable for large files (stream
processing without taking the entire file into memory).
// Character mapping (of type Map&lt;String, String&gt;)
def mapping = ['a':'1', 'b':'2', 'c':'3', 'd':'4', ' ':'_']
// Return a chained reader which translates each character
new FilterReader(context) {
@Override
public int read(char[] buffer, int offset, int length) throws IOException {
// Read characters from chained reader
def count = super.read(buffer, offset, length)
if (count &gt; 0) {
// Loop over each character
for (i in offset..&lt;(offset + count)) {

Trax 7.36.0

59

Trax | Administrator (Communications)

// Original character
def ch = buffer[i]
// Lookup replacement character
def replace = mapping[ch as String]
// Replace if not null
if (replace) {
buffer[i] = replace
}
}
}
// Return number of characters read
count
}
}

5.5.2.3 PruneBelowEntryLevel
Given a big camt.053 file, prune excessive data.
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
<!-- exact copy of original xml -->
<xsl:template match="node()|@*">
<xsl:copy>
<xsl:apply-templates select="node()|@*"/>
</xsl:copy>
</xsl:template>
<xsl:template match="//*[name()='Ntry']/*[name()='NtryDtls']"/>
</xsl:stylesheet>

5.5.2.4 PromoteReference
Take a reference at payment level and promote it to Envelope level.
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
<xsl:template match="node() | @*">
<xsl:copy>
<xsl:apply-templates select="node() | @*"/>
</xsl:copy>
</xsl:template>
<xsl:template
match="/*[name()='Document']/*[name()='CstmrCdtTrfInitn']/*[name()='GrpHdr']/*[name()='MsgId']/text()">
<xsl:value-of
select="/*[name()='Document']/*[name()='CstmrCdtTrfInitn']/*[name()='PmtInf'][1]/*[name()='PmtInfId']"/>
</xsl:template>
</xsl:stylesheet>

5.5.2.5 Pain00100102ToPain00100103WithoutZCharacterConversion
Combining Groovy and XSLT scripts
def output = runScript "SamplePain00100102ToPain00100103Conversion", context
runScript "RemoveZCharacterFromISOTimeStamp", output

5.5.2.6 Camt054V1ToV2Preprocessor
Sample to convert Camt054 V1 content to Camt054 V2 content.
builder.build(context)

Trax 7.36.0

60

Trax | Administrator (Communications)

5.5.2.7 Camt054V2ToV1Postprocessor
Sample to convert Camt054 V2 content to Camt054 V1 content.

5.5.2.8 GroovyQIDCashflowNotificationPAY
Sample to create a QID publication for a payment.

5.5.2.9 MT940Aggregation (post-processing)
Aggregates statement entries of MT940’s based upon account and bank transaction type.
Accounts that need to be aggregated are defined in the MT940Aggregation account group.
Transaction codes (for the accounts in the account group) that need to be aggregated are defined in the
MT940Aggregation code list, tagged with the bank code
Note: bank code cannot contain a comma.

5.5.2.10 SplitByDelimiter
Splits incoming communication into multiple child communications in the integration channel, based on a delimiter
parameter. The parameter ‘delimiter’ is required and can be configured in the integration channel incoming profile.
Another optional parameter ‘keepDelimiter’ configures if the delimiter is included in the child communications or not by
setting a true/false flag. If the parameter ‘keepDelimiter’ is not configured, the delimiter is included by default.

5.5.2.11 SplitPainMessagesScript
Splits an incoming pain message with multiple “PmtInf”-tags and wraps the header and footer around each single pain
payment and puts each payment in a single tranmission. No parameters are required for this script.

5.6 Logging
By default, all script-related logging will be written to the dedicated script.log file. The bind variable log can be used within
your Groovy script to write log files to this default log file. For example:
// My Groovy pre-processing script
log.debug('This is a debug-level log line')
log.info('this is an information-level log line')

Trax 7.36.0

61

Trax | Administrator (Communications)

6 Cryptography
6.1 Configuration
In order to generate secret keys with a high key size, the Java Cryptography Extension (JCE) Unlimited Strength
Jurisdiction Policy Files need to be installed. This is already done on the JRE that is shipped with Trax. If Trax doesn’t
use the shipped JRE, the download containing instructions for the installation of the Java Cryptography Extension (JCE)
Unlimited Strength Jurisdiction Policy Files can be found here:
http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html.

6.1.1

Importing public keys

Trax uses PGP or CMS public keys
1. To encrypt data that only a specific counterparty can decrypt
2. To verify the authenticity of an optional signature.

6.1.1.1 PGP
The “System Administrator” security profile can import public keys via the “Import public keys” action that is available in
the “PGP Public Keys” inventory and via the ‘import’ webservice (http://host:8080/webservice/import?WSDL). Trax
supports both OpenPGP-compliant key ring files and exported key files. Keys can be imported in binary format or as
ASCII-armored text files.
Following algorithm/key-length combinations are supported
1. RSA: 1024, 2048, 3072 and 4096
2. DSA/Elgamal: 1024, 2048 and 3072
A new “Public Key” entry is created for each master key including its optional sub-keys that are available in the imported
file. Sub-keys with no master key are also stored separately.

6.1.1.2 CMS
The ‘System Administrator’ security profile can import certificates via ‘Import certificates’ action that is available in the
‘CMS Public Keys’ inventory and via the ‘import’ webservice (http://host:8080/webservice/import?WSDL). Trax supports
DER (binary) as well as PEM(Base64) certificate files.
Following algorithm/key-length combinations are supported
-

RSA : 1024, 2048, 3072 and 4096

A new ‘Public key’ entry is created for the certificate which was present in the imported file.

6.1.1.3 Webservice
To be able to use the webservice to import a public key, set up a ‘Web service incoming profile’ in ‘Config>IncomingRouting’.

Trax 7.36.0

62

Trax | Administrator (Communications)

Make an incoming routing entry using the ‘Web-Service’ channel and the created profile. Use ‘Data’ as action and

‘PublicKey’ as data.
Make a SOAP request with the created profile and attach a base64 encoded public key as data. Following parameters
can be set:
•

Type: PGP or CMS

•

Name: override the name/alias from the key with this value (optional)

•

Active: true or false (optional, default = false)

Example:
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:fil="http://fileupload.webservice.util.trax.com/">
<soapenv:Header/>

Trax 7.36.0

63

Trax | Administrator (Communications)

<soapenv:Body>
<fil:import>
<profile>ImportPublicKey</profile>
<data>cid:pub.pgp</data>
<!--Zero or more repetitions:-->
<parameter>
<code>type</code>
<!--Optional:-->
<value>PGP</value>
</parameter>
<parameter>
<code>active</code>
<!--Optional:-->
<value>true</value>
</parameter>
<parameter>
<code>name</code>
<!--Optional:-->
<value>SAP</value>
</parameter>
</fil:import>
</soapenv:Body>
</soapenv:Envelope>

6.1.2

Importing secret keys

Trax uses PGP, CMS and XML-DSIG secret keys
1. To decrypt data that was encrypted by a counterparty using the corresponding public key
2. To generate a signature so that a counterparty can verify its authenticity via the corresponding public key.

6.1.2.1 PGP
The “System Administrator” security profile can import an externally generated set of secret keys via the “Import secret
keys” action that is available in the “PGP Secret Keys” inventory. These keys can either be OpengPGP-compliant key ring
files or imported key files. Keys can be exported in binary format or as ASCII-armored text files.
Following algorithm/key-length combinations are supported
1. RSA: 1024, 2048, 3072 and 4096
2. DSA/Elgamal: 1024, 2048 and 3072

6.1.2.2 CMS and XML-DSIG
The System Administrator security profile can import an externally generated keystore via ‘Import secret keys’ action that
is available in the ‘CMS Secret keys’ inventory. The supported keystores are PKCS11 and PFX which contain key
certificate pair.
Following algorithm/key-length combinations are supported
1. RSA: 1024, 2048, 3072 and 4096

6.1.2.3 Webservice
To be able to use the webservice to import a secret key, set up a ‘Web service incoming profile’ in ‘Config>IncomingRouting’.

Trax 7.36.0

64

Trax | Administrator (Communications)

Make an incoming routing entry using the ‘Web-Service’ channel and the created profile. Use ‘Data’ as action and
‘SecretKey’ as data.

Make a SOAP request with the created profile and attach a base64 encoded secret key as data. Following parameters
can be set:
-

type: PGP or CMS

-

name: override the name/alias from the key with this value (optional)

-

active: true or false (optional, default = false)

-

password: secret key password (for CMS)

Example:

Trax 7.36.0

65

Trax | Administrator (Communications)

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:fil="http://fileupload.webservice.util.trax.com/">
<soapenv:Header/>
<soapenv:Body>
<fil:import>
<profile>ImportSecretKey</profile>
<data>cid:secring.pgp</data>
<!--Zero or more repetitions:-->
<parameter>
<code>type</code>
<!--Optional:-->
<value>PGP</value>
</parameter>
<parameter>
<code>active</code>
<!--Optional:-->
<value>true</value>
</parameter>
<parameter>
<code>name</code>
<!--Optional:-->
<value>SAP</value>
</parameter>
<parameter>
<code>password</code>
<!--Optional:-->
<value>password</value>
</parameter>
</fil:import>
</soapenv:Body>
</soapenv:Envelope>

6.1.3

Generating secret keys

Trax can also generate a set of secret keys for encryption and signing purposes. This can be done by the “System
Administrator” security profile via the “Generate Key” action that is available in the “PGP Secret Key”, “CMS Secret Key”
and “XML-DSIG Secret Key” inventories.
XML-DSIG secret keys can be assigned to signing users. This will be used when creating an outgoing message with
external XML signature.
Only RSA keys can be generated in all supported key-lengths. For PGP, DSA/Elgamal combinations can be generated
externally (e.g. GnuPG) and imported afterwards. GnuPG v2 is default version.

Figure 6-1 Generate key

Important note: keys generated by Trax are intended for securing back office communications only. Whenever encrypting
bank communications and keys needs to adhere to bank-specific requirements, FIS recommends to use the customer’s

Trax 7.36.0

66

Trax | Administrator (Communications)

own PKI infrastructure or 3th party tools like GnuPG to generate these keys to match the bank requirements.

6.1.4

Exporting public keys

6.1.4.1 PGP
All public keys that are available in the system can be exported via the “Export public keys” action that is available to the
“System Administrator” security profile in the “PGP Public Keys” inventory.
Multiple public keys can be exported in a single binary file. This file is OpenPGP-compliant and can be imported in
external tools or key rings.

6.1.4.2 CMS
All CMS certificates that are available in the system can be exported via the ‘Export certificates’ action that is available to
the ‘System Administrator’ security profile in the ‘CMS Public Keys’ inventory.

6.1.5

Extracting public keys from secret keys

6.1.5.1 PGP
Public keys (both GnuPGv1 and GnuPGv2) can be extracted from all available secret keys and exported as an
OpenPGP-compliant export file. This is necessary to provide counterparties with the correct public keys to encrypt data or
to verify the authenticity of a previously generated PGP signature.
This can be done via the “Export public keys” action that is available to the “System Administrator” security profile in the
“PGP Secret Keys” inventory.

6.1.5.2 CMS and XML-DSIG
Certificates can be extracted and exported from all available keystores and exported as CER certificate file. This is
necessary to provide counterparties with the correct public certificates to encrypt data or to verify the authenticity of
previously generated CMS signature.
This can be done via the ‘Export certificates’ action that is available to the ‘System Administrator’ security profile in the
‘CMS Secret Keys’ inventory.

6.1.6

Exporting secret keys

6.1.6.1 PGP
All secret keys (both GnuPGv1 and GnuPGv2) that are available in the system can be exported via the “Export secret
keys” action that is available to the “System Administrator” security profile in the “PGP Secret Keys” inventory.
Multiple secret keys can be exported in a single binary file. This file is OpenPGP-compliant and can be imported in
external tools or key rings.

6.1.6.2 CMS and XML-DSIG
All secret keys that are available in the system can be exported via the ‘Export secret keys’ action that is available to the
‘System Administrator’ security profile in the ‘CMS Secret Keys’ and ‘XML-DSIG Secret Keys’ inventory.

6.1.7

Activating a public or secret key

Before Trax can generate a PGP, CMS or XML-DSIG signature, an active secret key must be present in Trax or a user
must be assigned to the secret key.
Signing can be done with active secret key or with 1 or more keys that are assigned to signing users. These options are
configured in the outgoing encryption method and outgoing routing.

Trax 7.36.0

67

Trax | Administrator (Communications)

Following options are present for the outgoing encryption method CMS or PGP:
•

In case of CMS the signature type can only be of type ‘Attached’ and the active CMS key in Trax will be selected.
It’s not possible to specify another.

•

In case of PGP the signature type can be ‘Attached’ or ‘Detached’.
•

Attached: a specific secret key can be selected or the option ‘Use system secret key’ can be checked.

•

Detached: a specific key can be selected or ‘Use system secret key’ can be checked. When none of these 2
options is chosen the secret keys assigned to the signing users will be used. In that case a signature is made
for each signing user. Each signing user of a business object should always be linked to exactly 1 secret key.

For XML-DSIG, no signature will be created for the message. The key can be selected in outgoing routing, tab ‘Data
security’
For validating a PGP or CMS signature, a public key must be activated. Only one secret key can be active at any given
time for CMS and PGP. Only one public key can be active per name at any given time for CMS and PGP. Activating a key
can be done by the “System Administrator” security profile via the “Edit” or “Activate” action that is available in the “CMS
Secret/Public Keys” or “PGP Secret/Public Keys” inventories.

Figure 6-2 Secret key
A key can also be activated using the ‘action’ webservice (http://host:8080/webservice/action?WSDL). It uses the
‘ActivatePublicKey’ or ‘ActivatePrivateKey’ webservice incoming profile. Following parameters can be set:
-

keyID: key id of the key

-

type: PGP or CMS

-

active: true or false (optional, default = true)

Example:
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:act="http://action.webservice.util.trax.com/">
<soapenv:Header/>
<soapenv:Body>
<act:action>
<!--Optional:-->
<profile>ActivateSecretKey</profile>
<!--Zero or more repetitions:-->
<parameter>

Trax 7.36.0

68

Trax | Administrator (Communications)

<code>type</code>
<!--Optional:-->
<value>PGP</value>
</parameter>
<parameter>
<code>keyID</code>
<!--Optional:-->
<value>65BDA6E107D82DD3</value>
</parameter>
</act:action>
</soapenv:Body>
</soapenv:Envelope>

6.1.8

Setting a secret key password

If a secret key requires a password, this can be entered by editing the Secret Key entry in the “PGP Secret Keys” or
“CMS Secret Keys” inventory that is available to the “System Administrator” security profile.

6.1.9

Validate a secret key

A key can also be validated using the ‘action’ webservice (http://host:8080/webservice/action?WSDL). It uses the
‘ValidatePublicKey’ or ‘ValidatePrivateKey’ webservice incoming profile. Following parameters can be set:
•

keyID: key id of the key

•

type: PGP or CMS

•

active: true or false (optional, default = true)

•

revoked: true or false (optional, default = false)

•

valid: true or false (optional, defaults to true), it checks the validity period of the key

Example:
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:act="http://action.webservice.util.trax.com/">
<soapenv:Header/>
<soapenv:Body>
<act:action>
<!--Optional:-->
<profile>ValidateSecretKey</profile>
<!--Zero or more repetitions:-->
<parameter>
<code>type</code>
<!--Optional:-->
<value>PGP</value>
</parameter>
<parameter>
<code>keyID</code>
<!--Optional:-->
<value>65BDA6E107D82DD3</value>
</parameter>
<parameter>
<code>valid</code>
<!--Optional:-->
<value>false</value>
</parameter>
</act:action>
</soapenv:Body>
</soapenv:Envelope>

Trax 7.36.0

69

Trax | Administrator (Communications)

6.1.10 Revoking a secret key
A key can be revoked if it should not be used anymore. This change is immediately picked up by Trax and all data that
has been encrypted with the corresponding public key are discarded when they enter the system. The communications
will go to the “Failed” inventory.
To revoke a key, the “System Administrator” security profile can use the “Edit” action that is available in the “CMS
Secret/Public Keys” or “PGP Secret/Public Keys” inventory. A secret key is revoked when the “Revoked” flag is checked.
A key can also be revoked using the ‘action’ webservice (http://host:8080/webservice/action?WSDL). It uses the
‘RevokePublicKey’ or ‘RevokePrivateKey’ webservice incoming profile. Following parameters can be set:
•

keyID: key id of the key

•

type: PGP or CMS

Example:
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:act="http://action.webservice.util.trax.com/">
<soapenv:Header/>
<soapenv:Body>
<act:action>
<!--Optional:-->
<profile>RevokePublicKey</profile>
<!--Zero or more repetitions:-->
<parameter>
<code>type</code>
<!--Optional:-->
<value>PGP</value>
</parameter>
<parameter>
<code>keyID</code>
<!--Optional:-->
<value>65BDA6E107D82DD3</value>
</parameter>
</act:action>
</soapenv:Body>
</soapenv:Envelope>

6.1.11 Detailed information about stored keys
6.1.11.1 PGP
Trax offers detailed information about the generated or imported PGP keys that are stored in the database. This includes
both public and secret keys. The “System Administrator” security profile can view this detailed key data via the “View”
action on the respective key and clicking the “Key information” tab.

Trax 7.36.0

70

Trax | Administrator (Communications)

Figure 6-3 PGP Key details

6.1.11.2 CMS and XML-DSIG
Trax offers detailed information about the generated or imported keys that are stored in the database. The “System
Administrator” security profile can view this detailed key data via the “View” action on the respective key and clicking the
“Key information” tab.

Trax 7.36.0

71

Trax | Administrator (Communications)

Figure 6-4 CMS Key details

6.1.12 Encryption method
The ‘System Administrator’ security profile can configure encryption methods in a dedicated inventory located under
System > Security > Encryption method.

Trax 7.36.0

72

Trax | Administrator (Communications)

Field

Content

Code

Unique code for the encryption method

Name

Name for the encryption method

Encryption type

Encryption algorithm being ‘CMS’ or ‘PGP’.

Description

The description is a free-text field which you can use to give a
description of the encryption method.

Active

Activates or deactivates the encryption method.

Routing direction

Direction being either ‘In’ or ‘Out’.

Encryption
encoding

The encoding which gets applied to the payload (and signature) file.
Encryption type ‘PGP’ supports ‘PEM’ encoding. Encryption method
‘CMS’ supports ‘PEM’, ‘BER’ and ‘DER’ encoding.

Symmetric key
algorithm

Symmetric key algorithm used for encrypting the data.

Compression
algorithm

Compression algorithm used for compressing encrypted data.

Signature type

Type of signature being ‘Attached’ or ‘Detached’.
Attached signature will sign the unencrypted data, encrypt the data
and attach the signature to the encrypted data. The result is 1 file
containing the encrypted data and signature. Attached signatures
only use 1 secret key, a specific (PGP) or the system secret key.
Detached signature (only supported for encryption type PGP) will
encrypt the data, create signature(s) on the encrypted data and add
the encrypted file and signature file(s) to a zip archive. This option
can be used for corporate sealing. The format of the zip file is as
follows:
-

Zip archive: prefix.Trax.D.T.zip

-

Data file: prefix.Trax.D.T.xml.asc

-

Signature #1: prefix.Trax.D.T.1.sig.asc

-

Signature #2: prefix.Trax.D.T.2.sig.asc

Where D is the date formatted as YYMMDD, T is the time formatted
as HHmmSS and prefix is the configurable detached prefix.
Secret key

The key which will be used for signing the data. This can be either an
active or non-active secret key.

Use system secret
key

When no specific key is selected check this option if you want to use
the system secret key in Trax.

Trax 7.36.0

73

Trax | Administrator (Communications)

Field

Content

Detached prefix

When signature type is ‘Detached’, a prefix can be configured.

Add signer
certificate

When choosing ‘CMS’ the signer certificate will be added to the
encrypted data.

Hash algorithm

The hash algorithm used when signing using ‘PGP’ encryption type.

Decryption by Trax

Adds the public key of the active secret key (for ‘PGP’) or certificate
(for ‘CMS’) to the encrypted data. This way, Trax is able to decrypt
the message if needed.

6.2 Incoming communications
6.2.1

Decrypting data

To decrypt incoming data, the corresponding Trax secret key must still be available in the system. It does not have to be
active, but it must not be revoked nor expired.
To enable automatic decryption, select “PGP” or “CMS” as decryption method in the appropriate incoming routing entry.

6.2.2

Verifying signature authenticity

Trax can optionally verify the authenticity of a PGP or CMS signature if the corresponding public key is available in the
system when the signature is verified. The public key must not be revoked nor expired.
To enable signature verification, select the expected sender’s key in the corresponding incoming routing entry.
If the signature is missing or does not match the expected sender, the communication will go to the “Failed” inventory.

6.2.3

Saving encrypted incoming communication data

The encrypted bytes of an incoming communication can always be downloaded via the “Save as” action that is available
to the “Monitoring and Audit” security profile in the “Incoming” and “Failed - incoming” inventories or made available

Trax 7.36.0

74

Trax | Administrator (Communications)

through the Communications tab for the different workflow objects (Payments, statements and messages) via the
corresponding workflow security profiles.

6.2.4

Saving decrypted incoming communication data

It is possible to save the decrypted content of incoming communications via the “Save as (decrypted)” action that is also
available to the “Monitoring and Audit” security profile in the “Incoming” and “Failed - incoming” inventories or made
available through the Communications tab for the different workflow objects (Payments, statements and messages) via
the corresponding workflow security profiles.
This can be useful when resolving format-related issues.
Please note that, in order for decryption to be possible, the corresponding private key must be available in the system.

6.2.5

Monitoring

Logging by Trax will be done on 2 locations:
1. Processing History of business object for encryption and/or signature and Processing History of
communication object for decryption and signature validation.
2. Application logging.
Decryption scenarios:
-

-

When the decryption fails the communication object gets the “Failed” status. The Processing History contains the
message “Decryption failed” with some additional information to determine the root cause:
–

Secret key needed to decrypt does not exist

–

Secret key pass-phrase is wrong

–

Secret key is expired and/or revoked

–

Application log code: TRAX-SEC-00802

When the decryption succeeds, but the signature validation fails the communication object gets the “Failed” status.
The Processing History contains the message “Signature validation failed” with some additional information to
determine the root cause:
–

Incoming file does not contain a signature

–

The senderKey parameter refers to a key which is not available

–

The senderKey parameter refers to a key that does not correspond to the secret key by which the message
was signed

–

The public key is revoked and/or expired

–

Application log code: TRAX-SEC-00803

Decryption and decompression can be controlled by setting «decrypt-decompress-in-transmission« to true as parameter
in channel’s profile. When set to true it will decrypt and decompress at transmission phase otherwise at communication
phase.

6.3 Outgoing communications
6.3.1

Encrypting data

To encrypt outgoing data, one of the supported encryption methods must be selected in the outgoing routing and/or
workflow notification table.

Trax 7.36.0

75

Trax | Administrator (Communications)

Figure 6-4 Specifying PGP encryption on output
An encryption method specifies certain properties that are needed to encrypt, and optionally compress and sign the PGP
or CMS packets
1.
2.
3.
4.
5.

Encryption type (PGP, CMS): Type to be used while encryption and decryption
Symmetric key algorithm (3DES, CAST5, AES-128, AES-256)
Encoding (DER, BER, PEM; PGP supports only PEM1 while CMS supports DER, BER and PEM)
Compression algorithm (ZLIB, ZIP) (Not applicable for CMS)
Signature type (Attached, Detached): the signature can be attached to the encrypted message or detached
in a separate file next to the encrypted message. When detached, both the signature file and encrypted
message are in a ZIP file.
6. Secret key: the secret key used to sign the message. If no secret key is specified, the active Trax secret key
is used.
7. Detached prefix: the prefix used on the files added to the ZIP file when choosing the attached signature
type.

1 If the encryption method has encryption type PGP and encoding PEM then a customizable comment field can be added

to the encrypted/signature file. The value of this comment can be specified by adding a routing parameter with code
pgpComment and the desired value to the outgoing routing using this encryption method.
Example:
-----BEGIN PGP MESSAGE----VERSION: BCPG V1.46
COMMENT: <USERID>654321</USERID>
HQEMA2W9PUEH2C3TAQGANEXD45SPFBZ1EDOLYJMFC/CKE6QEIRKNMRBXTQ+OKXIX

…

Trax 7.36.0

76

Trax | Administrator (Communications)

8. Hash algorithm (SHA-1, SHA-256, SHA-512; only needed if signatures are required)
9. Add Signer Certificate: adds signer certificate while encryption (only enabled when encryption type is CMS
and signing is enabled)
10. Decryption by Trax: adds Trax active key in addition to the receiver key defined in the outgoing
routing/workflow notification

Figure 6-5 Encryption Method
The system will use the secret key of the encryption method or active secret key to generate the optional PGP or CMS
signature if the encryption method requires this; i.c. the “Signature type” field is filled.
The counterparty’s public key must be specified via the “Receiver Key” field. This key will be used to encrypt the data.
The following encryption method configurations are shipped with the product:
1. PGP_SHA1_3DES (using ZIP compression – inactive by default)
2. PGP_SHA1_3DES_PEM (using ZIP compression – inactive by default)
3. PGP_SHA1_CAST5 (using ZIP compression – active by default)
4. PGP_SHA1_CAST5_PEM (using ZIP compression – active by default)
5. PGP_SHA256_CAST5 (using ZIP compression – active by default)
6. PGP_SHA256_CAST5_PEM (using ZIP compression – active by default)
7. PGP_SHA256_AES128 (using ZIP compression – active by default)
8. PGP_SHA256_AES128_PEM (using ZIP compression – active by default)
9. PGP_SHA512_AES256 (using ZIP compression – active by default)
10. PGP_SHA512_AES256_PEM (using ZIP compression – active by default)
11. CMS_SHA1_3DES (no compression – active by default)
12. CMS_SHA256_AES128 (no compression – active by default)
13. CMS_SHA512_AES256 (No compression – active by default)
14. Corporate seal (No compression – active by default)

Trax 7.36.0

77

Trax | Administrator (Communications)

6.3.2

Monitoring

Logging by Trax will be done on 2 locations:
1. Processing History of business object for encryption and/or signature and Processing History of
communication object for decryption and signature validation.
2. Application logging.
Encryption scenarios:
-

-

When the encryption and/or signature fail, the business objects stays in “Released” (and no communication object is
created). The Processing History of the business object contains the message “Encryption/Signature failed” with
some additional information to determine the root cause:
–

Public key is expired and/or revoked

–

Application log code: TRAX-SEC-00800

Some concrete cases in which the signature will fail:

6.3.3

–

Secret key pass-phrase is wrong

–

Secret key is expired and/or revoked

–

No active secret key is available

–

Application log code: TRAX-SEC-00801

GUI upload

Files and static data can be manually uploaded in Trax by using the GUI upload. The GUI upload can be found on the top
on the left in the Navigation screen. Both single as multi file upload are supported.

Figure 6-6 GUI upload
To create a GUI Upload profile, user can create the profile (action) via config tab

Trax 7.36.0

78

Trax | Administrator (Communications)

Figure 6-2 GUI upload Action

Trax 7.36.0

79

Trax | Administrator (Communications)

7 Channel: File-system
7.1 Incoming Configuration
The ‘System Administrator’ security profile can configure new directory poll jobs in a dedicated inventory located under
Connectivity > File system > File system poll job. See UserGuide.Admin1.Generic.pdf, Chapter 13 Scheduler for
details on how to set up a directory poll job.

The ‘directories’ field can be configured with hard-coded directories or a reference to an application property using
{ap:yourProperty}.

Figure 7-1: File system poll job

Trax 7.36.0

80

Trax | Administrator (Communications)

Figure 7-2: New file system poll job
Once the directory poll job has been created, the system administrator must configure a matching Incoming Routing
entry:
1. Channel: “File-System”
2. Profile: any configured Job with job type “Directory poll” (i.e. the newly configured directory poll job).
The system administrator must select how to upload the file in which Trax workflow:
1. Encoding: any configured Encoding, defaulted to “UTF-8”. Encoding is a new entity, with pre-populated
entries “UTF-8”, “ISO-8859-1”, “US-ASCII”, “windows-1252”, “Big5” or “Shift_JIS”. An integrator can add
new encodings referring to a correct charset.
2. Format: any configured Message format.
3. Workflow: any configured Workflow. This entity is extended with a workflow specific load rule. Load rule
sequences should be cleaned up so that only one load rule sequence per workflow exists.
4. Data owner (optional): any configured Data owner.
5. Internal classification (optional): any configured Internal classification.
6. Confidential: flag, defaulted to “unchecked”.
7. Advanced parameters (optional): code / value list.
The incoming routing has below integrator extensions in the same manner as outgoing routing:
1. Custom fields (hidden by default)
2. Extension points: The extension point consists of a configurable RoutingManager.
RoutingFactory.getRoutingManager() will look for a custom routingManager property.
The interface is extended with incoming specific methods.
public interface RoutingManager {
boolean applyRoutingTable(OutgoingRoutingObject routingObject, String workflow);
boolean validateRoutingInfo(OutgoingRoutingObject routingObject);
void addProcessingHistory(OutgoingRoutingObject routingObject, String actionType, String rule, String
message);
IncomingRouting findIncomingRouting(CommunicationChannel channel, String profile, Map parameters);

Trax 7.36.0

81

Trax | Administrator (Communications)

RuleSequence getRuleSequence(IncomingRouting incomingRouting, Map parameters);
}

7.1.1

findIncomingRouting

Find a matching incoming routing, given a channel, profile and parameters.

7.1.2

getRuleSequence

Find the rule-sequence to execute given the incoming routing and parameters.

7.2 File System Outgoing Profile
For the file system channel, a number of parameters are available to set variables in the output path and file name.

Figure 7-3 File system outgoing profile
Field

Description

Code

Identification of the file system outgoing profile, used by Trax.

Name

Name for the file system outgoing profile.

Description

A plain text description of the file system outgoing profile.

File path

The path to which Trax will write the outgoing files. The field can be
configured with a hard-coded directory or a reference to an application
property using {ap:yourProperty}.
Illegal characters < > * " ? | are scrubbed after replacements and
replaced by _

File name
pattern

The pattern in which the file name of the outgoing message will be
written out. There is an option to add parameters to the file name
pattern to better identify the resulting files. These parameters always
need to be placed between curly brackets, e.g. {targetformat}.
Illegal characters < > * " ? | : / \ are scrubbed after replacements and
replaced by _

Table 7-1 File system outgoing profile
The following table gives an overview of all the parameters that can be appended to the file name pattern to better identify
the file:

Trax 7.36.0

82

Trax | Administrator (Communications)

Parameter

Meaning

Generic
dataOwner

Adds the data owner

channelReference

Adds the channel reference (of the incoming transmission

e2eReference

Adds the E2E reference

channel

Adds the code of the outgoing channel

profile

Adds the code of the profile which is used to write out this file

sourceProfile

The name of the incoming profile

outgoingProfile

The name of the outgoing profile

outgoingChannel

The code of the outgoing channel

creationDate

Adds the creation date

targetFormat

Adds the target format

workflowCode

The business workflow code

workflowName

The business workflow name

creator

Involved user code with Creator role

acceptor

Involved user code with Acceptor role

modifier

Involved user code with Modifier role

follower

Involved user code with Follower role

approver

Involved user code which last approved

Payment
instructedAmount

The instructed amount

interbankSettlementAm
unt

The interbank settlement amount

counterValueAmount

The countervalue amount

debitAccountNumber

Ordering customer account static data account - account number (Not supported for Messages!)

ccy

Currency of the ordering customer account (Not supported for
Messages!)

debitBankCode

Debit bank code

debitBankName

Debit bank name

debitBankBic

Debit bank BIC

timestamp

Adds a timestamp of when the file was written out.

internalClassificationTyp
e

The internal classification type

ownReference

Adds the own reference of the payment

counterpartyReference

The reference of the counterparty

Trax 7.36.0

83

Trax | Administrator (Communications)

Parameter

Meaning

ledgerCode (payment)

The ledger code

requestedExecutionDat
e
OCAAccountNumber

The requested execution date

OCAAccountCurrency

Ordering customer account currency

OCAHolderName

Ordering customer account holder name

OCAHolderCode

Ordering customer account holder code

OCABankName

Ordering customer account bank name

OCABankCode

Ordering customer account bank code

OCABankBIC

Ordering customer account bank BIC

accountNumber

Ordering customer account static data account number

accountCurrency

Ordering customer account static data account currency

holderName

Ordering customer account static data holder name

holderCode

Ordering customer account static data holder code

bankName

Ordering customer account static data bank name

bankCode

Ordering customer account static data bank code

bankBIC

Ordering customer account static data bank BIC

Ordering customer account number

Message
sender

The sender from the ME mini model

receiver

The receiver from the ME mini model

messageType

The message type from the ME mini model

counterpartyReference

The counterparty reference from the ME mini model

businessDate

The business date from the ME mini model

amountValue

The value of the amount from the ME mini model

amountCurrency

The currency of the amount from the ME mini model

account

The account from the ME mini model

numberOfTransactions

The number of transactions from the ME mini model

debitBankBIC

The debit bank BIC

debitBankName

The debit bank name

ownReference

Adds the own reference of the message

Size

The payload size

Account Statement
accountNumber

Adds the static data account number

accountCcy

Adds the static data account currency

Trax 7.36.0

84

Trax | Administrator (Communications)

Parameter

Meaning

closingBalanceDate

AccountStatement.ClosingBalance.BalanceDate

closingBalanceSign

AccountStatement.ClosingBalance.DebitCreditMark

closingBalance

AccountStatement.ClosingBalance.SignedAmount

statementNumber

AccountStatement.StatementNumber

sequenceNumber

AccountStatement.SequenceNumber

transactionReferenceNu
m- ber

AccountStatement.TansactionReferenceNumber

accountCode

AccountStatement.Account.Static data account.Account code

accountName

AccountStatement.Account.Static data account.Account name

holderName

AccountStatement.Account.Static data account.Holder.Name

holderCode

AccountStatement.Account.Static data account.Holder.Code

bankName

AccountStatement.Account.Static data account.Bank.Name

bankCode

AccountStatement.Account.Static data account.Bank.Code

bankBIC

AccountStatement.Account.Static data account.Bank.BIC

accountGroupCode

Code of the account group

accountGroupName

Name of the account group

relatedReference

The related reference

Deal Confirmations
internalClassificationTyp
e
ownReference

The internal classification type
Adds the own reference of the deal confirmation

Status Reports
sourceSystem

SourceSystem on Status Reporting profile

functionalStatus

Functional status on status reporting profile

Table 7-2 Routing information parameters
The default format for timestamp expansion is set to 'yyyyMMdd-HHmmssSSS'. However, you can choose your own date
format by specifying another data format behind the 'timestamp'- keyword followed by a colon. Example
{timestamp:yyMMdd}.

Trax 7.36.0

85

Trax | Administrator (Communications)

8 Channel: File- or Web Service-based SWIFT
8.1 FileAct
8.1.1

Emission

Figure 8-1 Sending files over FileAct
The configuration needed to send files over FileAct is encapsulated in the FileAct Outgoing Profile entity.
The link between a certain type of messages and the FileAct profile is specified in an outgoing routing entry.
The communication channel should be FTA or XMLv2.
The profile consists of all properties that are allowed (in the companion parameter file for outgoing FileAct transfers
over FTA or the companion XML parameter file for outgoing XMLv2) and are listed in the table below.
The properties in the parameter file are not dynamic, but are the fixed values as specified in the profile (this also includes
FileInfo).
Parameter file tag

Description

Mandatory
field?

Maximum length or
allowed values

Requestor

Requestor DN

Yes

100

Responder

Responder DN

Yes

100

Service

Service Name

Yes

30

RequestType

Request Type

Yes

30

TransferDescription

Transfer Description

No

256

TransferInfo

Transfer Information

No

256

FileDescription

File Description

No

256

FileInfo

File Information

Yes

256

Trax 7.36.0

86

Trax | Administrator (Communications)

Parameter file tag

Description

Mandatory
field?

Maximum length or
allowed values

FileLogicalName

Logical name

Yes

256

NonRepudiation

Non-repudiation flag

No

TRUE or FALSE

Sign

Signed flag

No

TRUE or FALSE

Priority

Urgent

No

Urgent or Normal

AckIndicator

Request Delivery Notification

No

TRUE or FALSE

AckResponder

Delivery Notification Receiver
DN

No

100

AckRequestType

Delivery Notification Request
Type

No

30

Table 8-1 FileAct Profile attributes
Example of a FileAct Profile:

Trax 7.36.0

87

Trax | Administrator (Communications)

Figure 8-2 FileAct Profile (for XMLv2)

Trax 7.36.0

88

Trax | Administrator (Communications)

Figure 8-3 FileAct Profile (for FTA)

Trax 7.36.0

89

Trax | Administrator (Communications)

Next to the parameter file values, you can also configure:
1. Emission path (FTA only): path to write the file(s) to (the field can be configured with a hard-coded directory
or a reference to an application property using {ap:yourProperty})
2. Logical name (XMLv2 only): file name to use (both for physical file on disk and the FileAct logical file name
field). This field supports parameter replacements like ‘PREFIX-{ownReference}.xml’ and defaults to
‘{MUR}’, which is an auto-generated message user reference with date and ID (format:
YYYYMMDD00000000). When defining a logical name, make sure this results in a unique filename.
Otherwise payload files get overridden.
3. Physical file prefix (FTA only): prefix to add to the file
a) Physical file suffix (FTA only): suffix to add to the file
4. SAA connection (XMLv2 only): connection to the SAA containing LAU key to enable data integrity and
authenticity
After processing, following parameters will be added to the outgoing Communication object:
1. Delivery notification flag
2. Generated communication reference
3. profile code that was used to send the file
4. FileAct communication channel (FTA or XMLv2)
The SWIFT file-based channel is responsible for the generation of the FileAct parameter file and data file. The parameter
file is written after the entire data file has been written to the emission directory, because the presence of the parameter
file triggers the actual file transmission.
When the communication object is being written to the emission directory, the content of this profile is transformed into
-

a par file – a XML file for FTA (using parameter file) – that accompanies the data file

-

an XMLv2 file that accompanies the data file

8.1.1.1 FTA (Alliance Gateway)
The filename of the FTA data file is generated based on a fixed pattern:
(prefix){timestamp as YYYYMMDD}{Communication.Identifier}(suffix)

The parameter file has the same filename but with extension .par added to the end of it.
The FTA channel needs to encrypt the data that is sent to the Synthesis service bureau. This is on top of what is defined
in the outgoing routing because this is channel-specific. Following application properties are defined to make this work
(also if no encryption is needed for other service bureau):
1. fta.extension: extension that needs to be added to a written file (eg. .gpg)
2. encryptedChannel.publicKey.keyId: key id of an imported public key
3. encryptedChannel.encryptionMethod.code: code of an existing encryption. The FileAct profile can be
configured with the SWIFT-FileAct-FTA channel in the outgoing routing table:

Trax 7.36.0

90

Trax | Administrator (Communications)

Figure 8-4 Outgoing Routing

Trax 7.36.0

91

Trax | Administrator (Communications)

8.1.1.2 XMLv2 (Alliance Access)
XMLv2 communication is only supported over AFT (file-based).

SAA connection using AFT adapter
The XMLv2 file accompanies the data file. The XMLv2 file content contains the actual filename of the data file in the
<Body> element.
XMLv2 file and data file will be written in the same emission directory, as configured in the outgoing profile. If they need to
be written in different subdirectories in the emission directory, 2 parameters need to be specified in the Outgoing routing :
-

attachmentEmissionSubDir : subdirectory of the data file

-

xmlv2EmissionSubDir : directory of the XMLv2 parameter file

Figure 8-5 Communication Object states

8.1.1.3 Sending the total Number of Transactions over FileAct
SWIFT is sometimes able to apply a specific pricing (price per transaction, instead of per kilobyte) for FileAct files,
provided the number of transactions that the file contains is mentioned.
For XMLv2, the number of transactions is written out in a specific FileAct header (the <TtlNbOfTxs> tag, in the XMLv2
PDU file).
For FileAct with companion file, the number of transactions is written in the companion file. This file could look like this:

Trax 7.36.0

92

Trax | Administrator (Communications)

Figure 6 -Example companion file

To activate it, you need to enable the option ‘Send number of transactions’ in the FileAct outgoing profile.:

Trax 7.36.0

93

Trax | Administrator (Communications)

Trax 7.36.0

94

Trax | Administrator (Communications)

Reception

Figure 8-10 Receiving files over FileAct

8.1.1.4 FTA (Alliance Gateway)
A scheduled job scans the reception directory for incoming data files. A parameter on the job specifies the root directory
to scan for and a file name pattern to apply.
For each file an incoming transmission and communication object is created that should be handled by an incoming
routing entry. The routing profile is selected based on the reception path.
Example: When a job is scanning on C:\temp\fta\reception, and the full file name is
C:\temp\fta\reception\PTSCFRHH\MT942\intraday01.ok, than the reception path of the incoming profile should be
‘PTSCFRHH\MT942’ to be selected.

:

Figure 8-7 FileAct Incoming Profile

Trax 7.36.0

95

Trax | Administrator (Communications)

Routing tables contain a Routing Sequence number which is used to determine the weight of a routing table in case
multiple tables match the input.
Inactive routing tables are ignored, both routing parameters are optional. When routing messages, Trax checks if the
actual value starts with the value of the routing table. The case of the value is ignored.
Trax supports the following FTA reconciliation messages:
-

LTA-Notify (*_notify.par)

-

Sender-Side Success Report (*.ok)

-

Sender-Side Delivery Notification Report (*.dlv)

-

Transfer-Related Error Report File (*.err)

FTA uses a reception directory for incoming data files and a log directory for incoming reports. Trax mimics this setup and
expects both types of files to be in different directories if the default poll job configuration is used.
By default, SAG events are disabled. This implies that a communication will always immediately move to status “Send”, if
no delivery notification is requested. When SAG events are enabled, the communication will remain in status “Sending”
and only move to status “Send” if the Sender-Side Success Report (.ok) has been received.
If the “Delivery notification” flag is set in FileAct outgoing profile and SAG events are enabled, the communication will
remain in status “Sending” and only move to status “Send” if the Sender-Side Delivery Notification Report (.dlv) with
status ‘Accepted’ has been received.
A communication is always moved to “Failed” if the “Delivery notification” flag is set in the FileAct outgoing profile and
SAG events are enabled when:
-

a Transfer-Related Error Report File (.err) is received

-

a Sender-Side Delivery Notification Report (.dlv) with status ‘Rejected’ is received

To enable SAG events, add a parameter with key “sag-events” and value “true” to the respective outgoing routing entry.
The request type of the incoming profile e.g. 'pain.002.001.03’ should match with the request type of the file that is
received e.g. ‘pain.002.001.03.crp.fic’. Upper or lower cases are ignored and when the request type of the file starts with
the request type of the profile it matches.

8.1.1.5 XMLv2 (Alliance Access)
A scheduled job scans the reception directory for incoming XMLv2 files. The XMLv2 file content points to the actual data
file containing the business data. By default the data file is read from the reception directory. If the data file is located in a
different directory, specify it in the ‘attachmentReceptionDir’ parameter.

8.1.1.6 Scheduled job configuration
The files are pulled into Trax by the scheduler. Following jobs are available as workflow imports and should be
customized to reflect the location of the directories.
The regular expressions used to pick up the files should not be altered.

Trax 7.36.0

96

Trax | Administrator (Communications)

Job name

Purpose

Regular
expression

SWIFT-FTAprocessMessage

Scans the FTA reception directory for incoming
FileAct business messages

.*

SWIFT-FTAreconciliation

Scans the FTA log directory for incoming
FileAct responses on previously sent files

.*

Parameters:
- fileActReconcile=true (to indicate that files
received through this job are reconciled with
previously sent files)
- fileNameRegex: regular expression to extract
the original outgoing message filename from
the response filename using the first matching
group. This only applies to LTA-Notify reports
because these messages do not contain a
reconciliation reference in the payload.
- logicalNameRegex: regular expression to
extract the original outgoing message filename
from the LogicalName element of a SAG event
report using the first matching group. This only
applies to SAG event reports (Success, Error,
Delivery).
eg. regex ‘(.*)\\..*_notify.par’ will extract
‘FileName’ from
‘FileName.TransferRef_notify.par’
SWIFT-XMLv2processMessage

Scans the reception directory for incoming
FileAct business messages and/or incoming
FileAct responses on previously sent files.

.*

Parameters:
saaConnection: referring to the code of SAA
connection used for the messages
attachmentReceptionDir: absolute path to the
location of the data files. If not provided, the
data files are looked up in the reception
directory

Table 8-2 Regular expressions for scheduled jobs

Trax 7.36.0

97

Trax | Administrator (Communications)

8.2 FIN (RJE format)

8.2.1

Emission

Figure 8-8 Sending FIN messages
To send messages over FIN, a combination of an outgoing communication channel and a profile is needed. The
combination is configured in an outgoing routing entry.
The outgoing communication channel should be SWIFT-FIN-AFT.
The FIN Profile contains the fields listed in the table below.
Profile attribute

Type

Length or
allowed values

Sender

Logical Terminal Address

12

MessageType

MT Standards Message Type

3

MessageDeliveryOptions

Combination of Priority and
delivery notifications

“N”

Receiver

Logical Terminal Address

12

Table 8-3 FIN Profile fields
Only below combination of delivery options is possible:
N: Normal priority without delivery notifications

Note: below combinations of delivery options are not supported:
N2: Normal priority with delivery notifications

Trax 7.36.0

98

Trax | Administrator (Communications)

U3: Urgent priority with delivery notifications and non-delivery warnings.

Example of a FIN Profile:

Figure 8-9 FIN Outgoing Profile example
Next to the parameter file values, you can also configure:
1.
2.
3.
4.

Emission path: path to write the file(s) to
Physical file prefix: prefix to add to the file
Physical file suffix: suffix to add to the file
SAA connection: connection to the SAA containing LAU key to enable data integrity and authenticity

5. The FIN channel is responsible for the generation of the SWIFT FIN headers and writing out the result to
the emission directory. The filename of the FIN file is generated based on a fixed pattern and has the .fin
file extension:
{timestamp as YYYYMMDD}{Communication.Identifier}.fin.

For every message that is successfully sent on the FIN network, an ACK (Acknowledgment) messages is returned. This
is downloaded as a .fin file into the reception directory. This file potentially contains other business messages or status
updates too. It is always in the RJE format.
Although the required RJE format provides the possibility to bundle unrelated messages in a single file, all MT message
types are written to the emission directory in a single file for each message.
The AFT channel needs to encrypt the data that is sent to the Synthesis service bureau. This is on top of what is defined
in the outgoing routing because this is channel-specific. Following application properties are defined to make this work
(also if no encryption is needed for other service bureau):
1. aft.extension: extension that needs to be added to a written file (eg. .gpg)
2. encryptedChannel.publicKey.keyId: key id of an imported public key

Trax 7.36.0

99

Trax | Administrator (Communications)

3. encryptedChannel.encryptionMethod.code: code of an existing encryption method

8.2.1.1 Building the FIN header blocks
The actual FIN header blocks are constructed by using the values in the FIN profile. Following header blocks will always
be present: basic header (1:), application header (2:) and user header (3:).
An example of a FIN header block combination:
{1:F01SENDER12AXXX20000000001}{2:I1013RECVR123AXXX4U35}{3:{108:200911011236}}

Please note that the session number and sequence number contain dummy values. This is typical for an RJE file,
because each message in this container format will be debulked by SWIFT before they are sent on SWIFTNet. The actual
session number and sequence number are assigned by SWIFT.

8.2.2

Reception

Incoming FIN files have the .fin filename extension and are formatted as RJE. The file poller should use this extension as
matching criterion when scanning for incoming files.
The high-level flow starts after the file poller has matched an incoming file and splits RJE file into parts and create
separate input transmissions.
Then, for each resulting message:
-

inspect the message content to determine the message type
–

based on the message type specified in the application header block

–

for ACK/NAK: based on the combination of application id and service id specified in the basic header block
(“F21”)

-

ACK comes from SWIFTNet and contains a line with {451:0}

-

NAK comes from SWIFTNet and contains a line with {451:1}

-

based on the message type
–

process status of messages and reconcile (currently implemented in swift-connector)

–

or process business messages by routing them to the appropriate load rule sequence via a FIN Routing
Table.

FIN routing table example:

2
3
4
5
6

Taken from FINProfile.Sender
Taken from FINProfile.MessageType
Taken from FINProfile.Receiver
Taken form FINProfile.MessageDeliveryOptions (optional)
MUR is generated during communication execution

Trax 7.36.0

100

Trax | Administrator (Communications)

Figure 8-10 FIN Incoming Routing Example

8.2.2.1 Debulking the RJE format

Figure 8-11 Debulking the RJE format
The content of the incoming communication object that is created by the file poller is split based upon the $ character. For
each part, a new transmission object is created, which is linked to the RJE transmission object.
For this use case, status updates and system messages are in scope. Business messages are covered in the Receiving
FIN message files use case.
Messages within a RJE file are recognized and routed:
1. based on the message type specified in the application header block

Trax 7.36.0

101

Trax | Administrator (Communications)

2. for ACK/NAK: based on the combination of application id and service id specified in the basic header block
(“F21”)
–

ACK comes from SWIFTNet and contains a line with {451:0}

–

NAK comes from SWIFTNet and contains a line with {451:1}

Transmission object with shared debulk & deduct profile logic for Incoming FIN messages
1. Messages are stored first in the original “bulked” format as a first transmission.
2. Optionally Decrypted/decompressed
3. Debulked into multiple single transmissions (channel specific). This is the case for RJE input-files, also
when only 1 RJE entry is available. FileAct channels will not debulk into an extra Transmission.
4. Profile is deducted and used to process the single transmissions (channel specific)

8.2.3

Scheduled job configuration

The files are pulled into Trax by the scheduler. Following jobs are available as workflow imports and should be
customized to reflect the location of the directories.

Job name

Purpose

Regular
expression

SWIFT-AFTFINReception

Scans the AFT reception directory for incoming
FIN business messages in RJE format

.+\.out

Parameters:
- uak=true (to indicate that files received
through this job are incoming busniness
messages)
SWIFT-AFTFINReconciliation

Scans the AFT reconciliation directory for
incoming FIN responses on previously sent files

.+\.ack

Table 8-3 Regular expressions for scheduled jobs

8.2.4

Application logging

The FIN implementation provides application logging for exception scenarios. The possible application codes are listed in
the table below.
Application code

Description

TRAX-SWF-00110

Original communication object could not be found.

TRAX-SWF-00120

Received an unexpected delivery notification.

TRAX-SWF-00130

Received a duplicate response.

TRAX-SWF-00140

Received an MT019 abort notification.

TRAX-SWF-00150

Received an MT012 sender notification.

Trax 7.36.0

102

Trax | Administrator (Communications)

TRAX-SWF-00160

Received a notification of an unknown type.

TRAX-SWF-00170

Attempted to perform an illegal communication status
transition.

TRAX-SWF-00180

Received an MT010 non-delivery warning.

TRAX-SWF-00190

Invalid status received

TRAX-SWF-00200

Emission directory is not set or does not exist.

TRAX-SWF-00300

Error while trying to move files from source to destination.

Table 8-4 Application Logging

8.3 Local Authentication (LAU)
When in the SAA connection the LAU key is filled out, Trax will generate a message authentication so that SWIFTAlliance
Access can authenticate that the FIN/FileAct message originates from Trax and was not altered. Vice versa, Trax will
validate the message authentication code of incoming FIN/FileAct messages, to verify that they come from
SWIFTAlliance Access and were not manipulated.

The LAU key consists of 32 printable characters and must be entered in two 16-character strings. This key must be
identical to the LAU key configured in SWIFTAlliance Access and must be renewed at regular intervals.

8.3.1

LAU key on FIN RJE message

Example FIN message with MDG tag:
{1:F01SWCIBEABAXXX0907000001}{2:I205SWCIBEABXXXXN}{3:{103:ZCP}{119:COV}}{4:
:20:989COV
:21:090525/123COV
:32A:090527EUR10500,00
:52A:SWCIBEAB
:58A:SWCIBEAC
:50F:/123564982101
1/MR. BIG
2/HIGH STREET 3
3/BE/BRUSSELS
:59:/987654321
MR. SMALL

Trax 7.36.0

103

Trax | Administrator (Communications)

LOW STREET 15
LONDON GB
:70:/INV/1234
:33B:EUR10500,00
-}{S:{MDG:5E87F8F390E5FB886E8311E4D7C994371FA9AF3119B2C314DAE458738AFF08AC}}

8.3.2

LAU key on FileAct XMLv2 AFT message

FileAct AFT will use a binary prefix before the XMLv2 message.
This prefix consists of 3 elements:
•

Prefix (1 byte): the character 0x1f.

•

Length (6 bytes): length of the signature and DataPDU fields.

•

Signature (24 bytes): signature computed on the DataPDU using HMAC-SHA256 algorithm, base64-encoded

The message partner on the SAA needs to be configured with option ‘use binary prefix’.

8.4 FTP remoting
Trax supports plain FTP, SFTP and FTPS.

8.4.1

AFT/FTA

AFT (FIN) and FTA (FileAct) are file-based protocols for communicating SWIFT messages to and from a SWIFT Service
Bureau (SSB).
In order to put local messages on the remote filesystem and get remote files to the local filesystem, the integration
channel is used.

8.5 Directory poll jobs
Encoding of incoming files:
AFT-FIN: all incoming RJE files are supposed to be ISO-8859-1 encoded.
FTA-FileAct: encoding of incoming files can be different from ISO-8859-1, should be configurable in incoming routing

8.6 Application logging
Trax provides application logging for exception scenarios. The possible application codes are listed in the table below.

Trax 7.36.0

104

Trax | Administrator (Communications)

Application code

Level

Description

TRAX-SWF-00010

Error

Original communication object could not be found.

TRAX-SWF-00020

Warning

Received a counterparty emission failure notification.

TRAX-SWF-00030

Warning

Received an unexpected delivery notification.

TRAX-SWF-00040

Error

Response communication object did not have a communication
reference.

TRAX-SWF-00050

Warning

Received a FileAct duplicate response.

TRAX-SWF-00110

Error

Unable to find corresponding outgoing communication.

TRAX-SWF-00120

Warning

Unexpected delivery response received.

TRAX-SWF-00130

Warning

Received a FIN duplicate response.

TRAX-SWF-00140

Error

Received an MT019 abort notification.

TRAX-SWF-00150

Info

Received an MT012 sender notification.

TRAX-SWF-00160

Error

Received a notification of an unknown type.

TRAX-SWF-00170

Error

Attempted to perform an illegal communication status transition.

TRAX-SWF-00180

Error

Received an MT010 non-delivery warning.

TRAX-SWF-00190

Error

Invalid status received

TRAX-SWF-00200

Error

Emission directory is not set or does not exist.

TRAX-SWF-00300

Error

Error while trying to move files to remote system.

TRAX-SWF-00400

Error

SAA connection issue occurred.

TRAX-SWF-00410

Info

SAA connection informational event notification.

TRAX-SWF-00420

Info

SAA transmission timeout notification (by default 15 minutes).

Trax 7.36.0

105

Trax | Administrator (Communications)

9 Channel: EBICS
9.1 EBICS Introduction
EBICS (Electronic Banking Internet Communication Standard) is a file transfer protocol between corporates and banks over
the Internet. It was designed by the German central bank (ZKA) to replace the older and slower FTAM protocol (over ISDN
or X.25).
All file transfers (both send and fetch) are initiated by the EBICS client. It has an FTP-like nature. In contrary to SWIFT
FileAct for example, where files can be pushed to the client, EBICS only operates in pull mode. Information and
specifications (including return codes) are available at www.ebics.org for Germany and www.cfonb.org for France.

9.1.1

Why choose EBICS
1. Multiple bank servers using the same software.
2. It is based on open standards like XML, HTTPS and ZIP and uses modern technology (secured Internet,
digital signatures, etc.).
3. EBICS is highly secure thanks to transport encryption and end-to-end application encryption
4. One standard for multiple order types (direct debits, credit transfers, account statements, etc.
5. If the bank server supports recovery, then data recovery is fast and efficient due to transmission in
blocks of one megabyte which makes it possible to resend only the corrupted data block.
6. It is fast and cost-effective (especially when compared to FTAM or over ISDN and SWIFT FileAct from a
cost perspective).

9.1.2

Transmission

EBICS communication is done over a secure HTTPS connection with the data stored in an XML envelope which holds all
necessary parameters, signatures and business data. The business data itself is compressed, encrypted, segmented into
blocks of one megabyte and encoded.
1. System order types (system messages such as keys and signatures) are processed synchronously by
the bank server.
2. Business order types (such as payments) can (and often will) use deferred processing and are
therefore by definition asynchronous.
If supported by the bank server, pre-validation can be used. This can for example consist of signature verification. The
main advantage is to save time and bandwidth by synchronously pre-validating certain aspects upfront instead of
asynchronously afterwards when the whole file was successfully uploaded.

9.1.3

Prerequisites
A license for BLEBICS and BLPTK from Business-Logics is required

9.2 Configuration
EBICS can be configured as system administrator under Configuration > Routing > EBICS.

Trax 7.36.0

106

Trax | Administrator (Communications)

Figure 9-1 Navigation Overview

9.2.1

Communication Options

Both upload and download have to be configured
-

-

Upload order signing can be done either attended by human users or unattended (i.e. by the system)
–

Normal attended signing uses the Trax signing administration mechanism and links the Trax users to EBICS
users.

–

Unattended signing can be set via the GUI to a single or double signature.

–

Unattended signing can be set to HKD download where the application downloads a file which identifies the
allowed signers and replies by self-signing with the profiles of those allowed signers. Note: This option can
only be enabled when the application property with key “EBICS_USE_HKD_FALLBACK” exists and has
value “true”.

–

If the same user profile is used for all uploads of a connection profile, then it suffices to select this user as
‘Technical user’ and also enable this on the connection profile.

Download:
–

If the same user profile is used for all downloads over a connection profile, then it suffices to select this user
as ‘Download user’ and also enable this on the connection profile.

–

If different users can be used for the downloads over a connection profile, the user must be defined as
parameter of the communication job.

Trax 7.36.0

107

Trax | Administrator (Communications)

Figure 9-2 Communication overview

9.2.2

Contract

To set up EBICS, make sure you have filled out the EBICS connectivity template with the data received from the bank. In
the following chapters, references to the template will be used to map the configuration.

9.2.3

Bank Server

For every bank to which we want to communicate with EBICS, a bank server has to be configured. Both the server
information and keys have to be entered.

Figure 9-3 Bank Server
Field

Description

Template

Code

ID used by the application (for example: server-1)

G1.0

Trax 7.36.0

108

Trax | Administrator (Communications)

Field

Description

Template

Name

Name used by the application (for example: server-1)
This can be freely chosen.

G1.1

Description

Freely chosen description to be used by the application

G1.2

URL

The Internet URL of the secure bank server. Note the

G1.3

Host ID

HTTPS:// to denote a secure connection.
The EBICS host ID of the bank server, this will have been
defined by the partner bank.

G1.4

Protocol Version

H002 (EBICS 2.3) and H004 (EBICS 2.5) for Germany
or H003 (EBICS 2.4) for France.

G1.5

Protocol Variant

France
DE (Germany) FR (France)

G1.6

Recovery Supported

Set to true if recovery is supported by the bank server.
This means that corrupt data can be resent in one megabyte blocks to save bandwidth and time.

G1.7

Prevalidation
Supported

Set tot true if pre-validation is supported by the bank
server. This means that the message undergoes
checks before it is completely uploaded. This saves
time and bandwidth in case of, for example incorrect
signatures which would otherwise only be detected after
full upload.

G1.8

FUL Test Mode

Only applicable for France (protocol version 2.4 - H003)
and indicates test communication between the client and
bank server, sometimes required before actual
production usage can be done.

G1.9

Table 9-1 Bank Server
The keys for secure communication can be found in the next tab. The data is automatically downloaded from the server
at the first connection session.

9.2.4

Connection Profile

Once the bank server has been configured, the connection profile has to be set up. This connection is based upon a
contractual agreement between customer and bank. There's one connection profile per customer ID as given by the
bank. Options such as download user identity or unattended signing allowance are set here as well.
The general tab defines the connection profile identity.

Trax 7.36.0

109

Trax | Administrator (Communications)

Figure 9-4 Connection Profile
Field

Description

Template

Code

Identification of the connection profile, used by Trax

G4.0

Name

Name for the profile

G4.1

Description

A plain text description of the profile

G4.2

Bank Server

The bank server for this profile

G1.0

Customer ID

The EBICS customer ID (partner ID). This requires a contract
with the bank server.

G4.4

Allow
unattended
signing

Set to true if unattended signing is allowed.

G4.4

If this is true, 1 or 2 users can be selected for unattended
signing. These users should be created first, linked to the
corresponding connection profile and have the ‘Unattended
signing’ flag enabled. These users can then be used for all
EBICS signing, in the case no linked EBICS users were
found.
If it is not set to true, linked EBICS users should be present.

Use
download
user

If set to true, a single user identity is used as authentication for
all downloads and a user must be selected as default download
user on the user tab.

G4.5

If this is not activated, then the user must be defined as
parameter for every EBICS download job.
Use
technical
user

If set to true, a single user identity is used as authentication for
all uploads and a user must be selected as default technical user
on the user tab.

Trax 7.36.0

G4.6

110

Trax | Administrator (Communications)

Field

Description

Template

Use Fax
confirmation

This field is used to indicate that digital signing is not done by
the electronic system but will rely on manual intervention by
transmission of a fax, via phone or via email. Due to the
different possible formats and agreements for this information
de- pending on the agreed bank contracts, no fax templating
is provided. This method is only supported on the French
market, not on the German equivalent. And only in
combination with unattended signing.

G4.7

Table 9-2 Connection Profile

Note: The EBICS user signature(s) that has/have been used to sign the outgoing payment(s) can be verified in the
outgoing transmission history.
Once the general settings have been defined, the users have to be added and have their keys and properties set. This is
done in the following configuration screen:

Figure 9-5 Connection Profile – User
Once the user has been created, the keys are generated based on the given password or automatically generated
password. This is done by selecting the ‘Initialize keys’ action on the user. This action also sends the keys to the bank.

Trax 7.36.0

111

Trax | Administrator (Communications)

Figure 9-6 Initialize keys – User
Note: The signing, authentication and encryption keys are mandatory for German variants of EBICS while the French
variant also requires the certificates.
Field

Description

Template

General
Connection
profile

This links the EBICS user to the connection profile

Code

EBICS user ID as defined by the bank.

U1.0

Name

Name of the user.

U1.1

Description

A plain text description of the user.

U1.2

Status

This is an information-only field which can be used to
set the status of the EBICS user.

Unattended
signing

Set to true if unattended signing is to be used with
this user as default. if this is true, then it is not
possible to use a linked end user in the linked end
user tab. Make sure this is set to true for only one
user per connection profile.

U1.3

Download user

If this is set to true, then this user identity is used as
default download user. Make sure this is set to true
for only one user per connection profile.

U1.4

Trax 7.36.0

112

Trax | Administrator (Communications)

Field

Description

Template

Technical user

If this is set to true, then this user, also sometimes
called the Transport user, is used as default upload
user. Make sure this is set to true for only one user
per connection profile.

U1.5

The Trax users linked to this EBICS user. This is
only valid for attended signing. More than one user
can be selected. This means that these users will
use the same keys.

U5.0

Signature
version

Electronic signature: A004 (2.3) A005/ A006 (2.4
and 2.5).

U2.0

Security
medium

The security medium where the signature key is
stored.

U2.1

Linked end user
Linked end user

Initialize keys
Signature key

A special option is ‘Smartcard’ which makes it
possible to use a 3skey token that has been
assigned (using the signer application) to a Trax
user as signature key. When this option is selected
the certificate of the assigned Trax user can be
selected.
Password

Enter here the password of the Signature key (or
check ‘Automatically generate passwords’ to have it
generated by Trax.

U2.2

Certificate

A CA-signed or self-signed X.509 certificate is used
for France.

U2.4

Authentication key
Authentication
version

Authentication against bank server: X001 (2.3) X002
(2.4 and 2.5).

U3.0

Password

Enter here the password of the Authentication key
(or check ‘Automatically generate passwords’ to
have it generated by Trax.

U3.1

Certificate

A CA-signed or self-signed X.509 certificate is used
for France.

U3.3

Encryption key
Encryption
version

End-to-end encryption: E001 (2.3) E002 (2.4 and
2.5).

U4.0

Password

Enter here the password of the Encryption key (or
check ‘Automatically generate passwords’ to have it
generated by Trax.

U4.1

Trax 7.36.0

113

Trax | Administrator (Communications)

Field

Description

Template

Certificate

A CA-signed or self-signed X.509 certificate is used
for France.

U4.3

The Trax users linked to this EBICS user. This is
only valid for attended signing. More than one user
can be selected. This means that these users will
use the same keys.

U5.0

Linked end user
Linked end user

Table 9-3 Connection Profile - User
Note: A private key of an EBICS user is stored in the PKCS#8 format with password- based encryption. When a password
is filled out upfront (i.e. before key generation), the private key will be PKCS#5 v2 AES encrypted using that password.
Without the correct password the private key cannot be used. It is strongly recommended to set a secure password.

9.2.5

User

Once a user has been configured in the connection profile, he has to be authenticated by the bank. This takes place in the
following steps:

Figure 9-7 User Authentication Flow

-

1. The customer signs an EBICS agreement with the bank. This agreement covers:
Which accounts

-

Which order types

-

Which users can send/fetch which order types on which accounts. The bank then sets up all data on their bank
server. All users are in a non-active state "new", waiting for initialization by Trax.

Trax 7.36.0

114

Trax | Administrator (Communications)

-

For every user, three RSA key pairs must be generated. The public parts of these key pairs are electronically
transferred to the bank over INI (A004/5/6 key pair) and HIA (X001/2 and E001/2 key pairs) order types.

-

To verify the keys, they must also be supplied in human-readable form as INI letter and HIA letter to the bank. How
they must be supplied is specified in an agreement with the bank. This can for example, be via postal service.

-

Once both the electronic and hardcopy versions of the keys have been authenticated by the bank, the bank will
release the user who will then be ready for use.

Note: Trax combines the INI and HIA actions in a single step and thus skips the partially initialized step.
–

Afterwards, key pairs can only be changed by locking and reinitializing them after having notified the
bank.

Figure 9-8 User Actions
Action

Function

Export signature
key

Exports the signature key from the EBICS user to a keystore file.

Initialize keys

Initializes the signature, authentication and encryption keys with the
correct version and a password. Do not regenerate these keys once
correctly initialized as the old keys will be lost and require manual
intervention at the bank to set up again. Remember to save the keys
after generation for later recovery. This action initializes the user by
electronically sending the INI order type (public signature key),
followed by the HIA order type (public authentication and encryption
key) to the bank server.

Trax 7.36.0

115

Trax | Administrator (Communications)

Action

Function

Change keys

Changes information for the signature, authentication or encryption
keys like the key version or password. This action changes the keys
by electronically sending the PUB order type for the signature key
and/or the HCA order type for the authentication and encryption key
to the bank server. If only the signature key information has
changed, the user will be in state ‘Partially initialized (PUB)’. If only
the authentication or encryption key information has changed, the
user will be in state ‘Partially initialized (HCA)’. If all key information
has changed, the user will be in state ‘Initialized’.

Delete keys

Deletes key information of the signature key, authentication key and
encryption key. Once this is done, the user can eventually be
initialized again.

Delete signature
key

Deletes key information of the signature key.

Print INI letter

Prints out the hardcopy of the INI letter for authentication to the bank

Print HIA letter

Prints out the hardcopy of the HIA letter for authentication to the bank

Lock user

This sends the SPR order type. This uploads a user revocation and
will cause the user to become locked as a safety measure to prevent
others from using a compromised user identity.

Table 9-4 User Actions

9.2.6

Troubleshooting

In case there is a problem during HIA initialization, the error message “subscriber unknown or subscriber state
inadmissible” will be displayed. In this case, the user must be manually reinitialized on the bank server.
If the error message “order id already exists” is shown, the order number is too low.

9.2.7

Order Type

Here the available order types are defined. This is a prepopulated list with the supported order types and should only be
added to or edited in case it is required by the bank.

Trax 7.36.0

116

Trax | Administrator (Communications)

Figure 9-9 Order Types
Field

Description

Template

Code

Code which is used by Trax to identify the order type.

OT1.0

Name

Name of the order type.

OT1.1

Description

Free text description of the order type.

OT1.2

Order type

The EBICS order type. This is a standardized order type
in accordance with the bank specification and
terminology.

OT1.3

Protocol
variant

The protocol variant. The German protocol returns a text
file, the French protocol returns an XML PAIN 001.001.02

OT1.4

Acknowledgement.
Upload

Set to true for upload, false for download.

OT1.5

System

Set to true for system messages, set to false for business
messages.

OT1.6

File Type

The file type is used for the French implementation
(version 2.4) of EBICS. For more information and the
available options see CFONB.ORG and search for the
EBICS nom- mage des fichiers.

OT1.7

Format

The message format in Trax which corresponds with the
EBICS order type. This is only required for upload order
types.

OT1.8

Rule
sequence

The rule sequence which is to be executed when data is
re- turned after a fetch on the EBICS server. This is
therefore only executed for downloads.

OT1.9

Trax 7.36.0

117

Trax | Administrator (Communications)

Field

Description

Template

Container
format

Specifies the format of the incoming message. Either
empty if the incoming message is not in a container
format or ZIP or XML if the incoming message is a ZIP
file which contains incoming messages or is
concatenated message containing multiple XML
documents.

OT1.10

The ZIP compression method can be ‘Deflate’ or ‘Store’,
both are supported but ‘Deflate’ is preferred.
This field is only enabled if the option ‘Upload’ is
disabled.

Table 9-5 Order types

9.2.8

Order Number

This is an associative entity (link table) between the Connection Profile entity and the Order Type entity holding the last
used order number. These entries should not be modified as they are required to keep the application in sync with the bank
server. They can be edited for testing purposes or in the unlikely event that due to connection problems, the
communication would go out-of-sync. EBICS requires that a new communication always has a higher sequence
number than the previous communication. From version 2.5 onwards, the order number is retrieved from the bank server
when sending out an order.

Figure 9-10 Order Number

9.2.9

Troubleshooting

In case you receive the error message orderid already exists, the most likely cause will be that the sequence number
here is too low.
It is possible to enable tracing of all EBICS XML data going over the wire. To enable this, specify where the trace files should
be added to application properties with the property com.trax.ebics.connector.EbicsConnector.traceDir=/tmp/traxebics-trace
Tracing will be enabled when this property is set and disabled when commented out or not set.

9.2.10 Planned Download
The download planner allows to set up EBICS downloads with a preset connection profile and order type. The planned
download is identified by a code, name and description on the general tab and a list of planned download entries. For every
planned download, a duplicate of the EBI- FetchPlannedDownload job must be created.
It is possible to group downloads per bank server, per order type or other criteria.

Trax 7.36.0

118

Trax | Administrator (Communications)

Figure 9-11 Planned Download
Field

Description

Code

The code of the incoming profile

Connection profile

The connection profile to be used for the planned
download.

Order type

The order type to be used for the planned download.

Active

The downloads with this profile and order type
combination will only be run when planned download is
active

Table 9-6 Planned Download

9.3 Using EBICS
If ‘Use technical user’ (also known as Transport user/subscriber) has been defined on the connection profile and a technical
user has been identified for that connection profile, the authentication and encryption key of this user will be used for all
uploads with that connection profile. The signature sent along with the payment is decided taking into account the
unattended/attended signing configuration.

9.3.1

Upload - Unattended Signing

Unattended signing is signing done by the EBICS connector itself, using an EBICS user profile, not by an actual Trax user.
The EBICS connector will thus provide the signature of an EBICS user independent of who signed it in Trax. In case no
technical user is used for that connection profile, this user identity will be predefined and will also be used for all uploads
(transport) with that EBICS profile.
In case no linked EBICS user or unattended EBICS user is found, but unattended signing is allowed, the HKD mechanism
can be used. This mechanism retrieves a file which identifies the allowed signers, required number of signatures and
their signature classes and then uses the profiles of the applicable signers to authenticate the upload. This option can
only be enabled when the application property with key “EBICS_USE_HKD_FALLBACK” exists and has value “true”.
Payments are routed over EBICS by editing the routing table and creating a filter or scenario for the EBICS messages
with EBICS as channel and the previously created EBICS profile as profile. No parameters must be set.
The communication can be checked by opening the payment or envelope and selecting the communications tab. More
details can be requested by selecting view and then the preview tab. When using Swift 3Skey tokens as Signature key for
the EBICS user, unattended signing can’t be used.

Trax 7.36.0

119

Trax | Administrator (Communications)

9.3.2

Troubleshooting

Whenever the order type could not be determined (for example, when two or more order types exist which match with the
payment or envelope target format) then the parameter orderType has to be defined as routing information parameter of
the routing table. For example orderType=IZG

9.3.3

Upload - Attended Signing

Also in case of attended signing a dedicated ‘Technical user’ can be configured which will be used for all uploads with
that connection profile.

9.3.3.1 Disable Unattended Signing
To use attended signing, Trax signing administration must have been set up and the EBICS Signing admin workflow must
have been imported into the application. It is always a good idea to verify that unattended signing has been disabled first
by opening the connection profile and checking the general tab. It is good practice to also check that on the user tab, no
user is selected for unattended signing. This setting will be ignored if unattended is disabled on the general tab though.

Figure 9-12 Disable Unattended Signing

9.3.3.2 Linking User Profiles
Now for every EBICS user, one or more user profiles must be added on the linked end user tab so that these Trax users are
used for EBICS signing.

Trax 7.36.0

120

Trax | Administrator (Communications)

Figure 9-13 Linking

9.3.3.3 Signing Administration Configuration
Next, signing administration must be configured so that the Trax user who corresponds with the EBICS signer can sign.
Go to signing administration > mandates and add the signer profiles that have the corresponding users to the mandate. For
example, if we have EBICS signer A linked to Trax user A and user B, then a signer profile which contains user A and user B
must be created and the signing mandate must have this profile added as Signer profile 1.
Only Trax users that are linked to an EBICS signer will be authorized to sign the payments regardless of whether the Trax
users are added to the signer profile yes or no. If no Trax user linked to an EBICS signer can be retrieved, a warning
message will be logged that no authorized signers can be found.

Figure 9-14 Signer Profile

Trax 7.36.0

121

Trax | Administrator (Communications)

9.3.3.4 Routing Table - Communication Routing

Figure 9-15 Signing Method
Since payments are routed over EBICS by editing the routing table, please refer to 24 “Routing Tables”. The channel
should be set to EBICS, the profile is one of the EBICS profiles and the signing method must match the one from the
EBICS user.

9.3.4

Download

If the download user has been defined on the connection profile and use download user is set to true, this user identity will
be used as authentication for all downloads with that connection profile.
If not, a user must be specified per download. To do so, it suffices to edit the EBI- FetchPlannedDownload job (or to
create a copy of it) and to set the parameters as shown in 31.3.4 “Jobs”.
Note that this is where data ownership can be added here as described in chapter 25 “Multi- Entity” when desired.

Figure 9-16 Fetch Planned Download

Trax 7.36.0

122

Trax | Administrator (Communications)

9.3.5

Jobs

EBICS has several jobs for processing.
-

-

-

EBI-Fetch PTK is used to fetch the PTK from the German EBICS bank server for acknowledgement.
–

orderType: (mandatory) must be set to PTK.

–

profile: (mandatory) must match the code of the connection profile to be used.

EBI-Fetch PSR is used to fetch the PSR from the French EBICS bank server for acknowledgement.
–

orderType: (mandatory) must be set to PSR.

–

profile: (mandatory) must match the code of the connection profile to be used.

EBI-FetchPlannedDownload. This job is used to get the planned downloads.
–

plannedDownload: (mandatory) identification code of the planned download (EBICS > EBICS configuration >
Planned download)

–

user: (optional when using one user for all downloads, required when using a user per download)

–

fromYYMMDD: (optional, but mandatory when to-date is used) In case already requested EBIS information is
to be requested again, it is possible to force the begin point in time of the requested period with this
parameter.

–

toYYMMDD: (optional, but mandatory when from-date is used) In case already requested EBIS information is
to be requested again, it is possible to force the end point in time of the requested period with this parameter.

When not specifying a from-date and a to-date, only not-already requested EBICS info is downloaded.
When specifying a from- and to-date, only already requested (archived) EBICS information is downloaded. Not-yet
requested EBICS information is not considered.

9.4 Notes
1. For the EBICS CRJ format only Rejected status messages are applicable.
2. HKD-cached data is automatically cleared every 15 minutes. This ensures that changes at the bank server
signature configuration are kept up-to-date.
3. When the Trax server must go through a proxy to get Internet connectivity, add these JVM system parameters
in the application server:

-Dhttps.proxyHost=xxx.xxx.xxx.xxx
-Dhttps.proxyPort=8080
-Dhttps.proxyUser=guest
-Dhttps.proxyPassword=guest

9.4.1

Error Codes

The EBICS error codes are structured as follows:
1. The first 2 digits are the error class:
a) 00 information
b) 01 note
c) 03 warning
d) 06 recoverable error
e) 09 non-recoverable error

Trax 7.36.0

123

Trax | Administrator (Communications)

2. The 3rd digit:
a) 0 no EBICS specific error
b) 1 EBICS specific error
3. The 4th digit is the sub group:
a) 0 none
b) 1 transaction management
c) 2 key management
d) 3 pre validation
4. The last 2 digits are error specific.
Please refer to the official EBICS specification (annex 1 - return codes) at http://www.ebics.org for a complete list of error
codes with descriptions and recommended actions.

9.4.2

Minimal VEU support

VEU payments are payments that don’t contain enough signatures. In Trax, payments can be sent via EBICS with 1
signature(s). Sending a 2nd signature after the payload has been sent is not supported by Trax. However, this can be
achieved by third-party (mobile) applications or with a banking portal.
Trax has minimal VEU support; it can handle PTK’s specific for VEU payments. When these payments receive a positive
PTK, they will be moved to ‘Sent’. When receiving a negative PTK they will be moved to ‘Sending failed’

9.4.3

SWIFT 3Skey support

It is possible to use 3Skey token as Signature key in Trax. To set it up the 3Skey token has to be assigned via the signing
app to the Trax users that will be linked to the EBICS user. A 3Skey can’t be shared so only 1 Trax user should be
assigned to each EBICS user. When initializing the EBICS user (via EBICS – User – Initialize keys) the Security Medium
should be ‘Smartcard’, the certificate becomes mandatory and can be selected from the certificates available on the Trax
user linked with the EBICS user. In the tab ‘Data Security’ of the corresponding Outgoing routing the signing method
‘3SKEY_EBICS_A006’ or ‘3SKEY_EBICS_A005’ ’ should be selected corresponding with the signature version selected
when initializing the EBICS users.

Trax 7.36.0

124

Trax | Administrator (Communications)

Figure 9-16 Initialize keys for 3Skey

9.5 Configure Incoming Routing (EBICS)
The EBICS channel can be configured in incoming routing:
1. Load rule sequence is removed from Order Type
2. Order Type code is used as incoming communication profile
3. Incoming routing profile points to an Order Type

Trax 7.36.0

125

Trax | Administrator (Communications)

10 Channel: Web Services
10.1 Trax Import Web Service v1.0
The Trax Web Service adapter allows the uploading of files into Trax. This feature enables modern integration patterns
between back-office applications and Trax, without having to rely on potentially insecure file transfers and file folders.

10.1.1 General
10.1.1.1 Standards
Trax offers WS-I Basic Profile 1.1 compliant web services which implement SOAP 1.1 over HTTP using document / literal
/ wrapped style.

10.1.1.2 Security
If confidentiality and authentication is desired, the web service must be configured for HTTPS access with SSL client
authentication.
Trax offers additional PGP encryption /signature features. In this case the data must be PGP encrypted upfront.

10.1.1.3 Binary data
Binary data is in-lined by means of Base64 encoding in the SOAP XML data itself.

10.1.1.4 Limitations
Trax allows for maximum 50 concurrent web service calls at any given moment in time. Trax support data size up to 100
MB for data uploaded via below web service call.

10.1.1.5 Logging
For audit purpose, some information is logged in the file: webservice.log. For the import endpoint within the import service, the
user, the profile, the parameters, the channel reference and the status are logged. For the status endpoint within the import
service, the user, the e2eReference and the status are logged. For the action webservice the user, the action (profile) and
parameters are logged.
Currently a distinction is made between authorized (using JWT token) and unauthorized webservice requests in the log file.
In case of authorized webservice call the user from the JWT token is logged, for unauthorized webservice calls, no user but the
message ”No user logged in“ will be printed.

10.1.2 Web Service Description
The process of importing data to Trax is split in two web service calls:
1. uploading data
2. retrieving the status of the uploaded data

10.1.2.1 Import service
This web service loads business data into Trax which will safe-store the data in the database as an incoming
communication.
An optional end-to-end or own reference can be used by Trax as the incoming communication’s reference.
The uploaded file has not (yet) entered any Trax workflow (e.g. UP, BP or ME).
Note: A project-specific extension point can be implemented server-side for (synchronous) payload validation. This web
service will give a synchronous feedback on the load status in order to facilitate monitoring of the custom validation.

Trax 7.36.0

126

Trax | Administrator (Communications)

10.1.2.2 Request
Field

Mandatory

Description

Profile

Yes

Incoming routing profile code

Reference

No

End-to-end or own reference (optional)

Data

Yes

Binary data, Base64 encoded

Parameter

No (0..N)

Additional parameters: allows setting
additional parameters. Certain parameters
can overwrite the parameters set on the
profile.

Code

Yes

Parameter code

Value

No

Parameter value

Field

Mandatory

Description

channelReference

Yes

Channel reference of the created incoming
communication

importStatus

Yes

Status of the data load

Status

Yes

InProgress: file has not yet entered a Trax
workflow

10.1.2.3 Response

Success: file has entered a Trax workflow
Failure: file could not be parsed
communicationStatus

Yes

Status of the incoming communication

communicationHistory

No (0..N)

Communication history entries (optional)

Date

Yes

Creation timestamp

User

No

Initiating end user (optional)

Message

Yes

Message text (e.g. status change, error
description, …)

Below examples illustrates a successful load and a failed load using custom validation (XSD error).
Both examples illustrate the use of the additional parameters (format & confidential). The additional parameters in the
request can be used to overwrite the configured values on the profile.

10.1.2.4 Example Request/Response
<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<ns2:import xmlns:ns2="http://import.webservice.trax.com/">
<profile>SupplierBatchPayment</profile>
<reference>myEndToEndReference</reference>
<data>dGVzdDEyMzQ=</data>
<parameter>
<code>format</code>
<value>PAIN00100103</value>

Trax 7.36.0

127

Trax | Administrator (Communications)

</parameter>
<parameter>
<code>confidential</code>
<value>false</value>
</parameter>
</ns2:import>
</S:Body>
</S:Envelope>

<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<ns2:importResponse xmlns:ns2="http://import.webservice.trax.com/">
<channelReference>WS-mt101-08051258554526544</channelReference>
<importStatus>
<status>Success</status>
<communicationStatus>Ready</communicationStatus>
<communicationHistory>
<date>2012-09-07T15:04:18.928+02:00</date>
<user>admin</user>
<message>Received</message>
</communicationHistory>
<communicationHistory>
<date>2012-09-07T15:04:18.928+02:00</date>
<message>Changed status from Initial to Ready</message>
</communicationHistory>
</importStatus>
</ns2:importResponse>
</S:Body>
</S:Envelope>

10.1.2.5 Example Request/Response With Custom Validation
<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<ns2:import xmlns:ns2="http://import.webservice.trax.com/">
<profile>SalaryPayment</profile>
<reference>myEndToEndReference</reference>
<data>dGVzdDEyMzQ=</data>
<parameter>
<code>format</code>
<value>PAIN00100103</value>
</parameter>
<parameter>
<code>confidential</code>
<value>true</value>
</parameter>
</ns2:import>
</S:Body>
</S:Envelope>

<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<S:Fault xmlns:ns4="http://www.w3.org/2003/05/soap-envelope">
<faultcode>S:Server</faultcode>
<faultstring>Error PAIN00100103-XSD_ERROR: Content is not allowed in
Prolog.</faultstring>
<detail>
<ns2:ImportServiceException xmlns:ns2="http://import.webservice.trax.com/">
<message>
Error PAIN00100103-XSD_ERROR: Content is not allowed in
Parameters:

Trax 7.36.0

Prolog.,

128

Trax | Administrator (Communications)

COLUMN=1,
LINE=1
LoadObjectRule failed with error(s)
Error while executing rule loadobject: Exception in 'loadobject' cause = LoadObjectRule failed with
error(s);
</message>
</ns2:ImportServiceException>
</detail>
</S:Fault>
</S:Body>
</S:Envelope>

10.1.2.6 Get status
This web service gives feedback whether an uploaded file has already entered any Trax workflow (which is considered as
a successful file upload).
It also returns the incoming communication’s (internal) status and history entries.

Request
Field

Mandatory

Description

channelReference

Yes

Channel reference of the created
incoming communication (i.e. the
output of the upload file web
service call)

Field

Mandatory

Description

status

Yes

InProgress: file has not yet entered
a Trax workflow

Response

Success: file has entered a Trax
workflow
Failure: file could not be parsed
communicationStatus

Yes

Status of the incoming
communication

communicationHistory

No (0..N)

Communication history entries
(optional)

date

Yes

Creation timestamp

user

No

Initiating end user (optional)

message

Yes

Message text (e.g. status change,
error description, …)

Example Request/Response
<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<ns2:getStatus xmlns:ns2="http://import.webservice.trax.com/">
<channelReference>WS-mt101-08051258554526544</channelReference>
</ns2:importgetStatus>
</S:Body>

Trax 7.36.0

129

Trax | Administrator (Communications)

</S:Envelope>

<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<ns2:getStatusResponse xmlns:ns2="http://import.webservice.trax.com/">
<status>Success</status>
<communicationStatus>Processed</communicationStatus>
<communicationHistory>
<date>2012-09-07T15:04:18.928+02:00</date>
<user>admin</user>
<message>Received</message>
</communicationHistory>
<communicationHistory>
<date>2012-09-07T15:04:18.928+02:00</date>
<user>admin</user>
<message>Changed status from Initial to Ready</message>
</communicationHistory>
<communicationHistory>
<date>2012-09-07T15:04:18.928+02:00</date>
<user>admin</user>
<message>Changed status from Ready to Processing</message>
</communicationHistory>
<communicationHistory>
<date>2012-09-07T15:04:18.928+02:00</date>
<message>Changed status from Processing to Processed</message>
</communicationHistory>
</ns2:getStatusResponse>
</S:Body>
</S:Envelope>

Example Failure Response
<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<S:Fault xmlns:ns4="http://www.w3.org/2003/05/soap-envelope">
<faultcode>S:Server</faultcode>
<faultstring>Invalid or non-existing reference</faultstring>
<detail>
<ns2:ImportServiceException xmlns:ns2="http://import.webservice.trax.com/">
<message>Invalid or non-existing reference</message>
</ns2:ImportServiceException>
</detail>
</S:Fault>
</S:Body>
</S:Envelope>

10.1.3 Web Service Definition

WSDL Definition
import.wsdl

<?xml version="1.0"?>
<definitions targetNamespace="http://import.webservice.trax.com/" name="ImportService"
xmlns="http://schemas.xmlsoap.org/wsdl/"
xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
xmlns:xsd="http://www.w3.org/2001/XMLSchema"
xmlns:trax="http://import.webservice.trax.com/">
<types>

Trax 7.36.0

130

Trax | Administrator (Communications)

<xsd:schema>
<xsd:import namespace="http://import.webservice.trax.com/" schemaLocation="import.xsd" />
</xsd:schema>
</types>
<message name="import">
<part name="parameters" element="trax:import" />
</message>
<message name="importResponse">
<part name="parameters" element="trax:importResponse" />
</message>
<message name="ImportServiceException">
<part name="fault" element="trax:ImportServiceException" />
</message>
<message name="getStatus">
<part name="parameters" element="trax:getStatus" />
</message>
<message name="getStatusResponse">
<part name="parameters" element="trax:getStatusResponse" />
</message>
<portType name="ImportPort">
<operation name="import">
<input message="trax:import" />
<output message="trax:importResponse" />
<fault message="trax:ImportServiceException" name="ImportServiceException" />
</operation>
<operation name="getStatus">
<input message="trax:getStatus" />
<output message="trax:getStatusResponse" />
<fault message="trax:ImportServiceException" name="ImportServiceException" />
</operation>
</portType>
<binding name="ImportPortBinding" type="trax:ImportPort">
<soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document" />
<operation name="import">
<soap:operation soapAction="" />
<input>
<soap:body use="literal" />
</input>
<output>
<soap:body use="literal" />
</output>
<fault name="ImportServiceException">
<soap:fault name="ImportServiceException" use="literal" />
</fault>
</operation>
<operation name="getStatus">
<soap:operation soapAction="" />
<input>
<soap:body use="literal" />
</input>
<output>
<soap:body use="literal" />
</output>
<fault name="ImportServiceException">
<soap:fault name="ImportServiceException" use="literal" />
</fault>
</operation>
</binding>
<service name="ImportService">
<port name="ImportPort" binding="trax:ImportPortBinding">
<soap:address location="http://localhost:8081/webservice/import" />
</port>
</service>
</definitions>

Trax 7.36.0

131

Trax | Administrator (Communications)

XML Schema
import.xsd

<?xml version="1.0"?>
<schema version="1.0" targetNamespace="http://import.webservice.trax.com/"
xmlns="http://www.w3.org/2001/XMLSchema"
xmlns:trax="http://import.webservice.trax.com/">
<element name="import" nillable="true" type="trax:import" />
<element name="importResponse" nillable="true" type="trax:importResponse" />
<element name="getStatus" nillable="true" type="trax:getStatus" />
<element name="getStatusResponse" nillable="true" type="trax:getStatusResponse" />
<element name="ImportServiceException" nillable="true" type="trax:faultInfo" />
<complexType name="import">
<sequence>
<element name="profile" type="string" />
<element name="reference" type="string" minOccurs="0" />
<element name="data" type="base64Binary" />
<element name="parameter" type="trax:parameter" nillable="true" minOccurs="0" maxOccurs="unbounded"
/>
</sequence>
</complexType>
<complexType name="parameter">
<sequence>
<element name="code" type="string" />
<element name="value" type="string" minOccurs="0" />
</sequence>
</complexType>
<complexType name="importResponse">
<sequence>
<element name="channelReference" type="string" />
<element name="importStatus" type="trax:getStatusResponse" />
</sequence>
</complexType>
<complexType name="getStatus">
<sequence>
<element name="channelReference" type="string" />
</sequence>
</complexType>
<complexType name="getStatusResponse">
<sequence>
<element name="status" type="trax:status" />
<element name="communicationStatus" type="string" />
<element name="communicationHistory" type="trax:communicationHistory" nillable="true" minOccurs="0"
maxOccurs="unbounded" />
</sequence>
</complexType>
<simpleType name="status">
<restriction base="string">
<enumeration value="InProgress" />
<enumeration value="Success" />
<enumeration value="Failure" />
</restriction>
</simpleType>
<complexType name="communicationHistory">
<sequence>
<element name="date" type="dateTime" />

Trax 7.36.0

132

Trax | Administrator (Communications)

<element name="user" type="string" minOccurs="0" />
<element name="message" type="string" />
</sequence>
</complexType>
<complexType name="faultInfo">
<sequence>
<element name="message" type="string" minOccurs="0" />
</sequence>
</complexType>
</schema>

10.2 Web Service Tooling
10.2.1 Install soapUI
Start the installer, accept the agreement. Most defaults are fine, just press next, some remarks are:

Figure 10-1
Accept the agreement.

Figure 10-2

Trax 7.36.0

133

Trax | Administrator (Communications)

Only an install of SoapUI is needed.

Figure 10-3
After installation, soapUI will startup for the first time.
Right click on the ‘Projects’ node in the navigator pane and select ‘New soapUI Project’.
Provide a name for your project and the correct wsdl url location:
http(s)://server:port/webservice/import?wsdl

Please note that this URL is changed on the latest release, the example screenshots still have the old URL.
An example would be:

Figure 10-4
This will create a new ‘webservice’ node and will automatically download the wsdl specification. It will create a node for
each available service and an example request to test the service.

Trax 7.36.0

134

Trax | Administrator (Communications)

10.2.2 Importing
Double click on the example request in the ‘import’ service to see the above example request.
The request is on your left, the response will be shown on the right.
Click on ‘Attachments (0)’ under the request to open the attachments list.
The first button above this list allows you to add an attachment (the file you want to import).
Add the file you want to import to the list and choose ‘No’ to not cache the attachment in the request.
See below:

Figure 10-5
You can now link this file with your request. The example request contains a generated id ‘cid: 1211871618283’ for the
importing data. In the attachment list, link your file by selecting this id in the ‘part’ column.

Figure 10-6

Trax 7.36.0

135

Trax | Administrator (Communications)

Further complete the request by specifying a profile, a reference and some parameters (changing all the ‘?’)
Finally submit the request by pressing the green play button above. The result is shown in the right pane.

Figure 10-7

10.2.3 Get status
Same procedure applies to do status requests.

10.3 Configure Incoming Routing (Web Service)
The ‘System Administrator’ security profile can configure incoming routing, so that the processing for data uploaded via
the “Import” web service must be processed (i.e. which Trax workflow) can be configured. The system administrator can
configure a matching Incoming Routing entry:
-

Channel: “Web-Service”

-

Profile: any <Import Profile>

Only the communication history of the communication object will be returned (if it exists).
The returned communication status comes from the :
-

Communication object if it exists.

-

Transmission in all other cases.

Mapping transmission/communication status → (simple) status
Transmission = Initial → InProgress
Transmission = Ready → InProgress
Transmission = Processing → InProgress
Transmission = Duplicate → Success
Transmission = Failed → Failure
Transmission = Cancelled → Failure
Transmission = Processed

→ lookup communication, and map:
1. Communication = Initial → InProgress

Trax 7.36.0

136

Trax | Administrator (Communications)

2. Communication = Ready → InProgress
3. Communication = Processing → InProgress
4. Communication = Duplicate → Success
5. Communication = Failed → Failure
6. Communication = Cancelled → Failure
7. Communication = Processed → Success

Trax 7.36.0

137

Trax | Administrator (Communications)

11 Channel: JMS
JMS as a channel is out-of-the-box supported using JNDI lookups for JMS queues configured in the JMS resource
adapter deployed on WildFly application server.

11.1 IBM WebSphere MQ
The IBM WebSphere MQ resource adapter (wmq.jmsra.rar) deployed on WildFly application server will make an MQ
client connection (TCP) to a WebSphere MQ server. This connection can be secured using SSL/TLS.

11.1.1 WildFly Deployment
You need to configure CLI options to enable the deployment of the WebSphere MQ resource adapter on WildFly
(wmqEnabled) and to enter MQ client connections settings (wmqHostname, wmqPort, etc). Please refer to the CLI Reference
Guide for the full list of CLI parameter.
This will result in the WebSphere MQ resource adapter (wmq.jmsra.rar) being deployed and an additional section added
in the WildFly standalone.xml configuration file (see example below).
<resource-adapter>
<archive>wmq.jmsra.rar</archive>
<transaction-support>XATransaction</transaction-support>
<connection-definitions>
<connection-definition classname="com.ibm.mq.connector.outbound.ManagedQueueConnectionFactoryImpl" jndiname="java:/jms/WMQBackOfficeQueueConnectionFactory" enabled="true" use-java-context="true" poolname="WMQBackOfficeQueueConnectionFactory">
<config-property name="hostName">WMQ-HOST</config-property>
<config-property name="port">1414</config-property>
<config-property name="queueManager">TRAX.SSL.QM</config-property>
<config-property name="channel">TRAX.CHANNEL</config-property>
<config-property name="transportType">CLIENT</config-property>
<config-property name="username">trax</config-property>
<config-property name="password"></config-property>
</connection-definition>
</connection-definitions>
<admin-objects>
<admin-object class-name="com.ibm.mq.connector.outbound.MQQueueProxy" jndiname="java:/jms/WMQToBackOfficeQueue" enabled="true" use-java-context="true" poolname="WMQToBackOfficeQueue">
<config-property name="baseQueueName">TRAX.TO.BACKOFFICE</config-property>
<config-property name="persistence">QDEF</config-property>
<config-property name="arbitraryProperties">MDR="YES", MDW="YES",
MDCTX="2"</config-property>
</admin-object>
<admin-object class-name="com.ibm.mq.connector.outbound.MQQueueProxy" jndiname="java:/jms/WMQFromBackOfficeQueue" enabled="true" use-java-context="true" poolname="WMQFromBackOfficeQueue">
<config-property name="baseQueueName">BACKOFFICE.TO.TRAX</config-property>
<config-property name="persistence">QDEF</config-property>
<config-property name="arbitraryProperties">MDR="YES", MDW="YES",
MDCTX="2"</config-property>
</admin-object>
</admin-objects>
</resource-adapter>

Trax 7.36.0

138

Trax | Administrator (Communications)

11.1.2 Configure SSL/TLS
If you want to secure the MQ client connection using SSL/TLS (which is recommended), you need to configure below CLI
options.
•

wmqSslciphersuite: fill out the MQ client SSL cipher suite matching the MQ server SSL cipher spec. Please refer

to on-line IBM WebSphere MQ 7.5 documentation “SSL CipherSpecs and CipherSuites in WebSphere MQ
classes for Java” using this link:
http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.5.0/com.ibm.mq.dev.doc/q031290_.htm
•

•

wildflyTrustStore: the application server truststore file (JKS format) which must contain 2 certificates:

o

Trax ActiveMQ server SSL certificate

o

WebSphere MQ server SSL certificate

wildflyTrustStorePass: the password of above truststore

Take a copy of the original jboss-truststore.jks file as shipped with WildFly (which already contains the correct Trax
ActiveMQ server SSL certificate) and add the WebSphere MQ server SSL certificate to it with below Java JDK command:
keytool -import -file "cert.arm" -alias ibmwebspheremq -keystore "jboss-truststore.jks" -storepass
"traxtrax"

Afterwards, use this updated file in the wildflyTrustStore CLI parameter and use traxtrax as value for the
wildflyTrustStorePass CLI parameter.

Note: when a cipher spec with TLS v1.2 is used on a WebSphere MQ 7.5 server (for example when using SSL cipher
spec TLS_RSA_WITH_AES_128_CBC_SHA256), you will likely need to add Java options -Dcom.ibm.mq.cfg.preferTLS=true Dcom.ibm.mq.cfg.useIBMCipherMappings=false in WildFly standalone.conf / standalone.conf.bat by using the javaOpts CLI
parameter.

11.1.3 Trax Configuration
Create a JMS server / JMS queue connection as shown below.

Trax 7.36.0

139

Trax | Administrator (Communications)

Add an outgoing queue as shown below.

Trax 7.36.0

140

Trax | Administrator (Communications)

Note: by default Trax will send out a bytes JMS message. If you want Trax to send out a text JMS message, you need to
add JMS parameter jms.message.type = text on each outgoing queue.

Add an incoming queue as shown below.

Trax 7.36.0

141

Trax | Administrator (Communications)

11.2 WebLogic JMS remote JNDI (legacy)
This legacy JMS configuration uses a remote JNDI lookup against a WebLogic JMS server instead of a (local)
JBoss/WildFly JNDI lookup.

Note: this JMS configuration will be removed in future versions.

11.2.1 WildFly Deployment
On WildFly application server, below additional configurations must be done when using the Weblogic variant.
Add below JAR files (copied from your WebLogic 10.3.x application server installation) to the lib directory in
wildfly/standalone/deployments/trax.ear
•

jmsclient-10.3.x.jar

•

thint3client-10.3.x.jar

Change wildfly/modules/com/trax/config-ear/main/module.xml as highlighted below
[...]

Trax 7.36.0

142

Trax | Administrator (Communications)

<dependencies>
<module name="javax.api"/>
<module name="javax.transaction.api"/>
<module name="org.wildfly.iiop-openjdk"/> <-- added -->
</dependencies>
</module>

Change standalone/configuration/standalone.xml as highlighted below
[...]
<extensions>
[...]
<extension module="org.wildfly.extension.undertow"/>
<extension module="org.wildfly.iiop-openjdk"/> <-- added -->
</extensions>
[...]
<subsystem xmlns="urn:jboss:domain:ejb3:4.0">
[...]
<thread-pools>
<thread-pool name="default">
<max-threads count="10"/>
<keepalive-time time="100" unit="milliseconds"/>
</thread-pool>
</thread-pools>
<iiop enable-by-default="false" use-qualified-name="false"/> <-- added -->
<default-security-domain value="other"/>
<default-missing-method-permissions-deny-access value="true"/>
<log-system-exceptions value="true"/>
</subsystem>
[...]
</subsystem>
<!-- added -->
<subsystem xmlns="urn:jboss:domain:iiop-openjdk:1.0">
<initializers transactions="spec" security="identity"/>
</subsystem>
<subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/>
[...]
<interface name="public">
<inet-address value="${jboss.bind.address:127.2.0.1}"/>
</interface>
<!-- added -->
<interface name="unsecure">
<inet-address value="${jboss.bind.address.unsecure:127.2.0.1}"/>
</interface>
<interface name="any">
[...]
<socket-binding name="https" port="8443"/>
<socket-binding name="iiop" interface="unsecure" port="3528"/> <!-- addedd -->
<socket-binding name="iiop-ssl" interface="unsecure" port="3529"/> <!-- addedd -->
<socket-binding name="txn-recovery-environment" port="4712"/>
[...]

11.2.2 Trax Configuration
Within the System Administrator (SA) security profile first of all a JMS server (JMS Queue Connection) has to be
configured referring to the remote server hosting the JMS queues using the URL field and referring to the JNDI name of
the Connection Factory as set-up on the remote server.

Trax 7.36.0

143

Trax | Administrator (Communications)

Figure 11-1: JMS queue connection
In order to force Trax to use a by Weblogic managed JMS queue connection (and to make sure JMS messages are
correctly handled within the remote JNDI Weblogic server), following parameter must be added: jmsra.managed = false

Trax 7.36.0

144

Trax | Administrator (Communications)

In order to connect to a remote server secured using SSL, the URL should be adjusted accordingly.

Trax 7.36.0

145

Trax | Administrator (Communications)

Figure 11-2: JMS queue connection using SSL
Together with a JMS server also the individual incoming and outgoing queues have to be configured here. They must be
identified using the JNDI names set-up on the remote JMS server and using a direction (In=Incoming queue,
Out=Outgoing queue).

Trax 7.36.0

146

Trax | Administrator (Communications)

Figure 11-3: Incoming JMS queue

Figure 11-4: Outgoing JMS queue

Note: by default Trax will send out a bytes JMS message. If you want Trax to send out a text JMS message, you need to

Trax 7.36.0

147

Trax | Administrator (Communications)

add JMS parameter jms.message.type = text on each outgoing queue.

Figure 11-5: JMS parameter to configure message type

11.3 JMS service
In order to start listening on JMS queues, a JMS service is available with which you can start/stop listening on all active
JMS queues with direction ‘In’ belonging to an active JMS queue connection.

Figure 11-6: JMS service

Trax 7.36.0

148

Trax | Administrator (Communications)

The Service entity code of the JMS service should refer to the code of the JMS server containing the IN JMS queue.

11.4 Outgoing routing
In short, outgoing JMS communication works the same as for the other output channels. In outgoing routing ‘JMS’ should
be selected as channel after which a JMS queue with direction ‘Out’ can be selected as profile on which the send out
messages will be placed.

11.5 Incoming routing
Also incoming JMS must be configured very similar to other input channels. In incoming routing ‘JMS’ should be selected
as channel after which a JMS queue with direction ‘In’ can be selected as profile.
The mail channel is a general-purpose output channel that allows sending communication data via email, either as an
attachment or as the body of the message.

Trax 7.36.0

149

Trax | Administrator (Communications)

12 Channel: MAIL
12.1 Configuration
The ‘System Administrator’ security profile can configure new mail outgoing profile in a dedicated inventory located
under Connectivity > Email > Email outgoing profile.

Figure 12-1: Email outgoing profile configuration

Trax 7.36.0

150

Trax | Administrator (Communications)

Figure 12-2: Source System configuration

12.1.1 Recipient configuration
There are various ways to define the recipients of an email message. All specified email addresses are added to the
recipients list.
Field

Description

Email

Directly input an email address (or comma-separated list of email
addresses).

User

Select a user whose email address will be used.

User group

.Select a user group, the email addresses of the members will be
used.

Data owner

select a data owner, the email address of the data owner will be used

Mail to holder

Send an email to the email address of the holder which is linked with
your business object

Mail to source
system

Send an email to the email addresses which are configured for the
applied source system.
Note: This feature is currently only available for the Status Reporting
workflow.

Derive data
owner

Detect the data owner of the business entity that is being processed,
the email address of this data owner will be used.

Expand data
owner members

Do not use the email address of the data owner, but send an email to
its members instead (applies to both ways of determining a data
owner)

Hide recipients

Send the email to “undisclosed recipients” (recipients are specified as
BCC instead of TO)

12.1.2 Message content configuration
Following fields can be configured via the user interface:

Trax 7.36.0

151

Trax | Administrator (Communications)

Field

Description

Subject

The email subject (can contain placeholders).

Mail type

Specifies whether to send the data as attachment or as body of the
email message (the bytes are interpreted in the encoding that is
specified via Outgoing Routing).

MIME type

.
Specifies whether to format the data in plain text or HTML when
sending out; Only applicable if the Mail type is body.

Attachment
name

The name of the attachment (can contain placeholders); only
applicable if the Mail type is attachment.

Body

The email message body (can contain placeholders); only applicable
if the Mail type is attachment.

Trax 7.36.0

152

Trax | Administrator (Communications)

Placeholders for business data can be used in certain fields. These will be resolved by attributes of the business object as
soon as the email is sent. Some placeholders are generic but others are specific to the model. In case a placeholder
cannot be resolved, it is copied verbatim.
Key

Model

Description

id

ME/BP/UP/AS

The unique identifier

channel

ME/BP/UP/AS

The communication channel code

profile

ME/BP/UP/AS

The communication profile code

internalClassificationType

ME/BP/UP/AS

The internal classification type (ICT)

dataOwner

ME/BP/UP/AS

The data owner code

targetFormat

ME/BP/UP/AS

The output format

timeStamp

ME/BP/UP/AS

The current system date/time

timestamp[:format]

ME/BP/UP/AS

The current system date/time with
optional formattingi

debitBankBic

ME/BP/UP

The destination (ME) or ordering
customer (BP/UP) bank BIC (static data)

debitBankName

ME

The destination (ME) or ordering
customer (BP/UP) bank name (static
data)

debitBankCode

ME

The destination (ME) or ordering
customer (BP/UP) bank code (static data)

communicationReference

ME

The communication reference

sender

ME

The sender from the ME mini model

receiver

ME

The receiver from the ME mini model

messageType

ME

The message type from the ME mini
model

counterpartyReference

ME

The counterparty reference from the ME
mini model

businessDate

ME

The business date from the ME mini
model

amountValue

ME

The value of the amount from the ME mini
model

amountCurrency

ME

The currency of the amount from the ME
mini model

account

ME

The account from the ME mini model

numberOfTransactions

ME

The number of transactions from the ME
mini model

Trax 7.36.0

153

Trax | Administrator (Communications)

Key

Model

Description

ownReference

ME/BP/UP

The own reference

debitAccountNumber

BP/UP

The ordering customer account number
(static data)

CCY

BP/UP/AS

The instructed amount currency code or
interbank settlement amount currency
code if not available

primaryIdentifier

AS

The primary identifier of the account
(static data)

accountNumber

AS

The account number of the account (static
data)

accountCode

AS

The code of the account (static data)

accountName

AS

The name of the account (static data)

accountCurrency

AS

The currency of the account (static data)

holderName

AS

The name of the account holder (static
data)

holderCode

AS

The code of the account holder (static
data)

bankName

AS

The name of the account’s bank (static
data)

bankCode

AS

The code of the account’s bank (static
data)

bankBic

AS

The BIC of the account’s bank (static
data)

closingBalance

AS

The closing balance of the statement

closingBalanceSign

AS

The debit/credit mark of the closing
balance

closingBalanceDate

AS

The balance date

statementNumber

AS

The account statement number

sequenceNumber

AS

The statement’s sequence number

transactionReferenceNumber

AS

The transaction reference number

sourceSystem

SR

The Source System

functionalStatus

SR

The functional Status for which notification
is triggered

Please note that the actual data (either being sent as body or attachment) is never filtered to prevent unwanted
replacements.

Trax 7.36.0

154

Trax | Administrator (Communications)

12.1.3 Mail transport configuration
The mail server configuration and the FROM-user are configured via the Trax installer, see the CLI documentation for
more information about the available configuration options. These settings are shared with the Application log service.
http://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html

12.1.4 Overriding attributes
All attributes of a mail channel can be overridden by routing parameters. For references to other value objects, like for
example ‘user’, use the value object’s code.
Parameter codes should be noted in camelcase.

12.1.5 Mail body content-type
The routing parameters can also contain an additional parameter to adapt the mail body content-type. By default the
content-type is set to ’text/plain’. This can be adapted by setting a different value within the routing parameter ‘contenttype’ (for example : text/html; charset=”UTF-8”).

Trax 7.36.0

155

Trax | Administrator (Communications)

13 Channel: No Output
13.1 Usage
The No Output channel requires no configuration. Select it on the Outgoing Routing for which no output is required (e.g.
internal payments).
NOTE: an outgoing representation is still created and validated according to the target format of the payment.

Trax 7.36.0

156

Trax | Administrator (Communications)

14 Channel: Workflow
14.1 Usage
The workflow channel is used to send data from one workflow to another.

14.2 Configuration
A workflow profile determines the link between outgoing and incoming workflow.

The workflow that is sending its data uses the Workflow channel and a profile in the appropriate Outgoing routing
configuration.

The workflow that is receiving the data uses the Workflow channel and the same profile in the appropriate Incoming
routing configuration.

Trax 7.36.0

157

Trax | Administrator (Communications)

The sending workflow will generate an outgoing communication and transmission and the workflow channel will create an
incoming transmission with the payload of the outgoing transmission.

Trax 7.36.0

158

Trax | Administrator (Communications)

15 Channel: Integration Channel
15.1 Introduction
The integration channel is a generic channel that makes use of the Apache Camel routing and mediation engine.
This channel is intended to support several different communication protocols (such as file, FTP, queues, web services
…) that Apache Camel offers out-of-the-box.
For now, only the file,FTP, SFTP and queues communication protocols are supported.

15.2 Integration Channel Service
The Integration Channel has its own dedicated service. For incoming communications over this channel to work, this
service needs to be started and an active incoming Integration Channel profile needs to be present to handle these
incoming communications.
Newly created Integration Channel incoming profiles will only be taken into account after a restart of the Integration
Channel service. (The service does not automatically detect the presence of a new profile).
Furthermore, the active flag needs to be set to true in the inbound profile (see below).

Figure 15-1: Integration Channel Service

15.3 Automatically reload Integration Channel Service configuration
When adding/changing/removing any Integration channel configuration, this change is reflected directly in the running
service as well. Supported configuration includes :

Trax 7.36.0

159

Trax | Administrator (Communications)

•

Integration channel profile

However, the best approach for Integration channel is to simply restart the service.

15.4 Integration Channel Profile configuration
The ‘System Administrator’ security profile can create new Integration Channel profiles (both incoming and outgoing)
under Routing > Integration Channel.

Figure 15-2: Integration Channel profile {General}

Figure 15-3: Integration Channelprofile {Parameters}

Field

Description

Code

Unique identification of the Integration Channel profile, used by Trax.

Name

Name of the Integration Channel profile.

Trax 7.36.0

160

Trax | Administrator (Communications)

Field

Description

Description

A plain text description of the Integration Channel profile.

Direction

An Integration Channel profile can be used either for incoming or for outgoing
communications. In corresponds to an Incoming Profile, Out to an Outgoing
Profile. The direction will be preset for you depending on the inventory you are in
(incoming profile or outgoing profile).

Active

Indicates active/inactive status of the profile. Only active profiles will be selected
for routing (both incoming and outgoing) and will be executed for
sending/receiving communications.

Route

Points to a predefined Groovy script containing the Apache Camel route to be used
for the main communication.

Split script

(Optional) reference to a script to split the incoming communication into multiple
child communications. Parameters of the split script can be set in the
‘integration channel profile’ tab. Only scripts with script usage ‘Split’ are allowed
to choose. It is possible the incoming file must be decrypted and
decompressed. In that case the decryption and decompression should be
handled in incoming routing together with the incoming routing parameter with
code: decrypt-decompress-in-channel and value: true.

Acknowledgement
Route

(Optional) Points to a predefined Groovy script containing the Apache Camel route
to be used for receiving acknowledgement messages to reconcile the outgoing
message (e.g. ACK/NAK).
Only applicable for outgoing profiles.
When filled out, the outgoing message will stay in Sending and an
acknowledgement message is expected before the outgoing message is
flagged as Sent.

Table 15-1 Integration Channel Profile

Parameter

Description

hostname

The hostname of the FTP server to connect to.

port

The TCP port to connect to (e.g. 21 for plain FTP, 22 for SFTP, 990 for implicit
FTPS).

directory

The directory on the FTP server where to write files (outgoing profile) or to poll
for incoming files (incoming profile).

username

The FTP account username.

password

The FTP account password.
Note: password will be automatically encrypted upon entry (noticeable by the
{AES} prefix).

Trax 7.36.0

161

Trax | Administrator (Communications)

Parameter

Description

reconcileDirectory

Only applicable for outgoing profiles with acknowledgment route.
The directory on the FTP server where to poll for feedback files.

reconcileInclude

Only applicable for outgoing profiles with acknowledgment route.
The regex pattern of the feedback files to poll for.
For example: .*.(ok|nok)

fileName

Only applicable for outgoing profiles.
The pattern to be used for generating file names.
Common Trax variables can be used here.

include

For
default-{timestamp}.txt
Onlyexample:
applicable
for incoming profiles.

recursive

The regex pattern of the incoming files to poll for.
For example: .*.txt
Only applicable for incoming profiles.
These parameters controls if incoming files should also be looked fur in
subdirectories.

delay

Possible value: true | false (default)
Only applicable for incoming profiles.
The delay in milliseconds between two polls.
E.g. 5000 (= 5 seconds)

readLockMinAge

Only applicable for incoming profiles.
The minimum age a file must be before polling. This can be used to differentiate
between polling 2 different types of files which belong together.

readLockCheckInterval

As an example, we take XMLv2 AFT. This has a payload file and an
accompanied PDU file. Locally, the payload file should always be available
when reading the PDU file. So, the payload file can be polled immediately, so
the value is ‘0’. The accompanied PDU should be polled a bit later, so we are
sure the payload file is already available. Set the value to a multiple of the delay
value, e.g. ‘15000’.
This interval is used for sleeping between attempts to acquire the read lock
(Camel default: 5000).

readLockTimeout

Timeout in milliseconds for the readLock (Camel default for FTP: 20000). The
readLockTimeout should be higher than the sum of the readLockCheckInterval
+ readLockMinAge.

splitValue

This is the separator in the sample split script ‘SplitBySeparator’ to split up the
incoming communication in multiple child communications.

startDelimiter

This is the starting point of a child communication in the sample split script
‘SplitByDelimiters’. Everything after the value, included the value itself are
included in a child communication.

Trax 7.36.0

162

Trax | Administrator (Communications)

Parameter

Description

endDelimiter

This is the ending point of a child communication in the sample split script
‘SplitByDelimiters’. Everything before the value, included the value itself are
included in a child communication.

reconcile

Enabling this will add reconcile behavior to the message. For ingoing
communications this means it will be regarded as a reconciliation message, for
outgoing communications it will ensure that the communication is SENDING until
it is reconciled.
Possible value: true | false (default)

targetProfile

TSG specific parameter. This is used to link current profile to a communication
with the same profile on TSG’ side. (Mandatory for TSG profiles)

targetProtocol

TSG specific parameter. Use this to specify the protocol that needs to be used.
(Mandatory for TSG profiles)
Possible value: Swift-FIN | Swift-FileAct

sendNumberOfTransa
ctions

TSG specific parameter. Enabling this will make sure that the number of
transactions is passed to TSG. This is only available for the protocol SwiftFileAct. (Optional parameter)
Possible value: true | false (default)

Table 15-2 Integration Channel Profile Parameters
All the profile parameters can be overwritten by outgoing routing parameters that have the same code but are prefixed
with “INT.”.
Each profile corresponds to a specific route in the Apache Camel engine. Each route will either send/receive
transmissions from/to Trax.
The Apache Camel routes are configured using Groovy script.

Figure 15-4: Outgoing Integration Channel {Groovy Script}

Trax 7.36.0

163

Trax | Administrator (Communications)

Figure 15-5: Incoming Integration Channel {Groovy Script}
A typical Apache Camel route configures a route to exchange messages between two endpoints defined in Camel:
-

The ‘from’ endpoint is the source of the message (i.e.the sender)

-

The ‘to’ endpoint is the destination of the message (i.e.the receiver)

In an outgoing profile (used for sending out communications from Trax) the ‘from’ endpoint will always be Trax (denoted
as "direct:trax") and the ‘to’ endpoint your actual destination, being an FTP location.
In an incoming profile (used for receiving communication into Trax) it is the other way around; the ‘to’ endpoint will always
be Trax (denoted as "direct:trax") and the ‘from’ endpoint the external source of the communication.
The ‘routeId’ gives a unique name to a route and needs to be given the same as the Integration Channel profile code (in
the examples routeId is always set to ${params.profile}). The routeId (or profile code) will also be used by Apache Camel
when logging information about the route.
For more information about how to use Groovy scripting for defining a Route, we recommend consulting the Apache
Camel Website at: http://camel.apache.org/groovy-dsl.html
And for an exhaustive list of all possible options for configuring FTP/FTPS/SFTP endpoint:
http://camel.apache.org/ftp2.html

15.4.1 Route Configuration details
The Trax endpoint needs no additional configuration, and will always be exactly the same: “direct:trax”. The other
endpoint (FTP) can be further configured by specifying more parameters and options:

15.4.1.1 Accessing variables in groovy
In Groovy strings, you can refer to defined variables with the ${params.xyz} syntax:
"ftp://localhost:21/out?username=${params.username}&password=${params.password}&fileName=\\${header.fileNa
me}"
You have 2 kind of parameters: the parameters of the integration channel profile configuration and parameters from the
outside, the communication/transmission parameters.
You can do this with any variable that you have defined in the Integration Channel profile’s parameters tab. These
parameters are bound to the Groovy script as a Map called ‘params’.

Trax 7.36.0

164

Trax | Administrator (Communications)

Additionally, you can also refer to all binding variables that have been passed to the Groovy script from outside, as well
as all the communication parameters of the Communication being executed.
Camel calls these variables as groovy headers in the script and will be picked up during the camel execution.
E .g. you can refer to the ‘reference’ Communication parameter as follows:
\\${header.reference}
For the full list of all available Communication parameter, see the next section.

15.4.1.2 Trax Routing parameters
When an Outgoing Routing is applied to a workflow object in the enrichment phase of the workflow, following routing
parameters will automatically be resolved for use in the Route groovy script.
Parameter

Description

Messages
communicationreference

The communication reference

Unitary/Bulk Payments & Messages
targetformat

Adds the target format

debitaccountnumber

Ordering customer account static data account - account num- ber (Not
supported for Messages!)

ccy

Currency of the ordering customer account (Not supported for Messages!)

debitbankbic

Debit bank BIC

channel

Adds the code of the outgoing channel

profile

Adds the code of the profile which is used to write out this file

internalclassificationtype

Internal classification type

dataowner

Adds the data owner

ownreference

Adds the own reference of the payment/message

Account Statements
dataowner

Copies the data owner

id

Adds the identifier

accountnumber

Adds the account number

ccy

Adds the currency

closingbalancedate

AccountStatement.ClosingBalance.BalanceDate

closingbalancesign

AccountStatement.ClosingBalance.DebitCreditMark

closingbalance

AccountStatement.ClosingBalance.SignedAmount

statementnumber

AccountStatement.StatementNumber

sequencenumber

AccountStatement.SequenceNumber

transactionreferencenumber

AccountStatement.TansactionReferenceNumber

Trax 7.36.0

165

Trax | Administrator (Communications)

Parameter

Description

targetformat

AccountStatement.TargetFormat

primaryidentifier

AccountStatement.PrimaryIdentifier

accountnumber

AccountStatement.Account.Static data account.Account num- ber

holdername

AccountStatement.Account.Static data account.Holder.Name

holdercode

AccountStatement.Account.Static data account.Holder.Code

bankname

AccountStatement.Account.Static data account.Bank.Name

bankcode

AccountStatement.Account.Static data account.Bank.Code

bankbic

AccountStatement.Account.Static data account.Bank.BIC

Status Reports
sourceSystem

sourceSystem in status reporting profile

functionalStatus

functionalStatus for which notification is triggered in status reporting profile

Additionally, only for the Integration channel, all routing parameters that start with a prefix “INT.” will also be resolved and
copied over to the message (and dropping the “INT.” prefix in the process). The parameters with this prefix also have
priority meaning they will overwrite profile parameters if they have the same code.

15.4.1.3 Basic FTP configuration
A basic FTP configuration for Outgoing Communication looks like this:
ftp://host:21/workDir?username=${params.username}&password=${ params.password}&binary=true
&fileName=myfile
-

‘ftp’ is the protocol

-

‘host’ is the hostname or IP address of the FTP server to connect to

-

the default FTP port is ‘21’, but this might be different in some setups

-

‘workDir’ is the relative workingDirectory on the server to move to

-

‘username’ and ‘password’ are for user authentication

-

‘binary’ needs to be set to true, to avoid line endings from being changed automatically during transport

-

fileName is the name of the target file

When you want to download files from an FTP server, there are some different parameters to use:
ftp://host:21/workDir?username=${params.username}&password=${params.password}&binary=true&move=processed&
delay=5000&include=.*&recursive=false
-

‘ftp’ is the protocol

-

‘host’ is the hostname or IP address of the FTP server to connect to

-

default FTP port is ‘21’, but this might be different in some setups

-

‘workDir’ is the relative workingDirectory on the server to move to

-

‘username’ and ‘password’ are for user authentication

Trax 7.36.0

166

Trax | Administrator (Communications)

-

‘binary’ needs to be set to true, to avoid line endings from being changed automatically during transport

-

‘move’ points to processed folders where files are put during and after processing. Although these parameters are
optional, it’s a good strategy to use them, for example in case you don’t have write-rights on the FTP server and want
to avoid that Trax picks up the file without being able to move it.

-

‘delay’ is the amount of time in between downloads

-

‘include’ is the file pattern that specifies which files to download

-

‘recursive’ downloads files in sub-folders

15.4.1.4 FTPS specific configuration
A basic implicit FTPS configuration looks like this :
ftps://host:990/workDir?username=${params.username}&password=${params.password}&binary=true
&fileName=myfile&isImplicit=true
-

‘ftps’ is the protocol

-

‘host’ is the hostname or IP address of the FTP server to connect to

-

the default FTPS port is ‘990’, but this might be different in some setups

-

‘workDir’ is the relative workingDirectory on the server to move to

-

‘username’ and ‘password’ are for user authentication

-

‘binary’ needs to be set to true, to avoid line endings from being changed automatically during transport

-

fileName is the name of the target file

-

default FTPS mode is implicit_ssl (when you need explicit_ssl, set to false)

15.4.1.5 SFTP with password authentication
This configuration supports the password and keyboard-interactive authentication methods. A basic SFTP configuration
looks like this:
sftp://host:990/workDir?username=${params.username}&password=${params.password}&fileName=myfile
-

‘sftp’ is the protocol

-

‘host’ is the hostname or IP address of the FTP server to connect to

-

the default SFTP port is ‘22’, but this might be different in some setups

-

‘workDir’ is the relative workingDirectory on the server to move to

-

‘username’ and ‘password’ are for user authentication

-

There is no need to set the ‘binary’ flag, as SFTP is always binary

-

fileName is the name of the target file

-

15.4.1.6 SFTP with publickey authentication
A more complex SFTP configuration that uses the publickey authentication method looks like this:
sftp://host:22/incoming?username=${params.username}&privateKeyFile=RAW(${params.privateKeyFile})&privateKeyPas
sphrase=RAW(${params.privateKeyPassphrase})&useUserKnownHostsFile=false&knownHostsFile=RAW(D:\\known_ho
sts)&strictHostKeyChecking=yes&fileName=myfile
-

‘sftp’ is the protocol

Trax 7.36.0

167

Trax | Administrator (Communications)

-

‘host’ is the hostname or IP address of the FTP server to connect to

-

the default SFTP port is ‘22’, but this might be different in some setups

-

‘incoming’ is the relative directory on the SFTP server

-

username – specifies the username to use. This is required but does not necessarily specify the actual user when
using the publickey method.

-

privateKeyFile – specifies the file location of the private key to authenticate the user. A private key is required and
user authentication is done by the SFTP server based on the matching public key.

-

privateKeyPassphrase – specifies the password to of the private key

-

useUserKnownHostsFile – If knownHostFile has not been explicit configured then use the host file from
System.getProperty(user.home)/.ssh/known_hosts

-

knownHostsFile – Sets the known_hosts file, so that the SFTP endpoint can do host key verification.

-

stictHostKeyChecking – Sets whether to use strict host key checking. The value can be one of: no, yes

-

fileName – the name of the target file

Please see the Camel SFTP component documentation7 for more information.

Note the use of the RAW() pattern in the URI. This allows for special characters to be entered directly in the URI without
escaping. This is typically needed for complex passwords or file locations.
When using the publickey method for SFTP, a PEM-encoded SSH2 private RSA key is required.
This is specified at creation time (typically using ssh-keygen), or an SSH1 key can also be converted to SSH2 (using sshkeygen).
An SSH2 RSA private key has a specific header when it is encoded as PEM. The header looks like this:
-----BEGIN RSA PRIVATE KEY-----

SSH1 RSA private keys start with the following header, and must be re-generated or converted so that it can be used for
SFTP in Trax:
-----BEGIN OPENSSH PRIVATE KEY-----

To convert an SSH1 key to SSH2, the following command can be used (ssh-keygen) to convert and overwrite the original
private key:
$ ssh-keygen -p -f ./myssh1key -m pem
If an SSH1 key is used to do SFTP in Trax, you will get a generic “Auth fail” error message or an error message such as
“invalid privatekey: [B@5e9d5728” in the Trax communication.log file when connecting to the SFTP server.

7 https://camel.apache.org/components/2.x/sftp-component.html

Trax 7.36.0

168

Trax | Administrator (Communications)

15.4.1.7 Webservice configuration
A basic webservice call consists of 4 parts and uses Camel HTTP4 component. This can be found back in the sample
script ‘SOAP-out’.
If post-processing was already applied and the message content requires another modification, this can be done in the
Groovy script that creates the integration channel route.
1. constructing the message:
// prepare the input which will be wrapped in a SOAP envelope
// 'createSOAPMessage' function gets a Reader as argument and returns a Reader as result.
// 'it.in.body' is the content coming from Trax as an InputStream. Optionally wrap it in the required WDSL and
// pass it to the 'createSOAPMessage' to wrap everything in a SOAP message.
def body = createSOAPMessage(it.in.body.newReader(encoding), true).text

2. sending out the message:
// construct the url to send the request to
def url = "https4://$hostname:$port/$path?socketTimeout=$socketTimeout&amp;connectionTimeout=$connectionTimeout"
// send out the SOAP request to the given URL and get the response back
def exchange = it.context.createProducerTemplate().request(url, { exchange ->
exchange.in.headers = ['CamelHttpMethod' : 'POST', 'Content-Type' : 'text/xml;charset=UTF-8']
exchange.in.body = body
})

3. handle SOAP or HTTP errors
def exception = exchange.exception
if (exception) {
def msg = "Sending to '$url' failed"
if (exchange.exception instanceof org.apache.camel.http.common.HttpOperationFailedException) {
msg += " with status: '${exception.statusCode}'"
// handle SOAP error
def responseValues = new XmlSlurper().parseText(exception.responseBody).Body.Fault.children().collectEntries {[it.name(), it.text()]}
if(responseValues.faultstring) {
msg += " because: '${responseValues.faultstring}'"
} else {
msg += " and body '${exception.responseBody}'."
}
} else {
// handle HTTP error
msg += " because: '${exception.message}'."
}
throw new RuntimeException(msg)
}

Trax 7.36.0

169

Trax | Administrator (Communications)

3. if no error, optionally handle SOAP response
// handle SOAP response
def response = exchange.out?.body?.text
if(response) {
// optionally parse response XML via XmlSlurper
log.debug("Response: $response")
}

15.5 Bank Connector and Trax Swift Gateway
15.5.1 Introduction
Trax uses the Trax SWIFT Gateway (TSG), or the newer version that is known as Bank Connector (BC), as communication
layer to the SWIFT Service Bureau. The configuration to connect to these communication layers can be set up in the
Integration channel by using the Activemq (TSG) or BankConnector (BC) connection and profiles.

AvantGard
TRAX

Active MQ

AvantGard
TRAX SWIFT
Gateway

SWIFT Service
Bureau

Figure 17-5-6 Structure
Communication between Trax and TSG happens over Active MQ, between Trax and BC over Artemis (Message Queue).
Trax uses the queues communication protocol of Camel to connect to the ActiveMQ/Artemis server. Trax will listen to
incoming messages using the BankConnection/Tsg-connection-in profile for both regular messages and reconciliation
messages. That profile will then delegate the message to another Integration channel profile based on the parameters
targetProfile and targetProtocol.

15.5.1.1 FIN
FIN is the Standard messaging solution for single instructions in SWIFT format (MT/MX) with a limitation of 10 Kilobytes

15.5.1.2 FileAct
FileAct is a Real-time (250 Megabytes) or Store&Forward (20 Megabytes) file transfer for structured or free format files.
Instruction messages are exchanged to initiate the actual file transfer in a separate flow.

15.5.2 Configuring the connection

•

Bank Connector (BC)

For Bank Connector (BC) an Integration channel connection (Configuration > Routing > Integration channel > Integration
channel connection) using the IntegrationChannel-bankconnector-component as connection builder should be used.
Trax already provides such a Bank Connector Integration channel connection within the product workflows. The
connection parameters used by this connection should be defined during the CLI installation. Several CLI properties are
available to enable the bank connector connection and to provide following information (for more information see the CLI
reference guide):
o

bcEnabled: to enable/disable the bank connector connection

o

bcAddresses : Hostname + port

Trax 7.36.0

170

Trax | Administrator (Communications)

o

bcTrustStore(Pass): Trust store + password

o

bcKeyStore(Pass): Key store + password

WildFly standalone will create a connection to this remote bank connector.

•

Trax SWIFT Gateway (TSG)

For TSG an Integration channel connection (Configuration > Routing > Integration channel > Integration channel
connection) using the IntegrationChannel-activemq-component as connection builder should be used. Trax already
provides an example of such an Activemq Integration channel connection but the default parameters need to be edited for
the connection to be able to work. To configure the connection, all that needs to happen is to edit parameters on the
Activemq connection to the desired values. The connection to TSG is always secured by SSL/TLS. The keystore and
truststore are the default wildfly keystore and truststore and are configured to work with the ActiveMQ server that’s
provided with TSG. If you installed the TSG server with another keystore/truststore you can change them in the
connection parameters.

Next step is creating routings and active profiles in Trax.

15.5.3 Outgoing Profiles

•

Bank Connector (BC)

When you want to send messages to Bank Connector, you need to specify an outgoing integration channel profile. The
navigation is Config > Routing > integration channel > Outgoing profile.
To set up a BankConnector outgoing profile, you must configure the BankConnector-out script as routing script. This
script will mark the communication as reconcilable and will take care of the BankConnector specific logic. It will send the
communication to the BankConnector connection (see previous chapter).
There are 2 ways to configure the outgoing integration channel for Bank Connector:
•

Preferred: a clear unique code of the profile e.g.: the combination of the protocol, the receiving bank (e.g. BIC)
and the format type (No targetProfile and targetProtocol parameters are needed) which should match with the
Bank Connector profile

•

The old way: use the targetProtocol (protocol) and targetProfile (format/bank) parameters

Trax 7.36.0

171

Trax | Administrator (Communications)

Parameter

Value

targetProfile (optional)

The target profile should preferably contain the protocol, bank
identifier and format to help identify it during configuration. This
value will be matched with the Bank Connector profile.

targetProtocol (optional)

The target protocol should be set to either Swift-FIN or
Swift-FileAct depending on the protocol to be used.
•

Table 17-5-3 Bank Connector Outgoing Profile

In case the targetProfile and targetProtocol parameters are NOT configured, the TSGTargetProfile parameter will be set
to the code of the integration channel profile. Bank Connector will use that code to route the message to the bank.
In case the targetProfile and targetProtocol are configured, the TSGTargetProfile parameter will be set to the value of the
targetProfile parameter of the integration channel profile. Bank Connector will use that targetProfile parameter value to
route the message to the bank.

•

Trax SWIFT Gateway (TSG)

For TSG outgoing integration channel profiles have to be configured in order to send messages out via TSG. Within these
TSG outgoing profiles a Route script should be used referring to the Integration channel connection (see chapter 16.5.2)
using the IntegrationChannel-activemq-component as connection builder as shown in the example below.

Trax 7.36.0

172

Trax | Administrator (Communications)

Contradictory to Bank Connector, you will need targetProtocol and targetProfile parameters in order to make these
outgoing profiles specific for a protocol and bank/format. Those parameters are mandatory for TSG.
The (BC or TSG) outgoing profiles configured can now be used as profiles in outgoing routing (Configuration > Routing >
Outgoing routing).

Figure 15-7: Outgoing routing table

15.5.3.1 Sending the total Number of Transactions over FileAct
SWIFT is sometimes able to apply a specific pricing (price per transaction, instead of per kilobyte) for FileAct files,
provided the number of transactions that the file contains is mentioned, in a specific FileAct header (the <TtlNbOfTxs>
tag, in the File Act FileExchangeRequest).
This functionality is supported by TSG. To activate it, you need to enable the add the parameter
‘sendNumberOfTransactions’ in the integration channel outgoing profile

Trax 7.36.0

173

Trax | Administrator (Communications)

15.5.3.2 Changing the FileAct logical file name
Banks sometimes require having a unique logical filename and that can be achieved by using timestamp or/and
sequence number.
Example:
Outgoing profile parameter EXT_TSGFileActLogicalName with value
CITI_painSCORE_{timestamp}_{sequencenumber:seqCITI}
Note: Within the EXT_TSGFileActLogicalName outgoing profile parameter, the same parameters which are applicable
for the filename of the file-system channel can be used.

15.5.3.3 Sending confidential payments to Bank Connector
To make sure that the payload of the messages sent from Trax to Bank Connector is not shown the ‘TSGConfidential’
parameter with value ‘true’ can be added to the Trax outgoing routing used to send over the message to Bank Connector.
Adding this parameter makes sure that in Bank Connector the payload of the message is not shown

Trax 7.36.0

174

Trax | Administrator (Communications)

15.5.4 Incoming Profiles

•

Bank Connector (BC)

When you want to receive messages from Bank Connector, you need to specify an incoming integration channel profile.
The navigation is Config > Routing > integration channel > Incoming profile.
The product workflows deliver a profile BankConnector-connection-in:

This BankConnector-connection-in profile takes care of receiving all messages, so both incoming messages and
incoming reconciliation messages.
Next to this BankConnector-connection-in profile, you will also need an incoming integration channel profile to route
your message in Trax. There are 2 ways to configure your profile
•

Preferred: a clear unique code of the profile matching with the Bank Connector profile typically the combination of
the protocol, the receiving bank (e.g. BIC) and the format type.

•

The old way: use the targetProtocol (protocol) and targetProfile (format/bank) parameters

When a message comes in from Bank Connector, it (TSGTargetProfile) will first look for an incoming integration channel
profile with a matching code. If no matching code can be found, it will look for an incoming integration channel profile with
matching targetProtocol and targetProfile parameters.
If none can be found, the incoming message will fail.

Trax 7.36.0

175

Trax | Administrator (Communications)

Parameter

Value

targetProfile
(optional)

The target profile should preferably contain the protocol, bank identifier
and format to help identify it during configuration. This value must match
the profile used in Bank Connector routing table.

targetProtocol
(optional)

The target protocol should be set to either Swift-FIN or Swift-FileAct
depending on the protocol used.

Table 17-5-5 Bank Connector Outgoing Profile

•

Trax SWIFT Gateway (TSG)

For TSG both a generic and protocol/bank/format specific incoming integration channel profiles need to be configured.
Within the generic TSG-connection-in profile a Route script should be used referring to the Integration channel connection
(see chapter 16.5.2) using the IntegrationChannel-activemq-component as connection builder as shown in the
example below.

Contradictory to Bank Connector, you will need protocol/format/bank specific incoming profiles using the targetProtocol
(protocol) and targetProfile (bank/format) parameters. The targetProfile and targetProtocol parameters are mandatory for
TSG.
The (BC or TSG) incoming profiles configured can now be used as profiles in incoming routing (Configuration > Routing >
Incoming routing).
Make sure that the active flag of the incoming and outgoing profiles is checked to be able to use them.

Trax 7.36.0

176

Trax | Administrator (Communications)

15.6 Apache Kafka
There is sample configuration provided to support Integration Channel communication with Apache Kafka. There is
configuration for incoming (Kafka consuming) and outgoing (Kafka producing) transmissions. An incoming profile ‘Kafkain’ and outgoing profile ‘Kafka-out’ can be activated and be configured in the routing. Both use a shared connection
component of Integration channel, named ‘Kafka’. This is assigned as a parameter on both profiles. The other parameter
on both profiles is the name of the Kafka topic, where the endpoint of the workflow objects is.
The connection component has some parameters, where values are based on the Kafka environment where Integration
Channel should connect to:
Parameter
kafkaUrl
sslEnabled
truststore
truststorePassword
clientId
groupId

Description
url of the kafka broker: hostname:port
Switch to enable SSL connection to Kafka or
not
Location of the Kafka truststore file
Password of the Kafka truststore file
Kafka configuration client ID
Kafka configuration group ID

Default value
localhost:9092
false

testserver
Test-consumer-group

Something specific for messaging is the Kafka message key.
By default, this is the E2E reference of the outgoing communication. However, it is possible to configure another field on
the outgoing routing. This can be done by configuring the parameter INT.kafkaMessageKey on the outgoing routing. If
the property doesn’t exist, Trax will throw an exception that it doesn’t exist.

Trax 7.36.0

177

Trax | Administrator (Communications)

16 Channel Reference and E2E reference
The E2E reference helps to identify a business object and its related incoming and outgoing communications /
transmissions in Trax. It is an identifier that is unique for the business object and its communications/transmissions and
is shown in the processing tab of the business object and in the general tab of the transmission and communication.
The E2E reference will be generated by Trax for all channels except for those that provide a reference of their own. This
is the case for Trax SWIFT Gateway where the E2E reference will be the TSG source reference.
Remark the following cases for the E2E generation:
-

AS and ID
–

in case multiple account statements are present in the incoming file, the E2E reference of all the account
statements will be the same.

–

A new E2E reference will be generated for each outgoing envelope. The E2E reference of the account
statements will not be updated.

–

In case of partial statements, a new E2E reference will be generated for the newly created “merged” account
statement.

The channel reference is an identifier that helps identify communications and transmissions. The channel reference
equals the name of the incoming file for all channels except for the Trax SWIFT Gateway where the channel reference
will equal the TSG source reference. The channel reference will be the same on the incoming
transmission/communication and the related business object. In the outgoing transmission, the channel reference will be
the name of the outgoing file.

Trax 7.36.0

178

Trax | Administrator (Communications)

17 Trax Disaster Recovery attempt towards Bank Connector (BC)
In case of a technical failure a recovery attempt will expose an additional JMS header towards Bank Connector named
"TSGRecoveryAttempt". This header is set to "TRUE” when the failed transmission is retransmitted by Trax during
recovery. Bank Connector uses this to improve its technical duplicate detection. Please refer to the Bank Connector
documentation for more information.

Trax 7.36.0

179

Trax | Administrator (Communications)

18 Trax run modes
Trax supports different run modes, which allow automatic behavior changes with regards to incoming and/or outgoing
communications. A run mode is defined at install time and dictates how that environment will handle communications
from that point forward. The main benefit of these run modes is that any environment (Dev , QA, Production) can make
use of the same set of routing configuration without problems.
3 distinct run modes are supported for Trax environments:
Mode
Production
Internal

Behavior
Trax handles all communications exactly as configured (channel, profile, encryption, etc.)
Trax disables certain incoming/outgoing communications. The goal is to block off external systems (ie:
Banks) while still allowing internal communications (ie: ERP, Accounting tools, etc)
Incoming connections are blocked for following workflows:
- AS, CHQ_SF, DC, DCC, ID, ME-IN, SF
Outgoing connections are blocked for following workflows:
- BP, CHQ_SF, DD, ME-OUT, PAY, UP
Trax will still handle all workflows properly, but some payloads will not be loaded or written out as per the
above rules. This run mode is typically used for integration testing with internal systems, while not
sending any data to external parties.

Isolated

Do not enable this run mode in a production environment.
Trax disables all incoming/outgoing communications. This run mode allows for configuration creation and
testing without needing to worry about any system integration to the environment. A typical usecase for
this run mode would be to allow configurators to set up and test flows in a Dev environment before
promoting the configuration to a QA environment where (some) system integration can be set up.
Do not enable this run mode in a production environment.

18.1 Configuration
18.1.1 Installation
“runMode” is a required installation parameter for Trax instances. This is supported for either Helm or CLI installations
using the same parameter name.
Helm:

CLI:

When logging into a Trax environment, the run mode will be shown in the header for all non-Production environments.

Trax 7.36.0

180

Trax | Administrator (Communications)

18.1.2 Production
A Trax environment running in Production mode, can leverage the run mode configuration to enable Emergency uploads.
This feature is meant to enable an upload action on Incoming Routing for scenarios where a file is irreparable and can not
be regenerated by the source system. When this feature is enabled, users who have received the Emergency upload
privilege can use the Incoming Routing action to manually re-upload the payload on the appropriate Incoming Routing.

Only users with “Emergency uploads” will be able to use this
feature if enabled on the Run mode configuration.

A corporate policy would mostly require the admin to disable the feature again once the upload had happened.

18.1.3 Internal / Isolated
A Trax environment running in either Internal or Isolated mode, can leverage the run mode configuration to enable
automatic ACK/NACK handling.
When either run mode is active, the Trax environment may not send out data to external systems. However, when a
communication is supposed to be sent to a Channel requiring delivery acknowledgements (ie: EBICS, SWIFT), Trax can’t
expect an response, since no request will be sent to begin with. In that case, for testing purposes, it may be easier to
simply automatically ACK or NACK any of those communications.
Automatic bank response enables whether this
feature is activated. Positive bank response can
toggle the automation between ACK (true) or NACK
(false) behavior accordingly.

Trax 7.36.0

181

Trax | Administrator (Communications)

18.2 Usage
A Trax environment running in either Internal or Isolated mode, exposes some helpful actions to the testers and/or
configurators. These actions do not need to be allowed or configured as they are always available.

18.2.1 Upload file
“Upload file” on Incoming Routing is available to allow
quick uploads into a specific Incoming Routing without
having to set up integrations with external channels (no
need to create folders, attach queues, etc). When using
this action, a screen will pop up with all pre-configured
parameters for this specific Routing’s profile. The user is
allowed to add more parameters to ensure proper handling
of the Channel load (ie: a filePAth parameter may be
needed in some projects to be able to detect a Source
System). All uploads are handled by the appropriate
channel. This feature (but also the Emergency uploads for
Production mode) eliminates the need for duplicating all
Incoming Routings in the GUI-Upload channel.

18.2.2 Process ACK/NACK
When an outgoing communication is handled, but not actually written out, the communication may be sitting in
Processing, waiting for a Channel acknowledgement. Since external communications are blocked in these modes,
nothing will ever arrive. If the automated option as described above (18.1.3) is not desirable for testing, users can always
manually finalize the outgoing communication. 2 additional actions are generated in Outgoing processing communication
inventory: Process ACK and Process NACK.

Trax 7.36.0

182

